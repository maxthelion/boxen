# [TASK-80e957b6] Add staging_url field to tasks and display on dashboard

ROLE: orchestrator_impl
PRIORITY: P2
BRANCH: main
CREATED: 2026-02-08T15:40:34.990670
CREATED_BY: human
CHECKS: gk-testing-octopoid

## Context
## Background

App tasks that create PRs often get a staging/preview URL (e.g., from Cloudflare Pages). Currently this URL is buried in PR comments and not surfaced anywhere in the dashboard.

## What to build

### 1. DB schema: staging_url column on tasks table

Add a nullable staging_url TEXT column to the tasks table. This is a generic field -- not tied to Cloudflare specifically. Any deployment preview, staging environment, or preview URL can go here.

Migration: add column in the next schema version increment.

### 2. Populate staging_url from PR comments

In the reports module (orchestrator/orchestrator/reports.py), when gathering PR data via _gather_prs():
- For each PR, check comments for a Cloudflare Pages deployment URL
- Extract the branch preview URL (stable across redeploys), not the per-commit URL
- The Cloudflare bot comment contains a line like: | Branch Preview | https://xxx.boxen-8f6.pages.dev |
- Use gh pr view <number> --json comments --jq to extract it
- Store it on the task record via the new staging_url field
- Also support setting staging_url directly via create_task() or update for non-Cloudflare sources

### 3. Display on dashboard PRs tab

In orchestrator/octopoid-dash.py, the PRs tab currently shows: number, title, branch, author, age, role.

Add the staging URL as a new row or field in the PR display. Since terminals cannot reliably render clickable links, just display the URL as plain text. The user can copy it.

Format suggestion -- show it on a second line under the PR title:
  #55  Queue manipulation scripts              agent/32edc31a   1h    ORCH
       https://agent-32edc31a.boxen-8f6.pages.dev

Only show the URL line if staging_url is set (many tasks will not have one).

## Patterns to follow

- DB migrations: see migrate_schema() in orchestrator/orchestrator/db.py
- PR data gathering: see _gather_prs() in orchestrator/orchestrator/reports.py
- Dashboard rendering: see the PRs tab in orchestrator/octopoid-dash.py

## Files to modify

| File | Change |
|------|--------|
| orchestrator/orchestrator/db.py | Add staging_url column, migration |
| orchestrator/orchestrator/reports.py | Extract Cloudflare URL from PR comments, populate staging_url |
| orchestrator/octopoid-dash.py | Display staging_url on PRs tab |
| orchestrator/tests/test_db.py or new test | Test migration, test staging_url storage/retrieval |

## NOT in scope

- Making URLs clickable (OSC 8 hyperlinks) -- just display as text
- Auto-opening URLs in a browser
- Non-Cloudflare staging providers (but the field is generic for future use)

## Acceptance Criteria
- [ ] staging_url column exists on tasks table with proper migration
- [ ] Cloudflare Pages branch preview URL is extracted from PR comments and stored
- [ ] Dashboard PRs tab shows staging URL under PR entries that have one
- [ ] PRs without a staging URL show no extra line (no empty rows)
- [ ] staging_url can be set via create_task() for non-Cloudflare sources
- [ ] All existing orchestrator tests pass: cd orchestrator && ./venv/bin/python -m pytest tests/ -v

CLAIMED_BY: orch-impl-1
CLAIMED_AT: 2026-02-08T15:48:28.105557

SUBMITTED_AT: 2026-02-08T15:51:14.800843
COMMITS_COUNT: 0
TURNS_USED: 25

ACCEPTED_AT: 2026-02-08T18:53:31.187710
ACCEPTED_BY: human (self-merge verified)
