var Os=Object.defineProperty;var Ws=(e,n,s)=>n in e?Os(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s;var tt=(e,n,s)=>Ws(e,typeof n!="symbol"?n+"":n,s);import{c as Us,j as t,R as xs,r as O,u as _s,C as Gs,G as Ys,O as Xs,E as Zs,a as Js}from"./react-three-CKHyqQHB.js";import{a8 as Ks,a9 as Lt,aa as Dt,ab as qe,ac as qs,ad as Jt,ae as gs,d as $e,h as Qs,af as mt,s as ys,c as vs,ag as pt,M as en,ah as St,ai as tn,aj as sn,r as nn,ak as Tt,D as on,al as ln,am as rn,an,ao as cn}from"./three-DdSqslSN.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();const dn={enabled:!1,height:15,width:20,inset:0},Qe=(e,n)=>{switch(n){case"y":return e==="top"||e==="bottom"?"lid":"wall";case"x":return e==="left"||e==="right"?"lid":"wall";case"z":return e==="front"||e==="back"?"lid":"wall"}},Ht=(e,n)=>{const i={y:{positive:"top",negative:"bottom"},x:{positive:"right",negative:"left"},z:{positive:"front",negative:"back"}}[n];return e===i.positive?"positive":e===i.negative?"negative":null},Be=(e,n)=>({y:{positive:"top",negative:"bottom"},x:{positive:"right",negative:"left"},z:{positive:"front",negative:"back"}})[e][n],xt=e=>({front:1,back:2,left:3,right:4,top:5,bottom:6})[e],ws={assemblyAxis:"y",lids:{positive:{enabled:!0,tabDirection:"tabs-out",inset:0},negative:{enabled:!0,tabDirection:"tabs-out",inset:0}}},Rt={front:0,back:0,left:0,right:0,top:0,bottom:0},Ue={top:0,bottom:0,left:0,right:0},Kt=(e,n)=>({front:{top:"x",bottom:"x",left:"y",right:"y"},back:{top:"x",bottom:"x",left:"y",right:"y"},left:{top:"z",bottom:"z",left:"y",right:"y"},right:{top:"z",bottom:"z",left:"y",right:"y"},top:{top:"x",bottom:"x",left:"z",right:"z"},bottom:{top:"x",bottom:"x",left:"z",right:"z"}})[e][n];var js={exports:{}};(function(e){var n=function(){var s=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",l={};function a(c,f){if(!l[c]){l[c]={};for(var u=0;u<c.length;u++)l[c][c.charAt(u)]=u}return l[c][f]}var r={compressToBase64:function(c){if(c==null)return"";var f=r._compress(c,6,function(u){return i.charAt(u)});switch(f.length%4){default:case 0:return f;case 1:return f+"===";case 2:return f+"==";case 3:return f+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:r._decompress(c.length,32,function(f){return a(i,c.charAt(f))})},compressToUTF16:function(c){return c==null?"":r._compress(c,15,function(f){return s(f+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:r._decompress(c.length,16384,function(f){return c.charCodeAt(f)-32})},compressToUint8Array:function(c){for(var f=r.compress(c),u=new Uint8Array(f.length*2),d=0,m=f.length;d<m;d++){var x=f.charCodeAt(d);u[d*2]=x>>>8,u[d*2+1]=x%256}return u},decompressFromUint8Array:function(c){if(c==null)return r.decompress(c);for(var f=new Array(c.length/2),u=0,d=f.length;u<d;u++)f[u]=c[u*2]*256+c[u*2+1];var m=[];return f.forEach(function(x){m.push(s(x))}),r.decompress(m.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":r._compress(c,6,function(f){return o.charAt(f)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),r._decompress(c.length,32,function(f){return a(o,c.charAt(f))}))},compress:function(c){return r._compress(c,16,function(f){return s(f)})},_compress:function(c,f,u){if(c==null)return"";var d,m,x={},b={},h="",y="",p="",A=2,j=3,N=2,C=[],v=0,k=0,g;for(g=0;g<c.length;g+=1)if(h=c.charAt(g),Object.prototype.hasOwnProperty.call(x,h)||(x[h]=j++,b[h]=!0),y=p+h,Object.prototype.hasOwnProperty.call(x,y))p=y;else{if(Object.prototype.hasOwnProperty.call(b,p)){if(p.charCodeAt(0)<256){for(d=0;d<N;d++)v=v<<1,k==f-1?(k=0,C.push(u(v)),v=0):k++;for(m=p.charCodeAt(0),d=0;d<8;d++)v=v<<1|m&1,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=m>>1}else{for(m=1,d=0;d<N;d++)v=v<<1|m,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=0;for(m=p.charCodeAt(0),d=0;d<16;d++)v=v<<1|m&1,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=m>>1}A--,A==0&&(A=Math.pow(2,N),N++),delete b[p]}else for(m=x[p],d=0;d<N;d++)v=v<<1|m&1,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=m>>1;A--,A==0&&(A=Math.pow(2,N),N++),x[y]=j++,p=String(h)}if(p!==""){if(Object.prototype.hasOwnProperty.call(b,p)){if(p.charCodeAt(0)<256){for(d=0;d<N;d++)v=v<<1,k==f-1?(k=0,C.push(u(v)),v=0):k++;for(m=p.charCodeAt(0),d=0;d<8;d++)v=v<<1|m&1,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=m>>1}else{for(m=1,d=0;d<N;d++)v=v<<1|m,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=0;for(m=p.charCodeAt(0),d=0;d<16;d++)v=v<<1|m&1,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=m>>1}A--,A==0&&(A=Math.pow(2,N),N++),delete b[p]}else for(m=x[p],d=0;d<N;d++)v=v<<1|m&1,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=m>>1;A--,A==0&&(A=Math.pow(2,N),N++)}for(m=2,d=0;d<N;d++)v=v<<1|m&1,k==f-1?(k=0,C.push(u(v)),v=0):k++,m=m>>1;for(;;)if(v=v<<1,k==f-1){C.push(u(v));break}else k++;return C.join("")},decompress:function(c){return c==null?"":c==""?null:r._decompress(c.length,32768,function(f){return c.charCodeAt(f)})},_decompress:function(c,f,u){var d=[],m=4,x=4,b=3,h="",y=[],p,A,j,N,C,v,k,g={val:u(0),position:f,index:1};for(p=0;p<3;p+=1)d[p]=p;for(j=0,C=Math.pow(2,2),v=1;v!=C;)N=g.val&g.position,g.position>>=1,g.position==0&&(g.position=f,g.val=u(g.index++)),j|=(N>0?1:0)*v,v<<=1;switch(j){case 0:for(j=0,C=Math.pow(2,8),v=1;v!=C;)N=g.val&g.position,g.position>>=1,g.position==0&&(g.position=f,g.val=u(g.index++)),j|=(N>0?1:0)*v,v<<=1;k=s(j);break;case 1:for(j=0,C=Math.pow(2,16),v=1;v!=C;)N=g.val&g.position,g.position>>=1,g.position==0&&(g.position=f,g.val=u(g.index++)),j|=(N>0?1:0)*v,v<<=1;k=s(j);break;case 2:return""}for(d[3]=k,A=k,y.push(k);;){if(g.index>c)return"";for(j=0,C=Math.pow(2,b),v=1;v!=C;)N=g.val&g.position,g.position>>=1,g.position==0&&(g.position=f,g.val=u(g.index++)),j|=(N>0?1:0)*v,v<<=1;switch(k=j){case 0:for(j=0,C=Math.pow(2,8),v=1;v!=C;)N=g.val&g.position,g.position>>=1,g.position==0&&(g.position=f,g.val=u(g.index++)),j|=(N>0?1:0)*v,v<<=1;d[x++]=s(j),k=x-1,m--;break;case 1:for(j=0,C=Math.pow(2,16),v=1;v!=C;)N=g.val&g.position,g.position>>=1,g.position==0&&(g.position=f,g.val=u(g.index++)),j|=(N>0?1:0)*v,v<<=1;d[x++]=s(j),k=x-1,m--;break;case 2:return y.join("")}if(m==0&&(m=Math.pow(2,b),b++),d[k])h=d[k];else if(k===x)h=A+A.charAt(0);else return null;y.push(h),d[x++]=A+h.charAt(0),m--,A=h,m==0&&(m=Math.pow(2,b),b++)}}};return r}();e!=null?e.exports=n:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return n})})(js);var Ss=js.exports;const $t=["front","back","left","right","top","bottom"],fe=e=>Math.round(e*100)/100,As=e=>{let n=0;for(let s=0;s<$t.length;s++){const i=e.find(o=>o.id===$t[s]);i!=null&&i.solid&&(n|=1<<s)}return n},Is=e=>$t.map((n,s)=>({id:n,solid:(e&1<<s)!==0})),hn=e=>{if(!(e.front===0&&e.back===0&&e.left===0&&e.right===0&&e.top===0&&e.bottom===0))return[fe(e.front),fe(e.back),fe(e.left),fe(e.right),fe(e.top),fe(e.bottom)]},un=e=>e?{front:e[0],back:e[1],left:e[2],right:e[3],top:e[4],bottom:e[5]}:{...Rt},fn=e=>({id:e.id,cl:fe(e.clearance),fo:hn(e.faceOffsets),f:As(e.faces),rv:qt(e.rootVoid),mt:fe(e.materialThickness),a:ks(e.assembly)}),mn=e=>({id:e.id,clearance:e.cl,faceOffsets:un(e.fo),faces:Is(e.f),rootVoid:Qt(e.rv),materialThickness:e.mt,assembly:Ns(e.a)}),qt=e=>{const n={id:e.id,b:[fe(e.bounds.x),fe(e.bounds.y),fe(e.bounds.z),fe(e.bounds.w),fe(e.bounds.h),fe(e.bounds.d)]};return e.children&&e.children.length>0&&(n.ch=e.children.map(qt)),e.splitAxis&&(n.sa=e.splitAxis),e.splitPosition!==void 0&&(n.sp=fe(e.splitPosition)),e.subAssembly&&(n.sub=fn(e.subAssembly)),n},Qt=e=>{const n={id:e.id,bounds:{x:e.b[0],y:e.b[1],z:e.b[2],w:e.b[3],h:e.b[4],d:e.b[5]},children:e.ch?e.ch.map(Qt):[],splitAxis:e.sa,splitPosition:e.sp};return e.sub&&(n.subAssembly=mn(e.sub)),n},ks=e=>{if(e.assemblyAxis==="y"&&e.lids.positive.tabDirection==="tabs-out"&&e.lids.positive.inset===0&&e.lids.negative.tabDirection==="tabs-out"&&e.lids.negative.inset===0)return;const s={ax:e.assemblyAxis};return(e.lids.positive.tabDirection!=="tabs-out"||e.lids.positive.inset!==0)&&(s.lp=[e.lids.positive.tabDirection,e.lids.positive.inset]),(e.lids.negative.tabDirection!=="tabs-out"||e.lids.negative.inset!==0)&&(s.ln=[e.lids.negative.tabDirection,e.lids.negative.inset]),s},Ns=e=>{var n,s,i,o;return e?{assemblyAxis:e.ax,lids:{positive:{enabled:!0,tabDirection:((n=e.lp)==null?void 0:n[0])??"tabs-out",inset:((s=e.lp)==null?void 0:s[1])??0},negative:{enabled:!0,tabDirection:((i=e.ln)==null?void 0:i[0])??"tabs-out",inset:((o=e.ln)==null?void 0:o[1])??0}}}:{...ws}},pn=e=>{const n={};let s=!1;for(const[i,o]of Object.entries(e))(o.top!==0||o.bottom!==0||o.left!==0||o.right!==0)&&(n[i]=[o.top,o.bottom,o.left,o.right],s=!0);return s?n:void 0},bn=e=>{if(!e)return{};const n={};for(const[s,[i,o,l,a]]of Object.entries(e))n[s]={top:i,bottom:o,left:l,right:a};return n},es=e=>{const n={v:1,c:{w:fe(e.config.width),h:fe(e.config.height),d:fe(e.config.depth),mt:fe(e.config.materialThickness),fw:fe(e.config.fingerWidth),fg:fe(e.config.fingerGap),a:ks(e.config.assembly)},f:As(e.faces),r:qt(e.rootVoid),e:pn(e.edgeExtensions)},s=JSON.stringify(n);return Ss.compressToEncodedURIComponent(s)},Bt=e=>{try{let n=Ss.decompressFromEncodedURIComponent(e);n||(n=decodeURIComponent(atob(e)));const s=JSON.parse(n);return s.v!==1&&console.warn("Unknown project version:",s.v),{config:{width:s.c.w,height:s.c.h,depth:s.c.d,materialThickness:s.c.mt,fingerWidth:s.c.fw,fingerGap:s.c.fg,assembly:Ns(s.c.a)},faces:Is(s.f),rootVoid:Qt(s.r),edgeExtensions:bn(s.e)}}catch(n){return console.error("Failed to deserialize project:",n),null}},ts="p",xn=e=>{const n=es(e),s=new URL(window.location.href);s.searchParams.set(ts,n),s.hash="",window.history.replaceState(null,"",s.toString())},gn=()=>{const n=new URLSearchParams(window.location.search).get(ts);if(!n){const s=window.location.hash.slice(1);return s?Bt(s):null}return Bt(n)},yn=e=>{const n=es(e),s=new URL(window.location.href);return s.searchParams.set(ts,n),s.hash="",s.toString()},vn=(e,n,s)=>{const{fingerWidth:i,materialThickness:o}=s,l=n.x-e.x,a=n.y-e.y,r=Math.sqrt(l*l+a*a);if(r<.001)return[e,n];const c=l/r,f=a/r,u=s.invertPerpendicular?-1:1,d=u*-f,m=u*c,x=s.originalLength??s.edgeLength,b=s.patternOffset??0,h=s.cornerGapMultiplier??1.5,y=i*h,p=y+(s.startCornerExtra??0),A=y+(s.endCornerExtra??0),j=x-p-A;if(j<i)return[e,n];let N=Math.max(1,Math.floor(j/i));N%2===0&&N++;const C=j/N,v=o,k=L=>{const D=L-b;return D<-.001||D>r+.001?null:Math.max(0,Math.min(r,D))},g=[];g.push(e);const w=k(p);w!==null&&w>.001&&g.push({x:e.x+c*w,y:e.y+f*w});for(let L=0;L<N;L++){const D=L%2===0,R=p+L*C,T=p+(L+1)*C,H=k(R),G=k(T);if(H===null&&G===null||T<b||R>b+r)continue;const E=H!==null?H:0,I=G!==null?G:r;if(D){const V=d*v,P=m*v,$={x:e.x+c*E,y:e.y+f*E},W={x:e.x+c*I,y:e.y+f*I},X=H!==null&&H>=0,_=G!==null&&G<=r;if(X){const Z=g[g.length-1];(Math.abs($.x-Z.x)>.001||Math.abs($.y-Z.y)>.001)&&g.push($),g.push({x:$.x+V,y:$.y+P})}else g.push({x:$.x+V,y:$.y+P});_?(g.push({x:W.x+V,y:W.y+P}),g.push(W)):g.push({x:W.x+V,y:W.y+P})}else{const V={x:e.x+c*I,y:e.y+f*I},P=g[g.length-1];(Math.abs(V.x-P.x)>.001||Math.abs(V.y-P.y)>.001)&&g.push(V)}}const B=x-A,S=k(B);if(S!==null&&S<r-.001){const L=g[g.length-1],D={x:e.x+c*S,y:e.y+f*S};(Math.abs(D.x-L.x)>.001||Math.abs(D.y-L.y)>.001)&&g.push(D)}const F=g[g.length-1];return(Math.abs(n.x-F.x)>.001||Math.abs(n.y-F.y)>.001)&&g.push(n),g},Ps=(e,n,s)=>{const{fingerPoints:i,gender:o,materialThickness:l}=s,{points:a,innerOffset:r,fingerLength:c,maxJointLength:f}=i,u=n.x-e.x,d=n.y-e.y,m=Math.sqrt(u*u+d*d);if(m<.001)return[e,n];const x=u/m,b=d/m;let h,y;if(s.outwardDirection)h=s.outwardDirection.x,y=s.outwardDirection.y;else{const P=s.yUp??!0;h=P?-b:b,y=P?x:-x}const p=l,A=o==="male"?1:-1;if(a.length===0||c<=0)return[e,n];const{edgeStartPos:j,edgeEndPos:N}=s,C=Math.abs(N-j),v=N>j,k=P=>v?(P-j)/C*m:(j-P)/C*m,g=(P,$=0)=>{const W=Math.max(0,Math.min(m,P));return{x:e.x+x*W+h*$,y:e.y+b*W+y*$}},w=Math.min(j,N),B=Math.max(j,N),S=r,F=f-r,L=[S,...a,F],D=[];for(let P=0;P<L.length-1;P++)D.push({startAxis:L[P],endAxis:L[P+1],isFinger:P%2===0});const R=D.filter(P=>P.startAxis>=w&&P.endAxis<=B);if(!R.some(P=>P.isFinger))return[e,n];const H=[];H.push(e);const G=R.map(P=>({...P,startEdge:k(P.startAxis),endEdge:k(P.endAxis)})).sort((P,$)=>Math.min(P.startEdge,P.endEdge)-Math.min($.startEdge,$.endEdge));let E=0;for(const P of G){const $=Math.min(P.startEdge,P.endEdge),W=Math.max(P.startEdge,P.endEdge);if(!(W-$<.001)){if($>E+.001&&H.push(g($)),P.isFinger)H.push(g($,p*A)),H.push(g(W,p*A)),H.push(g(W));else{const X=g(W),_=H[H.length-1];(Math.abs(X.x-_.x)>.001||Math.abs(X.y-_.y)>.001)&&H.push(X)}E=W}}const I=H[H.length-1];(Math.abs(n.x-I.x)>.001||Math.abs(n.y-I.y)>.001)&&H.push(n);const V=[H[0]];for(let P=1;P<H.length;P++){const $=V[V.length-1],W=H[P];(Math.abs(W.x-$.x)>.001||Math.abs(W.y-$.y)>.001)&&V.push(W)}return V},Nt=(e,n,s)=>{const{materialThickness:i,fingerLength:o,minDistance:l}=s,a=n-2*i;if(a<=0)return{axis:e,points:[],innerOffset:0,fingerLength:0,maxJointLength:0};const r=a-2*l;if(r<o)return{axis:e,points:[],innerOffset:l,fingerLength:0,maxJointLength:a};let c=Math.floor(r/o);c%2===0&&(c=c-1),c<1&&(c=1);const f=r/c,u=l,d=[];for(let m=1;m<c;m++)d.push(u+m*f);return{axis:e,points:d,innerOffset:u,fingerLength:f,maxJointLength:a}},wn=e=>{const n={materialThickness:e.materialThickness,fingerLength:e.fingerWidth,minDistance:e.fingerGap*e.fingerWidth};return{x:Nt("x",e.width,n),y:Nt("y",e.height,n),z:Nt("z",e.depth,n)}},jn=(e,n)=>({front:{top:"top",bottom:"bottom",left:"left",right:"right"},back:{top:"top",bottom:"bottom",left:"right",right:"left"},left:{top:"top",bottom:"bottom",left:"back",right:"front"},right:{top:"top",bottom:"bottom",left:"front",right:"back"},top:{top:"back",bottom:"front",left:"left",right:"right"},bottom:{top:"front",bottom:"back",left:"left",right:"right"}})[e][n],os=(e,n)=>{const s=Ht(e,n.assemblyAxis);return s?n.lids[s].tabDirection==="tabs-out"?"male":"female":null},Sn=(e,n,s,i)=>{const o=jn(e,n),l=s.find(u=>u.id===o);if(!(l!=null&&l.solid))return null;const a=Qe(e,i.assemblyAxis),r=Qe(o,i.assemblyAxis);if(a==="lid")return os(e,i);if(r==="lid"){const u=os(o,i);if(u)return u==="male"?"female":"male"}const c=xt(e),f=xt(o);return c<f?"male":"female"},Ms=(e,n,s,i,o)=>{const{width:l,height:a,depth:r,materialThickness:c}=s,f=c,u=Kt(e,n);let d,m;switch(u){case"x":{const b=l-2*f;d=i?0:-f,m=o?b:b+f;break}case"y":{const b=a-2*f;d=i?0:-f,m=o?b:b+f;break}case"z":{const b=r-2*f;d=i?0:-f,m=o?b:b+f;break}}return n==="bottom"||n==="right"?{startPos:m,endPos:d}:{startPos:d,endPos:m}},Cs=e=>{switch(e){case"top":return{x:0,y:1};case"bottom":return{x:0,y:-1};case"left":return{x:-1,y:0};case"right":return{x:1,y:0}}},At=(e,n)=>{switch(e){case"front":case"back":return{width:n.width,height:n.height};case"left":case"right":return{width:n.depth,height:n.height};case"top":case"bottom":return{width:n.width,height:n.depth}}},ss=e=>{switch(e){case"front":return[{adjacentFaceId:"top",isHorizontal:!0,position:"top"},{adjacentFaceId:"bottom",isHorizontal:!0,position:"bottom"},{adjacentFaceId:"left",isHorizontal:!1,position:"left"},{adjacentFaceId:"right",isHorizontal:!1,position:"right"}];case"back":return[{adjacentFaceId:"top",isHorizontal:!0,position:"top"},{adjacentFaceId:"bottom",isHorizontal:!0,position:"bottom"},{adjacentFaceId:"right",isHorizontal:!1,position:"left"},{adjacentFaceId:"left",isHorizontal:!1,position:"right"}];case"left":return[{adjacentFaceId:"top",isHorizontal:!0,position:"top"},{adjacentFaceId:"bottom",isHorizontal:!0,position:"bottom"},{adjacentFaceId:"back",isHorizontal:!1,position:"left"},{adjacentFaceId:"front",isHorizontal:!1,position:"right"}];case"right":return[{adjacentFaceId:"top",isHorizontal:!0,position:"top"},{adjacentFaceId:"bottom",isHorizontal:!0,position:"bottom"},{adjacentFaceId:"front",isHorizontal:!1,position:"left"},{adjacentFaceId:"back",isHorizontal:!1,position:"right"}];case"top":return[{adjacentFaceId:"back",isHorizontal:!0,position:"top"},{adjacentFaceId:"front",isHorizontal:!0,position:"bottom"},{adjacentFaceId:"left",isHorizontal:!1,position:"left"},{adjacentFaceId:"right",isHorizontal:!1,position:"right"}];case"bottom":return[{adjacentFaceId:"front",isHorizontal:!0,position:"top"},{adjacentFaceId:"back",isHorizontal:!0,position:"bottom"},{adjacentFaceId:"left",isHorizontal:!1,position:"left"},{adjacentFaceId:"right",isHorizontal:!1,position:"right"}]}},Ot=(e,n,s,i)=>[{position:"top",status:e?"outward-only":"unlocked"},{position:"bottom",status:n?"outward-only":"unlocked"},{position:"left",status:s?"outward-only":"unlocked"},{position:"right",status:i?"outward-only":"unlocked"}],Es=(e,n,s)=>ss(e).map(o=>{const l=n.find(f=>f.id===o.adjacentFaceId);if(!((l==null?void 0:l.solid)??!1))return{position:o.position,adjacentFaceId:o.adjacentFaceId,status:"unlocked"};const r=gt(e,o.adjacentFaceId,s);let c;return r===!0?c="locked":r===!1?c="outward-only":c="unlocked",{position:o.position,adjacentFaceId:o.adjacentFaceId,status:c}}),gt=(e,n,s)=>{const i=Qe(e,s.assemblyAxis),o=Qe(n,s.assemblyAxis);if(i==="wall"&&o==="wall")return xt(e)<xt(n);if(i==="lid"){const l=Ht(e,s.assemblyAxis);return l?s.lids[l].tabDirection==="tabs-out":!1}if(o==="lid"){const l=Ht(n,s.assemblyAxis);return l?s.lids[l].inset>0?null:s.lids[l].tabDirection==="tabs-in":!1}return!1},An=(e,n,s)=>{const{width:i,height:o,depth:l,materialThickness:a,assembly:r}=n,c=i*s/2,f=o*s/2,u=l*s/2,d=a*s,m=x=>(r.lids[x].inset||0)*s;switch(e){case"front":return{position:[0,0,u-d/2],rotation:[0,0,0]};case"back":return{position:[0,0,-u+d/2],rotation:[0,Math.PI,0]};case"left":return{position:[-c+d/2,0,0],rotation:[0,-Math.PI/2,0]};case"right":return{position:[c-d/2,0,0],rotation:[0,Math.PI/2,0]};case"top":return{position:[0,f-d/2-m("positive"),0],rotation:[-Math.PI/2,0,0]};case"bottom":return{position:[0,-f+d/2+m("negative"),0],rotation:[Math.PI/2,0,0]}}},In=(e,n,s,i,o)=>{const{height:l,width:a,inset:r}=i,c=s-o,f=c-l,u=e-r,d=u-a,m=n+r+a,x=n+r,b=[];return b.push({x:u,y:s}),b.push({x:u,y:f}),b.push({x:d,y:f}),b.push({x:d,y:c}),b.push({x:m,y:c}),b.push({x:m,y:f}),b.push({x,y:f}),b.push({x,y:s}),b},kn=(e,n,s,i=Ue,o,l,a,r)=>{const c=At(e,s),f=ss(e),{materialThickness:u,fingerWidth:d,fingerGap:m,assembly:x}=s,b=c.width/2,h=c.height/2,y=I=>{const V=f.find(X=>X.position===I),P=n.find(X=>X.id===V.adjacentFaceId),$=(P==null?void 0:P.solid)??!1,W=gt(e,V.adjacentFaceId,x);return $&&W===!0},p=I=>{const V=f.find($=>$.position===I),P=n.find($=>$.id===V.adjacentFaceId);return!((P==null?void 0:P.solid)??!1)},A=I=>{const V=f.find($=>$.position===I),P=n.find($=>$.id===V.adjacentFaceId);return(P==null?void 0:P.solid)??!1},j=y("top"),N=y("bottom"),C=y("left"),v=y("right"),k=A("top"),g=A("bottom"),w=A("left"),B=A("right"),S=(I,V)=>{const P=p(I),$=y(I);return P||!$&&V>0?V:0},F=S("top",i.top),L=S("bottom",i.bottom),D=S("left",i.left),R=S("right",i.right),T={topLeft:{x:-b+(C?u:0),y:h-(j?u:0)},topRight:{x:b-(v?u:0),y:h-(j?u:0)},bottomRight:{x:b-(v?u:0),y:-h+(N?u:0)},bottomLeft:{x:-b+(C?u:0),y:-h+(N?u:0)}},H={topLeft:{x:-b+(w&&C?u:0)-D,y:h-(k&&j?u:0)+F},topRight:{x:b-(B&&v?u:0)+R,y:h-(k&&j?u:0)+F},bottomRight:{x:b-(B&&v?u:0)+R,y:-h+(g&&N?u:0)-L},bottomLeft:{x:-b+(w&&C?u:0)-D,y:-h+(g&&N?u:0)-L}},G=[{start:H.topLeft,end:H.topRight,fingerStart:T.topLeft,fingerEnd:T.topRight,edgeInfo:f.find(I=>I.position==="top"),startExt:{perpendicular:D,parallel:F},endExt:{perpendicular:R,parallel:F}},{start:H.topRight,end:H.bottomRight,fingerStart:T.topRight,fingerEnd:T.bottomRight,edgeInfo:f.find(I=>I.position==="right"),startExt:{perpendicular:F,parallel:R},endExt:{perpendicular:L,parallel:R}},{start:H.bottomRight,end:H.bottomLeft,fingerStart:T.bottomRight,fingerEnd:T.bottomLeft,edgeInfo:f.find(I=>I.position==="bottom"),startExt:{perpendicular:R,parallel:L},endExt:{perpendicular:D,parallel:L}},{start:H.bottomLeft,end:H.topLeft,fingerStart:T.bottomLeft,fingerEnd:T.topLeft,edgeInfo:f.find(I=>I.position==="left"),startExt:{perpendicular:L,parallel:D},endExt:{perpendicular:F,parallel:D}}],E=[];for(const{start:I,end:V,fingerStart:P,fingerEnd:$,edgeInfo:W,startExt:X,endExt:_}of G){const Z=n.find(ne=>ne.id===W.adjacentFaceId),K=(Z==null?void 0:Z.solid)??!1,J=A(W.position),Q=X.parallel>0||_.parallel>0;X.parallel>0?X.parallel:_.parallel;let se;if(l&&K&&J&&!Q){const ne=Sn(e,W.position,n,x);if(ne!==null){const z=Kt(e,W.position),U=l[z],M=Cs(W.position),Y=W.position==="top"||W.position==="bottom";let ee,te;Y?(ee=C,te=v):(ee=N,te=j);const{startPos:q,endPos:je}=Ms(e,W.position,s,ee,te),pe=Ps(P,$,{fingerPoints:U,gender:ne,materialThickness:u,edgeStartPos:q,edgeEndPos:je,yUp:!0,outwardDirection:M}),oe=[],ae=Math.abs(I.x-P.x),ie=Math.abs(I.y-P.y);(ae>.01||ie>.01)&&oe.push(I),oe.push(...pe);const ce=Math.abs(V.x-$.x),Se=Math.abs(V.y-$.y);(ce>.01||Se>.01)&&oe.push(V),se=oe}else se=[I,V]}else Q?se=[I,V]:se=[I,V];if(E.length===0)for(let ne=0;ne<se.length;ne++)E.push(se[ne]);else{const ne=E[E.length-1],z=se[0],U=.001;Math.abs(ne.x-z.x)<U&&Math.abs(ne.y-z.y)<U||E.push(z);for(let Y=1;Y<se.length;Y++)E.push(se[Y])}}if(a==="bottom"&&r){const I=T.bottomRight.y,V=T.bottomRight.x,P=T.bottomLeft.x;let $=-1,W=-1;const X=.1;for(let _=0;_<E.length;_++){const Z=E[_];Math.abs(Z.y-I)<X&&(Math.abs(Z.x-V)<X&&$===-1&&($=_),Math.abs(Z.x-P)<X&&(W=_))}if($!==-1&&W!==-1&&$<W){const _=In(V,P,I,r,u),Z=E.slice(0,$),K=E.slice(W+1);E.length=0,E.push(...Z),E.push(..._),E.push(...K)}}return E},Nn=(e,n,s,i,o,l)=>{const a=[],{materialThickness:r,fingerWidth:c,fingerGap:f,width:u,height:d,depth:m,assembly:x}=i,b=et(s),h=w=>{var B;return((B=n.find(S=>S.id===w))==null?void 0:B.solid)??!1},y=.01,p=w=>x.lids[w].inset||0,A=x.assemblyAxis==="y"?p("positive"):0,j=x.assemblyAxis==="y"?p("negative"):0,N=x.assemblyAxis==="x"?p("negative"):0,C=x.assemblyAxis==="x"?p("positive"):0,v=x.assemblyAxis==="z"?p("positive"):0,k=x.assemblyAxis==="z"?p("negative"):0,g=w=>{if(!o)return Ue;const B=o.find(S=>S.id===`divider-${w}`);return(B==null?void 0:B.edgeExtensions)??Ue};for(const w of b){let B=null,S=null,F=0,L=!1,D=0,R=0,T=0,H=0,G=0;const{bounds:E,position:I,axis:V}=w,P=g(w.id),$=E.y<=j+y,W=E.y+E.h>=d-A-y,X=E.x<=N+y,_=E.x+E.w>=u-C-y,Z=E.z<=k+y,K=E.z+E.d>=m-v-y,J=(Q,se)=>se?0:P[Q];switch(e){case"front":K&&(V==="x"?(B=I-u/2,F=E.h,L=!1,G=E.y+E.h/2-d/2,D=$&&h("bottom")?r:0,R=W&&h("top")?r:0,T=J("bottom",$&&h("bottom")),H=J("top",W&&h("top"))):V==="y"&&(S=I-d/2,F=E.w,L=!0,G=E.x+E.w/2-u/2,D=X&&h("left")?r:0,R=_&&h("right")?r:0,T=J("left",X&&h("left")),H=J("right",_&&h("right"))));break;case"back":Z&&(V==="x"?(B=-(I-u/2),F=E.h,L=!1,G=E.y+E.h/2-d/2,D=$&&h("bottom")?r:0,R=W&&h("top")?r:0,T=J("bottom",$&&h("bottom")),H=J("top",W&&h("top"))):V==="y"&&(S=I-d/2,F=E.w,L=!0,G=-(E.x+E.w/2-u/2),D=X&&h("left")?r:0,R=_&&h("right")?r:0,T=J("left",X&&h("left")),H=J("right",_&&h("right"))));break;case"left":X&&(V==="z"?(B=I-m/2,F=E.h,L=!1,G=E.y+E.h/2-d/2,D=$&&h("bottom")?r:0,R=W&&h("top")?r:0,T=J("bottom",$&&h("bottom")),H=J("top",W&&h("top"))):V==="y"&&(S=I-d/2,F=E.d,L=!0,G=E.z+E.d/2-m/2,D=Z&&h("back")?r:0,R=K&&h("front")?r:0,T=J("left",Z&&h("back")),H=J("right",K&&h("front"))));break;case"right":_&&(V==="z"?(B=-(I-m/2),F=E.h,L=!1,G=E.y+E.h/2-d/2,D=$&&h("bottom")?r:0,R=W&&h("top")?r:0,T=J("bottom",$&&h("bottom")),H=J("top",W&&h("top"))):V==="y"&&(S=I-d/2,F=E.d,L=!0,G=-(E.z+E.d/2-m/2),D=K&&h("front")?r:0,R=Z&&h("back")?r:0,T=J("right",K&&h("front")),H=J("left",Z&&h("back"))));break;case"top":W&&(V==="x"?(B=I-u/2,F=E.d,L=!1,G=-(E.z+E.d/2-m/2),D=K&&h("front")?r:0,R=Z&&h("back")?r:0,T=J("right",K&&h("front")),H=J("left",Z&&h("back"))):V==="z"&&(S=-(I-m/2),F=E.w,L=!0,G=E.x+E.w/2-u/2,D=X&&h("left")?r:0,R=_&&h("right")?r:0,T=J("left",X&&h("left")),H=J("right",_&&h("right"))));break;case"bottom":$&&(V==="x"?(B=I-u/2,F=E.d,L=!1,G=E.z+E.d/2-m/2,D=Z&&h("back")?r:0,R=K&&h("front")?r:0,T=J("left",Z&&h("back")),H=J("right",K&&h("front"))):V==="z"&&(S=I-m/2,F=E.w,L=!0,G=E.x+E.w/2-u/2,D=X&&h("left")?r:0,R=_&&h("right")?r:0,T=J("left",X&&h("left")),H=J("right",_&&h("right"))));break}if(B!==null||S!==null){let Q,se;L?e==="left"||e==="right"?(Q="z",se=m):(Q="x",se=u):e==="top"||e==="bottom"?(Q="z",se=m):(Q="y",se=d);const ne=se-2*r;if(l&&l[Q]){const z=l[Q],{points:U,innerOffset:M,fingerLength:Y}=z;if(Y>0&&ne>2*M){let te,q;if(Q==="x"){const ie=E.x<=r+.01,ce=E.x+E.w>=u-r-.01;te=ie?D>0?0:-r:E.x-r,q=ce?R>0?ne:ne+r:E.x+E.w-r}else if(Q==="y"){const ie=E.y<=r+.01,ce=E.y+E.h>=d-r-.01;te=ie?D>0?0:-r:E.y-r,q=ce?R>0?ne:ne+r:E.y+E.h-r}else{const ie=E.z<=r+.01,ce=E.z+E.d>=m-r+.01;te=ie?D>0?0:-r:E.z-r,q=ce?R>0?ne:ne+r:E.z+E.d-r}te-=T,q+=H;const je=D>0?Math.max(0,te):te,pe=R>0?Math.min(ne,q):q,oe=[M,...U,ne-M];let ae=0;for(let ie=0;ie<oe.length-1;ie++)if(ie%2===0){const ce=oe[ie],Se=oe[ie+1];if(ce<je||Se>pe)continue;const Me=ce,Pe=Se,be=Me-ne/2,xe=Pe-ne/2;let de;if(L){const ue=S;de=[{x:be,y:ue-r/2},{x:xe,y:ue-r/2},{x:xe,y:ue+r/2},{x:be,y:ue+r/2}]}else{const ue=B;de=[{x:ue-r/2,y:be},{x:ue+r/2,y:be},{x:ue+r/2,y:xe},{x:ue-r/2,y:xe}]}a.push({id:`divider-slot-${w.id}-${ae}`,type:"slot",path:{points:de,closed:!0},source:{type:"divider-slot",sourceId:w.id}}),ae++}}}else{const z=F-D-R,U=F/2,M=c*f,Y=Math.max(D,R),ee=Math.max(0,M-Y),te=z-ee*2;if(te<c)continue;let q=Math.max(1,Math.floor(te/c));q%2===0&&q++;const je=te/q,pe=-U-T,oe=U+H,ae=-U+D+ee;for(let ie=0;ie<q;ie++)if(ie%2===0){const ce=ae+ie*je,Se=ce+je;if(Se<pe||ce>oe)continue;const Me=Math.max(ce,pe),Pe=Math.min(Se,oe);if(Pe-Me<.1)continue;const be=Me+G,xe=Pe+G;let de;if(L){const ue=S;de=[{x:be,y:ue-r/2},{x:xe,y:ue-r/2},{x:xe,y:ue+r/2},{x:be,y:ue+r/2}]}else{const ue=B;de=[{x:ue-r/2,y:be},{x:ue+r/2,y:be},{x:ue+r/2,y:xe},{x:ue-r/2,y:xe}]}a.push({id:`divider-slot-${w.id}-${ie}`,type:"slot",path:{points:de,closed:!0},source:{type:"divider-slot",sourceId:w.id}})}}}}return a},Pn=(e,n,s)=>{const i=[],{assembly:o,materialThickness:l,fingerWidth:a,fingerGap:r,width:c,height:f,depth:u}=s,d=x=>{var b;return((b=n.find(h=>h.id===x))==null?void 0:b.solid)??!1};if(Qe(e,o.assemblyAxis)!=="wall")return[];const m=At(e,s);for(const x of["positive","negative"]){const b=o.lids[x];if(b.tabDirection!=="tabs-out"||b.inset<=0)continue;let h,y,p,A=0,j=0;switch(o.assemblyAxis){case"y":x==="positive"?h=m.height/2-l/2-b.inset:h=-m.height/2+l/2+b.inset,p=!0,e==="front"||e==="back"?(y=c,A=d("left")?l:0,j=d("right")?l:0):(y=u,e==="left"?(A=d("back")?l:0,j=d("front")?l:0):(A=d("front")?l:0,j=d("back")?l:0));break;case"x":x==="positive"?h=m.width/2-l/2-b.inset:h=-m.width/2+l/2+b.inset,p=!1,y=f,A=d("bottom")?l:0,j=d("top")?l:0;break;case"z":e==="left"||e==="right"?(x==="positive"?h=m.width/2-l/2-b.inset:h=-m.width/2+l/2+b.inset,p=!1,y=f,A=d("bottom")?l:0,j=d("top")?l:0):(x==="positive"?h=m.height/2-l/2-b.inset:h=-m.height/2+l/2+b.inset,p=!0,y=c,A=d("left")?l:0,j=d("right")?l:0);break;default:continue}const N=y-A-j,C=y/2,v=a*r,k=Math.max(A,j),g=Math.max(0,v-k),w=N-g*2;if(w<a)continue;let B=Math.max(1,Math.floor(w/a));B%2===0&&B++;const S=w/B,F=-C+A+g;for(let L=0;L<B;L++)if(L%2===0){const D=F+L*S,R=D+S;let T;p?T=[{x:D,y:h-l/2},{x:R,y:h-l/2},{x:R,y:h+l/2},{x:D,y:h+l/2}]:T=[{x:h-l/2,y:D},{x:h+l/2,y:D},{x:h+l/2,y:R},{x:h-l/2,y:R}],i.push({id:`lid-slot-${x}-${L}`,type:"slot",path:{points:T,closed:!0},source:{type:"lid-slot",sourceId:x}})}}return i},Mn=(e,n,s,i,o)=>{const l=[];if(!o)return l;const{materialThickness:a,assembly:r}=s,c=At(e,s),f=ss(e),u=c.width/2,d=c.height/2;i.top,i.bottom,i.left,i.right;const m=p=>{const A=f.find(v=>v.position===p),j=n.find(v=>v.id===A.adjacentFaceId),N=(j==null?void 0:j.solid)??!1,C=gt(e,A.adjacentFaceId,r);return N&&C===!0},x=m("top"),b=m("bottom"),h=m("left"),y=m("right");for(const p of f){const A=p.position,j=n.find(X=>X.id===p.adjacentFaceId),N=(j==null?void 0:j.solid)??!1,C=i[A]??0,v=gt(e,p.adjacentFaceId,r),k=N&&(v===!1||v===null);if(C<=0||!N||!k)continue;const g=Kt(e,A),w=o[g];if(!w)continue;const{points:B,innerOffset:S,fingerLength:F}=w;if(F<=0)continue;const L=A==="top"||A==="bottom";let D,R;L?(D=h,R=y):(D=b,R=x);const{startPos:T,endPos:H}=Ms(e,A,s,D,R),G=Math.min(T,H),E=Math.max(T,H);let I;switch(A){case"top":I=d-a/2;break;case"bottom":I=-d+a/2;break;case"right":I=u-a/2;break;case"left":I=-u+a/2;break}let V;switch(g){case"x":V=s.width;break;case"y":V=s.height;break;case"z":V=s.depth;break}const P=V-2*a,$=[S,...B,P-S];let W=0;for(let X=0;X<$.length-1;X++)if(X%2===0){const _=$[X],Z=$[X+1];if(_<G||Z>E)continue;const K=_-P/2,J=Z-P/2;let Q;L?Q=[{x:K,y:I-a/2},{x:J,y:I-a/2},{x:J,y:I+a/2},{x:K,y:I+a/2}]:Q=[{x:I-a/2,y:K},{x:I+a/2,y:K},{x:I+a/2,y:J},{x:I-a/2,y:J}],l.push({id:`extension-slot-${e}-${A}-${W}`,type:"slot",path:{points:Q,closed:!0},source:{type:"extension-slot",sourceId:`${e}-${A}`}}),W++}}return l},Cn=(e,n,s,i,o=1,l,a,r)=>{const c=n.find(S=>S.id===e);if(!c||!c.solid)return null;const f=l??Ue,u=i.assembly.feet,d=Qe(e,i.assembly.assemblyAxis)==="wall",m=(u==null?void 0:u.enabled)&&u.height>0&&d&&(i.assembly.assemblyAxis==="y"||i.assembly.assemblyAxis==="x"),x=m?"bottom":null,b=m&&u?{height:u.height,width:u.width,inset:u.inset}:null,h=At(e,i),y=m&&u?i.materialThickness+u.height:0,p=m?{...f,bottom:(f.bottom??0)+y}:{...f},A=kn(e,n,i,f,a,r,x,b),j=Nn(e,n,s,i,a,r),N=Pn(e,n,i),C=Mn(e,n,i,p,r),{position:v,rotation:k}=An(e,i,o),g={type:"face",faceId:e},w=h.width+(f.left??0)+(f.right??0),B=h.height+(f.top??0)+(f.bottom??0)+y;return{id:`face-${e}`,source:g,outline:{points:A,closed:!0},holes:[...j,...N,...C],width:w,height:B,thickness:i.materialThickness,position:v,rotation:k,label:e.toUpperCase(),visible:!0,edgeExtensions:p}},En=(e,n,s,i)=>{const o=[],{materialThickness:l,fingerWidth:a,fingerGap:r,width:c,height:f,depth:u}=s,d=l,m=.01,{bounds:x,axis:b,position:h}=e,y=p=>{var A;return((A=i.find(j=>j.id===p))==null?void 0:A.solid)??!1};for(const p of n){if(p.id===e.id||p.axis===b)continue;let A=!1,j=0,N=0,C=0,v=0,k=!1;switch(b){case"y":if(p.axis==="x"){const g=p.bounds.y-d/2,w=p.bounds.y+p.bounds.h+d/2;(Math.abs(g-h)<m||Math.abs(w-h)<m)&&x.x<=p.position&&p.position<=x.x+x.w&&(A=!0,j=p.position-(x.x+x.w/2),N=p.bounds.d,C=y("back")&&p.bounds.z<=m?d:0,v=y("front")&&p.bounds.z+p.bounds.d>=u-m?d:0,k=!1)}else if(p.axis==="z"){const g=p.bounds.y-d/2,w=p.bounds.y+p.bounds.h+d/2;(Math.abs(g-h)<m||Math.abs(w-h)<m)&&x.z<=p.position&&p.position<=x.z+x.d&&(A=!0,j=p.position-(x.z+x.d/2),N=p.bounds.w,C=y("left")&&p.bounds.x<=m?d:0,v=y("right")&&p.bounds.x+p.bounds.w>=c-m?d:0,k=!0)}break;case"x":if(p.axis==="y"){const g=p.bounds.x-d/2,w=p.bounds.x+p.bounds.w+d/2;(Math.abs(g-h)<m||Math.abs(w-h)<m)&&x.y<=p.position&&p.position<=x.y+x.h&&(A=!0,j=p.position-(x.y+x.h/2),N=p.bounds.d,C=y("back")&&p.bounds.z<=m?d:0,v=y("front")&&p.bounds.z+p.bounds.d>=u-m?d:0,k=!0)}else if(p.axis==="z"){const g=p.bounds.x-d/2,w=p.bounds.x+p.bounds.w+d/2;(Math.abs(g-h)<m||Math.abs(w-h)<m)&&x.z<=p.position&&p.position<=x.z+x.d&&(A=!0,j=p.position-(x.z+x.d/2),N=p.bounds.h,C=y("bottom")&&p.bounds.y<=m?d:0,v=y("top")&&p.bounds.y+p.bounds.h>=f-m?d:0,k=!1)}break;case"z":if(p.axis==="x"){const g=p.bounds.z-d/2,w=p.bounds.z+p.bounds.d+d/2;(Math.abs(g-h)<m||Math.abs(w-h)<m)&&x.x<=p.position&&p.position<=x.x+x.w&&(A=!0,j=p.position-(x.x+x.w/2),N=p.bounds.h,C=y("bottom")&&p.bounds.y<=m?d:0,v=y("top")&&p.bounds.y+p.bounds.h>=f-m?d:0,k=!1)}else if(p.axis==="y"){const g=p.bounds.z-d/2,w=p.bounds.z+p.bounds.d+d/2;(Math.abs(g-h)<m||Math.abs(w-h)<m)&&x.y<=p.position&&p.position<=x.y+x.h&&(A=!0,j=p.position-(x.y+x.h/2),N=p.bounds.w,C=y("left")&&p.bounds.x<=m?d:0,v=y("right")&&p.bounds.x+p.bounds.w>=c-m?d:0,k=!0)}break}if(A&&N>0){const g=N-C-v,w=g/2,B=Math.max(C,v),F=Math.max(0,r-B/a)*a,L=g-F*2;if(L<a)continue;let D=Math.max(1,Math.floor(L/a));D%2===0&&D++;const R=L/D,T=(C-v)/2,H=-w+F+T;for(let G=0;G<D;G++)if(G%2===0){const E=H+G*R,I=E+R;let V;k?V=[{x:E,y:j-l/2},{x:I,y:j-l/2},{x:I,y:j+l/2},{x:E,y:j+l/2}]:V=[{x:j-l/2,y:E},{x:j+l/2,y:E},{x:j+l/2,y:I},{x:j-l/2,y:I}],o.push({id:`divider-slot-${e.id}-${p.id}-${G}`,type:"slot",path:{points:V,closed:!0},source:{type:"divider-slot",sourceId:p.id}})}}}return o},Vn=(e,n,s,i=1,o,l,a)=>{const{materialThickness:r,fingerWidth:c,fingerGap:f,width:u,height:d,depth:m,assembly:x}=s,{bounds:b,axis:h,position:y}=e,p=ke=>{var Ne;return((Ne=n.find(me=>me.id===ke))==null?void 0:Ne.solid)??!1},A=.01,j=o??Ue,N=ke=>x.lids[ke].inset||0,C=x.assemblyAxis==="y"?N("positive"):0,v=x.assemblyAxis==="y"?N("negative"):0,k=x.assemblyAxis==="x"?N("negative"):0,g=x.assemblyAxis==="x"?N("positive"):0,w=x.assemblyAxis==="z"?N("positive"):0,B=x.assemblyAxis==="z"?N("negative"):0,S=(ke,Ne,me,Ae)=>{if(!l)return!1;for(const ge of l){if(ge.id===e.id||ge.axis!==ke||Math.abs(ge.position-Ne)>A)continue;let He=!1;switch(Ae){case"x":He=ge.bounds.x<=me&&me<=ge.bounds.x+ge.bounds.w;break;case"y":He=ge.bounds.y<=me&&me<=ge.bounds.y+ge.bounds.h;break;case"z":He=ge.bounds.z<=me&&me<=ge.bounds.z+ge.bounds.d;break}if(He)return!0}return!1};let F,L,D,R,T,H,G,E,I,V;const P=r;switch(h){case"x":F=b.d,L=b.h,D=p("top")&&b.y+b.h>=d-C-A,R=p("bottom")&&b.y<=v+A,T=p("back")&&b.z<=B+A,H=p("front")&&b.z+b.d>=m-w-A,G=S("y",b.y+b.h+P/2,y,h),E=S("y",b.y-P/2,y,h),I=S("z",b.z-P/2,y,h),V=S("z",b.z+b.d+P/2,y,h);break;case"y":F=b.w,L=b.d,D=p("back")&&b.z<=B+A,R=p("front")&&b.z+b.d>=m-w-A,T=p("left")&&b.x<=k+A,H=p("right")&&b.x+b.w>=u-g-A,G=S("z",b.z-P/2,y,h),E=S("z",b.z+b.d+P/2,y,h),I=S("x",b.x-P/2,y,h),V=S("x",b.x+b.w+P/2,y,h);break;case"z":default:F=b.w,L=b.h,D=p("top")&&b.y+b.h>=d-C-A,R=p("bottom")&&b.y<=v+A,T=p("left")&&b.x<=k+A,H=p("right")&&b.x+b.w>=u-g-A,G=S("y",b.y+b.h+P/2,y,h),E=S("y",b.y-P/2,y,h),I=S("x",b.x-P/2,y,h),V=S("x",b.x+b.w+P/2,y,h);break}const $=D||G,W=R||E,X=T||I,_=H||V,Z=F/2,K=L/2,J=$?0:j.top,Q=W?0:j.bottom,se=X?0:j.left,ne=_?0:j.right,z={topLeft:{x:-Z+(T?r:0),y:K-(D?r:0)},topRight:{x:Z-(H?r:0),y:K-(D?r:0)},bottomRight:{x:Z-(H?r:0),y:-K+(R?r:0)},bottomLeft:{x:-Z+(T?r:0),y:-K+(R?r:0)}},U={topLeft:{x:z.topLeft.x-se,y:z.topLeft.y+J},topRight:{x:z.topRight.x+ne,y:z.topRight.y+J},bottomRight:{x:z.bottomRight.x+ne,y:z.bottomRight.y-Q},bottomLeft:{x:z.bottomLeft.x-se,y:z.bottomLeft.y-Q}},M=Math.abs(z.topRight.x-z.topLeft.x),Y=Math.abs(z.bottomRight.x-z.bottomLeft.x),ee=Math.abs(z.topLeft.y-z.bottomLeft.y),te=Math.abs(z.topRight.y-z.bottomRight.y),q=ke=>{const Ne=ke==="top"||ke==="bottom",me=r,Ae=.001,ge=u-2*me,He=d-2*me,lt=m-2*me,Ve=(he,Ie,ze,rt,Ze,Ee)=>{const Re=he<=me+Ae,at=he+Ie>=rt-me-Ae;let Je,ct;return Re?Je=Ze?0:-me:Je=he-me,at?ct=Ee?ze:ze+me:ct=he+Ie-me,{startPos:Je,endPos:ct}};switch(h){case"x":if(Ne){const{startPos:he,endPos:Ie}=Ve(b.z,b.d,lt,m,T,H);return{axis:"z",startPos:he,endPos:Ie}}else{const{startPos:he,endPos:Ie}=Ve(b.y,b.h,He,d,R,D);return{axis:"y",startPos:he,endPos:Ie}}case"y":if(Ne){const{startPos:he,endPos:Ie}=Ve(b.x,b.w,ge,u,T,H);return{axis:"x",startPos:he,endPos:Ie}}else{const{startPos:he,endPos:Ie}=Ve(b.z,b.d,lt,m,R,D);return{axis:"z",startPos:he,endPos:Ie}}case"z":default:if(Ne){const{startPos:he,endPos:Ie}=Ve(b.x,b.w,ge,u,T,H);return{axis:"x",startPos:he,endPos:Ie}}else{const{startPos:he,endPos:Ie}=Ve(b.y,b.h,He,d,R,D);return{axis:"y",startPos:he,endPos:Ie}}}},je=[{start:U.topLeft,end:U.topRight,hasTabs:$,position:"top",meetsFace:D,originalLength:M,patternOffset:X?0:-se,axisInfo:q("top")},{start:U.topRight,end:U.bottomRight,hasTabs:_,position:"right",meetsFace:H,originalLength:te,patternOffset:$?0:-J,axisInfo:q("right")},{start:U.bottomRight,end:U.bottomLeft,hasTabs:W,position:"bottom",meetsFace:R,originalLength:Y,patternOffset:_?0:-ne,axisInfo:q("bottom")},{start:U.bottomLeft,end:U.topLeft,hasTabs:X,position:"left",meetsFace:T,originalLength:ee,patternOffset:W?0:-Q,axisInfo:q("left")}],pe=[];for(const{start:ke,end:Ne,hasTabs:me,position:Ae,meetsFace:ge,originalLength:He,patternOffset:lt,axisInfo:Ve}of je){let he;if(me)if(ge&&a){const ze=a[Ve.axis],rt=Cs(Ae),Ze=Ae==="bottom"||Ae==="right";let Ee=0,Re=0;Ae==="top"||Ae==="bottom"?(Ee=se,Re=ne):(Ee=Q,Re=J);const at=Ve.startPos-Ee,Je=Ve.endPos+Re;he=Ps(ke,Ne,{fingerPoints:ze,gender:"male",materialThickness:r,edgeStartPos:Ze?Je:at,edgeEndPos:Ze?at:Je,yUp:!0,outwardDirection:rt})}else{const ze=Math.sqrt(Math.pow(Ne.x-ke.x,2)+Math.pow(Ne.y-ke.y,2)),Ze=Ae==="top"||Ae==="bottom"?Math.max(X?r:0,_?r:0):Math.max($?r:0,W?r:0),Ee=Math.max(0,f-Ze/c);he=vn(ke,Ne,{edgeLength:ze,fingerWidth:c,materialThickness:r,cornerGapMultiplier:Ee,originalLength:He,patternOffset:lt})}else he=[ke,Ne];const Ie=pe.length===0?0:1;for(let ze=Ie;ze<he.length;ze++)pe.push(he[ze])}let oe,ae;const ie=y*i,ce=u*i/2,Se=d*i/2,Me=m*i/2,Pe=(b.x+b.w/2)*i-ce,be=(b.y+b.h/2)*i-Se,xe=(b.z+b.d/2)*i-Me;switch(h){case"x":oe=[ie-ce,be,xe],ae=[0,Math.PI/2,0];break;case"y":oe=[Pe,ie-Se,xe],ae=[Math.PI/2,0,0];break;case"z":oe=[Pe,be,ie-Me],ae=[0,0,0];break}const de={type:"divider",subdivisionId:e.id,axis:h},ue=l?En(e,l,s,n):[];return{id:`divider-${e.id}`,source:de,outline:{points:pe,closed:!0},holes:ue,width:F,height:L,thickness:r,position:oe,rotation:ae,label:`DIV-${h.toUpperCase()}@${y.toFixed(1)}mm`,visible:!0,edgeExtensions:{...j}}},st=(e,n,s,i=1,o)=>{const l=[],a=wn(s),r=d=>{if(!o)return;const m=o.find(x=>x.id===d);return m==null?void 0:m.edgeExtensions},c=[],f=et(n);for(const d of f){const m=`divider-${d.id}`,x=Vn(d,e,s,i,r(m),f,a);c.push(x)}const u=["front","back","left","right","top","bottom"];for(const d of u){const m=`face-${d}`,x=Cn(d,e,n,s,i,r(m),c,a);x&&l.push(x)}for(const d of c)l.push(d);return{panels:l,augmentations:[],generatedAt:Date.now()}},Pt=()=>Math.random().toString(36).substr(2,9),zn=(e,n,s)=>({id:"root",bounds:{x:0,y:0,z:0,w:e,h:n,d:s},children:[]}),Ke=(e,n,s,i,o)=>{const l=i.lids.positive.inset,a=i.lids.negative.inset;if(l===0&&a===0)return{id:"root",bounds:{x:0,y:0,z:0,w:e,h:n,d:s},children:o||[]};let r,c=null,f=null;switch(i.assemblyAxis){case"y":r={x:0,y:a,z:0,w:e,h:n-l-a,d:s},l>0&&(c={x:0,y:n-l,z:0,w:e,h:l,d:s}),a>0&&(f={x:0,y:0,z:0,w:e,h:a,d:s});break;case"x":r={x:a,y:0,z:0,w:e-l-a,h:n,d:s},l>0&&(c={x:e-l,y:0,z:0,w:l,h:n,d:s}),a>0&&(f={x:0,y:0,z:0,w:a,h:n,d:s});break;case"z":r={x:0,y:0,z:a,w:e,h:n,d:s-l-a},l>0&&(c={x:0,y:0,z:s-l,w:e,h:n,d:l}),a>0&&(f={x:0,y:0,z:0,w:e,h:n,d:a});break}const u=[];return f&&u.push({id:"lid-inset-negative",bounds:f,children:[],lidInsetSide:"negative"}),u.push({id:"main-interior",bounds:r,children:o||[],isMainInterior:!0}),c&&u.push({id:"lid-inset-positive",bounds:c,children:[],lidInsetSide:"positive"}),{id:"root",bounds:{x:0,y:0,z:0,w:e,h:n,d:s},children:u}},yt=e=>e.children.find(s=>s.isMainInterior)||e,Mt=e=>{const n=e.children.find(s=>s.isMainInterior);return n?n.children:e.children.filter(s=>!s.lidInsetSide)},Fn=()=>[{id:"front",solid:!0},{id:"back",solid:!0},{id:"left",solid:!0},{id:"right",solid:!0},{id:"top",solid:!0},{id:"bottom",solid:!0}],_e=(e,n)=>{if(e.id===n)return e;for(const s of e.children){const i=_e(s,n);if(i)return i}if(e.subAssembly){const s=_e(e.subAssembly.rootVoid,n);if(s)return s}return null},ot=(e,n)=>{for(const s of e.children){if(s.id===n)return e;const i=ot(s,n);if(i)return i}if(e.subAssembly){if(e.subAssembly.rootVoid.id===n)return e.subAssembly.rootVoid;const s=ot(e.subAssembly.rootVoid,n);if(s)return s}return null},vt=(e,n,s)=>{if(e.children.length===0)return{...e,bounds:{...n}};const i=e.children.find(d=>d.splitAxis);if(!i||!i.splitAxis)return{...e,bounds:{...n},children:e.children.map(d=>d.lidInsetSide||d.isMainInterior?d:vt(d,d.bounds,s))};const o=i.splitAxis,l=s,a=o==="x"?n.x:o==="y"?n.y:n.z,r=o==="x"?n.w:o==="y"?n.h:n.d,c=a+r,f=[],u=[];for(let d=0;d<e.children.length;d++){const m=e.children[d];if(m.splitAxis&&m.splitPosition!==void 0){let x;if(m.splitPositionMode==="percentage"&&m.splitPercentage!==void 0)x=a+m.splitPercentage*r;else{const b=(u.length>0?u[u.length-1]:a)+l,h=c-l;x=Math.max(b,Math.min(h,m.splitPosition))}u.push(x)}}for(let d=0;d<e.children.length;d++){const m=e.children[d],x=d===0?a:u[d-1]+l/2,h=(d===e.children.length-1?c:u[d]-l/2)-x;let y;switch(o){case"x":y={...n,x,w:h};break;case"y":y={...n,y:x,h};break;case"z":y={...n,z:x,d:h};break}const p=vt({...m,splitPosition:d>0?u[d-1]:m.splitPosition},y,s);f.push(p)}return{...e,bounds:{...n},children:f}},Vs=e=>e.children.length===0?[e]:e.children.flatMap(Vs),it=e=>{const n=[e.id];for(const s of e.children)n.push(...it(s));return n},Wt=(e,n,s,i)=>!s.has(e),Ln=(e,n,s)=>!n.has(e),et=e=>{const n=[],s=(i,o)=>{i.splitAxis&&i.splitPosition!==void 0&&n.push({id:i.id+"-split",axis:i.splitAxis,position:i.splitPosition,bounds:o,positionMode:i.splitPositionMode,percentage:i.splitPercentage});for(const l of i.children)s(l,i.bounds)};for(const i of e.children)s(i,e.bounds);return n},nt=(e,n,s)=>{const i=[];for(let o=1;o<=s;o++){const l=o/(s+1);switch(n){case"x":i.push(e.x+l*e.w);break;case"y":i.push(e.y+l*e.h);break;case"z":i.push(e.z+l*e.d);break}}return i},Ut=e=>({...e,bounds:{...e.bounds},children:e.children.map(Ut),subAssembly:e.subAssembly?{...e.subAssembly,faces:e.subAssembly.faces.map(n=>({...n})),rootVoid:Ut(e.subAssembly.rootVoid)}:void 0}),_t=(e,n)=>{var s;if(((s=e.subAssembly)==null?void 0:s.id)===n)return{void:e,subAssembly:e.subAssembly};for(const i of e.children){const o=_t(i,n);if(o)return o}if(e.subAssembly){const i=_t(e.subAssembly.rootVoid,n);if(i)return i}return null},Ge=e=>{const n=[],s=i=>{i.subAssembly&&(n.push({voidId:i.id,subAssembly:i.subAssembly,bounds:i.bounds}),s(i.subAssembly.rootVoid));for(const o of i.children)s(o)};return s(e),n},Oe=(e,n,s)=>e.id===n?s(Ut(e)):{...e,bounds:{...e.bounds},children:e.children.map(i=>Oe(i,n,s)),subAssembly:e.subAssembly?{...e.subAssembly,rootVoid:Oe(e.subAssembly.rootVoid,n,s)}:void 0},le=Us((e,n)=>({config:{width:100,height:100,depth:100,materialThickness:3,fingerWidth:10,fingerGap:1.5,assembly:ws},faces:Fn(),rootVoid:zn(100,100,100),selectionMode:null,selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:"main",hoveredVoidId:null,hoveredPanelId:null,hoveredAssemblyId:null,subdivisionPreview:null,subAssemblyPreview:null,hiddenVoidIds:new Set,isolatedVoidId:null,isolateHiddenVoidIds:new Set,hiddenSubAssemblyIds:new Set,isolatedSubAssemblyId:null,isolateHiddenSubAssemblyIds:new Set,hiddenFaceIds:new Set,isolatedPanelId:null,isolateHiddenFaceIds:new Set,panelCollection:null,panelsDirty:!0,showDebugAnchors:!1,viewMode:"3d",sketchPanelId:null,setConfig:s=>e(i=>{const o={...i.config,...s},l=i.config,a=o.assembly.assemblyAxis!==l.assembly.assemblyAxis||o.assembly.lids.positive.inset!==l.assembly.lids.positive.inset||o.assembly.lids.negative.inset!==l.assembly.lids.negative.inset,r=o.width!==l.width||o.height!==l.height||o.depth!==l.depth;if(a)return{config:o,rootVoid:Ke(o.width,o.height,o.depth,o.assembly),selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null,subdivisionPreview:null,hiddenVoidIds:new Set,isolatedVoidId:null,isolateHiddenVoidIds:new Set,hiddenSubAssemblyIds:new Set,isolatedSubAssemblyId:null,isolateHiddenSubAssemblyIds:new Set,hiddenFaceIds:new Set,isolatedPanelId:null,isolateHiddenFaceIds:new Set,panelsDirty:!0};if(r){const c={x:0,y:0,z:0,w:o.width,h:o.height,d:o.depth},f=yt(i.rootVoid),u=f.id!==i.rootVoid.id;let d;if(u){const m=o.assembly.lids.positive.inset,x=o.assembly.lids.negative.inset,b=o.assembly.assemblyAxis;let h;switch(b){case"y":h={x:0,y:x,z:0,w:o.width,h:o.height-m-x,d:o.depth};break;case"x":h={x,y:0,z:0,w:o.width-m-x,h:o.height,d:o.depth};break;case"z":h={x:0,y:0,z:x,w:o.width,h:o.height,d:o.depth-m-x};break}const y=vt({...f,bounds:h},h,o.materialThickness);d=Ke(o.width,o.height,o.depth,o.assembly);const p=d.children.find(A=>A.isMainInterior);p&&(p.children=y.children)}else d=vt({...i.rootVoid,bounds:c},c,o.materialThickness);return{config:o,rootVoid:d,subdivisionPreview:null,panelsDirty:!0}}return{config:o,panelsDirty:!0}}),toggleFace:s=>e(i=>({faces:i.faces.map(o=>o.id===s?{...o,solid:!o.solid}:o),subdivisionPreview:null,panelsDirty:!0})),setSelectionMode:s=>e({selectionMode:s,selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null,subdivisionPreview:null}),selectVoid:(s,i=!1)=>e(o=>{if(s===null)return{selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null};const l=new Set(i?o.selectedVoidIds:[]);return l.has(s)?l.delete(s):l.add(s),i?{selectedVoidIds:l}:{selectedVoidIds:l,selectedSubAssemblyIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null}}),selectPanel:(s,i=!1)=>e(o=>{if(s===null)return{selectedPanelIds:new Set,selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedAssemblyId:null};const l=new Set(i?o.selectedPanelIds:[]);return l.has(s)?l.delete(s):l.add(s),i?{selectedPanelIds:l}:{selectedPanelIds:l,selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedAssemblyId:null}}),selectAssembly:s=>e({selectedAssemblyId:s,selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedPanelIds:new Set}),selectSubAssembly:(s,i=!1)=>e(o=>{if(s===null)return{selectedSubAssemblyIds:new Set,selectedVoidIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null};const l=new Set(i?o.selectedSubAssemblyIds:[]);return l.has(s)?l.delete(s):l.add(s),i?{selectedSubAssemblyIds:l}:{selectedSubAssemblyIds:l,selectedVoidIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null}}),clearSelection:()=>e({selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null}),setHoveredVoid:s=>e({hoveredVoidId:s}),setHoveredPanel:s=>e({hoveredPanelId:s}),setHoveredAssembly:s=>e({hoveredAssemblyId:s}),setSubdivisionPreview:s=>e({subdivisionPreview:s}),setSubAssemblyPreview:s=>e({subAssemblyPreview:s}),applySubdivision:()=>e(s=>{const i=s.subdivisionPreview;if(!i)return s;const o=_e(s.rootVoid,i.voidId);if(!o||o.children.length>0)return s;const{bounds:l}=o,{axis:a,count:r,positions:c}=i,f=s.config.materialThickness,u=[],d=a==="x"?l.w:a==="y"?l.h:l.d,m=a==="x"?l.x:a==="y"?l.y:l.z;for(let b=0;b<=r;b++){const h=b===0?m:c[b-1]+f/2,p=(b===r?m+d:c[b]-f/2)-h;let A,j,N;switch(a){case"x":A={...l,x:h,w:p},b>0&&(j=c[b-1],N=a);break;case"y":A={...l,y:h,h:p},b>0&&(j=c[b-1],N=a);break;case"z":A={...l,z:h,d:p},b>0&&(j=c[b-1],N=a);break}let C;j!==void 0&&(C=(j-m)/d),u.push({id:Pt(),bounds:A,children:[],splitAxis:N,splitPosition:j,splitPositionMode:j!==void 0?"percentage":void 0,splitPercentage:C})}return{rootVoid:Oe(s.rootVoid,i.voidId,b=>({...b,children:u})),selectedVoidIds:new Set,selectedPanelIds:new Set,subdivisionPreview:null,panelsDirty:!0}}),removeVoid:s=>e(i=>{const o=ot(i.rootVoid,s);return o?{rootVoid:Oe(i.rootVoid,o.id,a=>({...a,children:[]})),selectedVoidIds:new Set,selectedPanelIds:new Set,subdivisionPreview:null,panelsDirty:!0}:i}),resetVoids:()=>e(s=>({rootVoid:Ke(s.config.width,s.config.height,s.config.depth,s.config.assembly),selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null,subdivisionPreview:null,hiddenVoidIds:new Set,isolatedVoidId:null,isolateHiddenVoidIds:new Set,hiddenSubAssemblyIds:new Set,isolatedSubAssemblyId:null,isolateHiddenSubAssemblyIds:new Set,hiddenFaceIds:new Set,isolatedPanelId:null,isolateHiddenFaceIds:new Set,panelsDirty:!0})),createSubAssembly:(s,i)=>e(o=>{const l=_e(o.rootVoid,s);if(!l||l.children.length>0||l.subAssembly)return o;const a=(i==null?void 0:i.clearance)??2,r=(i==null?void 0:i.assemblyAxis)??"y",c=(i==null?void 0:i.faceOffsets)??{front:0,back:0,left:0,right:0,top:0,bottom:0},{bounds:f}=l,u=o.config.materialThickness,d=f.w-a*2+c.left+c.right,m=f.h-a*2+c.top+c.bottom,x=f.d-a*2+c.front+c.back,b=d-2*u,h=m-2*u,y=x-2*u;if(b<=0||h<=0||y<=0)return o;const p=[{id:"front",solid:!0},{id:"back",solid:!0},{id:"left",solid:!0},{id:"right",solid:!0},{id:"top",solid:!0},{id:"bottom",solid:!0}],A={id:Pt(),clearance:a,faceOffsets:c,faces:p,materialThickness:u,rootVoid:{id:"sub-root-"+Pt(),bounds:{x:0,y:0,z:0,w:b,h,d:y},children:[]},assembly:{assemblyAxis:r,lids:{positive:{enabled:!0,tabDirection:"tabs-out",inset:0},negative:{enabled:!0,tabDirection:"tabs-out",inset:0}}}};return{rootVoid:Oe(o.rootVoid,s,N=>({...N,subAssembly:A})),selectedVoidIds:new Set,selectedSubAssemblyIds:new Set([A.id]),subdivisionPreview:null,panelsDirty:!0}}),purgeVoid:s=>e(i=>({rootVoid:Oe(i.rootVoid,s,l=>({...l,children:[],subAssembly:void 0})),selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,subdivisionPreview:null,panelsDirty:!0})),toggleSubAssemblyFace:(s,i)=>e(o=>{if(!_t(o.rootVoid,s))return o;const a=r=>{var c;return((c=r.subAssembly)==null?void 0:c.id)===s?{...r,subAssembly:{...r.subAssembly,faces:r.subAssembly.faces.map(f=>f.id===i?{...f,solid:!f.solid}:f)}}:{...r,children:r.children.map(a),subAssembly:r.subAssembly?{...r.subAssembly,rootVoid:a(r.subAssembly.rootVoid)}:void 0}};return{rootVoid:a(o.rootVoid),panelsDirty:!0}}),setSubAssemblyClearance:(s,i)=>e(o=>{const l=a=>{var r;if(((r=a.subAssembly)==null?void 0:r.id)===s){const c=Math.max(0,i),f=a.subAssembly.materialThickness,u=a.subAssembly.faceOffsets||{left:0,right:0,top:0,bottom:0,front:0,back:0},d=a.bounds.w-c*2+u.left+u.right,m=a.bounds.h-c*2+u.top+u.bottom,x=a.bounds.d-c*2+u.front+u.back,b=d-2*f,h=m-2*f,y=x-2*f;return b<=0||h<=0||y<=0?a:{...a,subAssembly:{...a.subAssembly,clearance:c,rootVoid:{...a.subAssembly.rootVoid,bounds:{x:0,y:0,z:0,w:b,h,d:y},children:[]}}}}return{...a,children:a.children.map(l)}};return{rootVoid:l(o.rootVoid),panelsDirty:!0}}),removeSubAssembly:s=>e(i=>({rootVoid:Oe(i.rootVoid,s,l=>({...l,subAssembly:void 0})),selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,subdivisionPreview:null,panelsDirty:!0})),toggleVoidVisibility:s=>e(i=>{const o=new Set(i.hiddenVoidIds);return o.has(s)?o.delete(s):o.add(s),{hiddenVoidIds:o}}),setIsolatedVoid:s=>e(i=>{if(s===null){const h=new Set(i.hiddenVoidIds),y=new Set(i.hiddenFaceIds),p=new Set(i.hiddenSubAssemblyIds);for(const A of i.isolateHiddenVoidIds)h.delete(A);for(const A of i.isolateHiddenFaceIds)y.delete(A);for(const A of i.isolateHiddenSubAssemblyIds)p.delete(A);return{isolatedVoidId:null,hiddenVoidIds:h,isolateHiddenVoidIds:new Set,hiddenFaceIds:y,isolateHiddenFaceIds:new Set,hiddenSubAssemblyIds:p,isolateHiddenSubAssemblyIds:new Set}}const o=_e(i.rootVoid,s);if(!o)return i;const l=new Set(it(o)),a=it(i.rootVoid),r=new Set(i.hiddenVoidIds),c=new Set,f=new Set(i.hiddenFaceIds),u=new Set,d=new Set(i.hiddenSubAssemblyIds),m=new Set;for(const h of a)if(!l.has(h)&&!i.hiddenVoidIds.has(h)){r.add(h),c.add(h);const y=`divider-${h}-split`;i.hiddenFaceIds.has(y)||(f.add(y),u.add(y))}const x=["face-front","face-back","face-left","face-right","face-top","face-bottom"];for(const h of x)i.hiddenFaceIds.has(h)||(f.add(h),u.add(h));const b=Ge(i.rootVoid);for(const{subAssembly:h,voidId:y}of b)!l.has(y)&&!i.hiddenSubAssemblyIds.has(h.id)&&(d.add(h.id),m.add(h.id));return{isolatedVoidId:s,hiddenVoidIds:r,isolateHiddenVoidIds:c,hiddenFaceIds:f,isolateHiddenFaceIds:u,hiddenSubAssemblyIds:d,isolateHiddenSubAssemblyIds:m}}),toggleSubAssemblyVisibility:s=>e(i=>{const o=new Set(i.hiddenSubAssemblyIds);return o.has(s)?o.delete(s):o.add(s),{hiddenSubAssemblyIds:o}}),setIsolatedSubAssembly:s=>e(i=>{if(s===null){const x=new Set(i.hiddenVoidIds),b=new Set(i.hiddenFaceIds),h=new Set(i.hiddenSubAssemblyIds);for(const y of i.isolateHiddenVoidIds)x.delete(y);for(const y of i.isolateHiddenFaceIds)b.delete(y);for(const y of i.isolateHiddenSubAssemblyIds)h.delete(y);return{isolatedSubAssemblyId:null,hiddenVoidIds:x,isolateHiddenVoidIds:new Set,hiddenFaceIds:b,isolateHiddenFaceIds:new Set,hiddenSubAssemblyIds:h,isolateHiddenSubAssemblyIds:new Set}}const o=new Set(i.hiddenVoidIds),l=new Set,a=new Set(i.hiddenFaceIds),r=new Set,c=new Set(i.hiddenSubAssemblyIds),f=new Set,u=it(i.rootVoid);for(const x of u)if(!i.hiddenVoidIds.has(x)){o.add(x),l.add(x);const b=`divider-${x}-split`;i.hiddenFaceIds.has(b)||(a.add(b),r.add(b))}const d=["face-front","face-back","face-left","face-right","face-top","face-bottom"];for(const x of d)i.hiddenFaceIds.has(x)||(a.add(x),r.add(x));const m=Ge(i.rootVoid);for(const{subAssembly:x}of m)x.id!==s&&!i.hiddenSubAssemblyIds.has(x.id)&&(c.add(x.id),f.add(x.id));return{isolatedSubAssemblyId:s,hiddenVoidIds:o,isolateHiddenVoidIds:l,hiddenFaceIds:a,isolateHiddenFaceIds:r,hiddenSubAssemblyIds:c,isolateHiddenSubAssemblyIds:f}}),toggleFaceVisibility:s=>e(i=>{const o=new Set(i.hiddenFaceIds);return o.has(s)?o.delete(s):o.add(s),{hiddenFaceIds:o}}),setIsolatedPanel:s=>e(i=>{if(s===null){const h=new Set(i.hiddenVoidIds),y=new Set(i.hiddenFaceIds),p=new Set(i.hiddenSubAssemblyIds);for(const A of i.isolateHiddenVoidIds)h.delete(A);for(const A of i.isolateHiddenFaceIds)y.delete(A);for(const A of i.isolateHiddenSubAssemblyIds)p.delete(A);return{isolatedPanelId:null,hiddenVoidIds:h,isolateHiddenVoidIds:new Set,hiddenFaceIds:y,isolateHiddenFaceIds:new Set,hiddenSubAssemblyIds:p,isolateHiddenSubAssemblyIds:new Set}}const o=new Set(i.hiddenVoidIds),l=new Set,a=new Set(i.hiddenFaceIds),r=new Set,c=new Set(i.hiddenSubAssemblyIds),f=new Set,u=it(i.rootVoid);for(const h of u)i.hiddenVoidIds.has(h)||(o.add(h),l.add(h));const d=["face-front","face-back","face-left","face-right","face-top","face-bottom"];for(const h of d)h!==s&&!i.hiddenFaceIds.has(h)&&(a.add(h),r.add(h));const m=h=>{const y=[];for(const p of h.children)p.splitAxis&&y.push(`divider-${p.id}-split`),y.push(...m(p));return y},x=m(i.rootVoid);for(const h of x)h!==s&&!i.hiddenFaceIds.has(h)&&(a.add(h),r.add(h));const b=Ge(i.rootVoid);for(const{subAssembly:h}of b){i.hiddenSubAssemblyIds.has(h.id)||(c.add(h.id),f.add(h.id));for(const y of h.faces){const p=`subasm-${h.id}-face-${y.id}`;p!==s&&!i.hiddenFaceIds.has(p)&&(a.add(p),r.add(p))}}return{isolatedPanelId:s,hiddenVoidIds:o,isolateHiddenVoidIds:l,hiddenFaceIds:a,isolateHiddenFaceIds:r,hiddenSubAssemblyIds:c,isolateHiddenSubAssemblyIds:f}}),setAssemblyAxis:s=>e(i=>{const o={...i.config.assembly,assemblyAxis:s},l=Mt(i.rootVoid),a=Ke(i.config.width,i.config.height,i.config.depth,o,l);return{config:{...i.config,assembly:o},rootVoid:a,selectedVoidIds:new Set,selectedPanelIds:new Set,panelsDirty:!0}}),setLidTabDirection:(s,i)=>e(o=>{const l=i==="tabs-in"?0:o.config.assembly.lids[s].inset,a={...o.config.assembly,lids:{...o.config.assembly.lids,[s]:{...o.config.assembly.lids[s],tabDirection:i,inset:l}}},r=Mt(o.rootVoid),c=Ke(o.config.width,o.config.height,o.config.depth,a,r);return{config:{...o.config,assembly:a},rootVoid:c,panelsDirty:!0}}),setLidInset:(s,i)=>e(o=>{const l=Math.max(0,i),a={...o.config.assembly,lids:{...o.config.assembly.lids,[s]:{...o.config.assembly.lids[s],inset:l,tabDirection:l>0?"tabs-out":o.config.assembly.lids[s].tabDirection}}},r=Mt(o.rootVoid),c=Ke(o.config.width,o.config.height,o.config.depth,a,r);return{config:{...o.config,assembly:a},rootVoid:c,selectedVoidIds:new Set,selectedPanelIds:new Set,panelsDirty:!0}}),setFeetConfig:s=>e(i=>({config:{...i.config,assembly:{...i.config.assembly,feet:s}},panelsDirty:!0})),setSubAssemblyAxis:(s,i)=>e(o=>{const l=a=>{var r;return((r=a.subAssembly)==null?void 0:r.id)===s?{...a,subAssembly:{...a.subAssembly,assembly:{...a.subAssembly.assembly,assemblyAxis:i}}}:{...a,children:a.children.map(l),subAssembly:a.subAssembly?{...a.subAssembly,rootVoid:l(a.subAssembly.rootVoid)}:void 0}};return{rootVoid:l(o.rootVoid),panelsDirty:!0}}),setSubAssemblyLidTabDirection:(s,i,o)=>e(l=>{const a=r=>{var c;return((c=r.subAssembly)==null?void 0:c.id)===s?{...r,subAssembly:{...r.subAssembly,assembly:{...r.subAssembly.assembly,lids:{...r.subAssembly.assembly.lids,[i]:{...r.subAssembly.assembly.lids[i],tabDirection:o,inset:o==="tabs-in"?0:r.subAssembly.assembly.lids[i].inset}}}}}:{...r,children:r.children.map(a),subAssembly:r.subAssembly?{...r.subAssembly,rootVoid:a(r.subAssembly.rootVoid)}:void 0}};return{rootVoid:a(l.rootVoid),panelsDirty:!0}}),setSubAssemblyLidInset:(s,i,o)=>e(l=>{const a=r=>{var c;return((c=r.subAssembly)==null?void 0:c.id)===s?{...r,subAssembly:{...r.subAssembly,assembly:{...r.subAssembly.assembly,lids:{...r.subAssembly.assembly.lids,[i]:{...r.subAssembly.assembly.lids[i],inset:Math.max(0,o),tabDirection:o>0?"tabs-out":r.subAssembly.assembly.lids[i].tabDirection}}}}}:{...r,children:r.children.map(a),subAssembly:r.subAssembly?{...r.subAssembly,rootVoid:a(r.subAssembly.rootVoid)}:void 0}};return{rootVoid:a(l.rootVoid),panelsDirty:!0}}),generatePanels:()=>e(s=>{var l;const i=st(s.faces,s.rootVoid,s.config,1,(l=s.panelCollection)==null?void 0:l.panels),o=Ge(s.rootVoid);for(const{subAssembly:a,bounds:r}of o){const c={width:a.rootVoid.bounds.w,height:a.rootVoid.bounds.h,depth:a.rootVoid.bounds.d,materialThickness:a.materialThickness,fingerWidth:s.config.fingerWidth,fingerGap:s.config.fingerGap,assembly:a.assembly},f=st(a.faces,a.rootVoid,c,1),u=s.config.width/2,d=s.config.height/2,m=s.config.depth/2,x=c.width+2*a.materialThickness,b=c.height+2*a.materialThickness,h=c.depth+2*a.materialThickness,y=a.faceOffsets||{left:0,bottom:0,back:0},p=r.x+a.clearance-y.left+x/2,A=r.y+a.clearance-y.bottom+b/2,j=r.z+a.clearance-y.back+h/2,N=p-u,C=A-d,v=j-m;for(const k of f.panels){const g={...k,id:`subasm-${a.id}-${k.id}`,source:{...k.source,subAssemblyId:a.id},position:[k.position[0]+N,k.position[1]+C,k.position[2]+v]};i.panels.push(g)}}return{panelCollection:i,panelsDirty:!1}}),clearPanels:()=>e({panelCollection:null,panelsDirty:!0}),updatePanelPath:(s,i)=>e(o=>o.panelCollection?{panelCollection:{...o.panelCollection,panels:o.panelCollection.panels.map(l=>l.id===s?{...l,...i}:l)}}:o),addPanelHole:(s,i)=>e(o=>o.panelCollection?{panelCollection:{...o.panelCollection,panels:o.panelCollection.panels.map(l=>l.id===s?{...l,holes:[...l.holes,i]}:l)}}:o),removePanelHole:(s,i)=>e(o=>o.panelCollection?{panelCollection:{...o.panelCollection,panels:o.panelCollection.panels.map(l=>l.id===s?{...l,holes:l.holes.filter(a=>a.id!==i)}:l)}}:o),addAugmentation:s=>e(i=>{if(!i.panelCollection)return i;const o=[...i.panelCollection.augmentations,s],l=i.panelCollection.panels.map(a=>a.id===s.panelId?{...a,holes:[...a.holes,s.hole]}:a);return{panelCollection:{...i.panelCollection,panels:l,augmentations:o}}}),removeAugmentation:s=>e(i=>{if(!i.panelCollection)return i;const o=i.panelCollection.augmentations.find(r=>r.id===s);if(!o)return i;const l=i.panelCollection.augmentations.filter(r=>r.id!==s),a=i.panelCollection.panels.map(r=>r.id===o.panelId?{...r,holes:r.holes.filter(c=>c.id!==o.hole.id)}:r);return{panelCollection:{...i.panelCollection,panels:a,augmentations:l}}}),togglePanelVisibility:s=>e(i=>i.panelCollection?{panelCollection:{...i.panelCollection,panels:i.panelCollection.panels.map(o=>o.id===s?{...o,visible:!o.visible}:o)}}:i),setEdgeExtension:(s,i,o)=>e(l=>{if(!l.panelCollection)return l;const a=l.panelCollection.panels.map(c=>c.id===s?{...c,edgeExtensions:{...c.edgeExtensions||Ue,[i]:o}}:c);return{panelCollection:st(l.faces,l.rootVoid,l.config,1,a)}}),setDividerPosition:(s,i)=>e(o=>{var v;const l=o.config.materialThickness,a=s.replace("-split",""),r=_e(o.rootVoid,a);if(!r||!r.splitPosition||!r.splitAxis)return o;const c=ot(o.rootVoid,a);if(!c)return o;const f=r.splitAxis,u=c.children.findIndex(k=>k.id===a);if(u===-1)return o;const d=f==="x"?c.bounds.x:f==="y"?c.bounds.y:c.bounds.z,m=f==="x"?c.bounds.x+c.bounds.w:f==="y"?c.bounds.y+c.bounds.h:c.bounds.z+c.bounds.d,x=u>0?c.children[u-1]:null,b=x!=null&&x.splitPosition?x.splitPosition+l+1:d+l/2+1,h=u<c.children.length-1?c.children[u+1]:null,y=h!=null&&h.splitPosition?h.splitPosition-l-1:m-l/2-1,p=Math.max(b,Math.min(y,i)),A=k=>{if(k.id===c.id){const g=f==="x"?c.bounds.w:f==="y"?c.bounds.h:c.bounds.d,w=c.children.map(S=>{if(S.id===a){const F=(p-d)/g;return{...S,splitPosition:p,splitPercentage:F}}return S}),B=w.map((S,F)=>{const L=F===0?d:(w[F-1].splitPosition??d)+l/2,R=(S.splitPosition?S.splitPosition-l/2:m)-L;let T;switch(f){case"x":T={...S.bounds,x:L,w:R};break;case"y":T={...S.bounds,y:L,h:R};break;case"z":T={...S.bounds,z:L,d:R};break}let H=S.children;return S.children.length>0&&(H=j(S.children,T,S.splitAxis)),{...S,bounds:T,children:H}});return{...k,children:B}}return{...k,children:k.children.map(A)}},j=(k,g,w)=>{if(!w||k.length===0)return k;const B=w==="x"?g.x:w==="y"?g.y:g.z,S=w==="x"?g.x+g.w:w==="y"?g.y+g.h:g.z+g.d;return k.map((F,L)=>{const D=L===0?B:(k[L-1].splitPosition??B)+l/2,T=(F.splitPosition?F.splitPosition-l/2:S)-D;let H;switch(w){case"x":H={...g,x:D,w:T};break;case"y":H={...g,y:D,h:T};break;case"z":H={...g,z:D,d:T};break}const G=F.children.length>0?j(F.children,H,F.splitAxis):F.children;return{...F,bounds:H,children:G}})},N=A(o.rootVoid),C=st(o.faces,N,o.config,1,(v=o.panelCollection)==null?void 0:v.panels);return{rootVoid:N,panelCollection:C}}),setDividerPositionMode:(s,i)=>e(o=>{const l=s.replace("-split",""),a=_e(o.rootVoid,l);if(!a||!a.splitPosition||!a.splitAxis)return o;const r=ot(o.rootVoid,l);if(!r)return o;const c=a.splitAxis,f=c==="x"?r.bounds.x:c==="y"?r.bounds.y:r.bounds.z,u=c==="x"?r.bounds.w:c==="y"?r.bounds.h:r.bounds.d,d=(a.splitPosition-f)/u;return{rootVoid:Oe(o.rootVoid,l,x=>({...x,splitPositionMode:i,splitPercentage:d})),panelsDirty:!0}}),loadFromUrl:()=>{var r;const s=gn();if(!s)return!1;const i=n(),o=s.edgeExtensions,l=(r=i.panelCollection)==null?void 0:r.panels.map(c=>({...c,edgeExtensions:o[c.id]??Ue})),a=st(s.faces,s.rootVoid,s.config,1,l);return a&&Object.keys(o).length>0&&(a.panels=a.panels.map(c=>({...c,edgeExtensions:o[c.id]??c.edgeExtensions}))),e({config:s.config,faces:s.faces,rootVoid:s.rootVoid,panelCollection:a,panelsDirty:!1,selectedVoidIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null,selectedSubAssemblyIds:new Set}),!0},saveToUrl:()=>{const s=n(),i={};if(s.panelCollection)for(const l of s.panelCollection.panels)l.edgeExtensions&&(l.edgeExtensions.top!==0||l.edgeExtensions.bottom!==0||l.edgeExtensions.left!==0||l.edgeExtensions.right!==0)&&(i[l.id]=l.edgeExtensions);const o={config:s.config,faces:s.faces,rootVoid:s.rootVoid,edgeExtensions:i};xn(o)},getShareableUrl:()=>{const s=n(),i={};if(s.panelCollection)for(const l of s.panelCollection.panels)l.edgeExtensions&&(l.edgeExtensions.top!==0||l.edgeExtensions.bottom!==0||l.edgeExtensions.left!==0||l.edgeExtensions.right!==0)&&(i[l.id]=l.edgeExtensions);const o={config:s.config,faces:s.faces,rootVoid:s.rootVoid,edgeExtensions:i};return yn(o)},toggleDebugAnchors:()=>e(s=>({showDebugAnchors:!s.showDebugAnchors})),setViewMode:s=>e({viewMode:s}),enterSketchView:s=>e({viewMode:"2d",sketchPanelId:s,selectedPanelIds:new Set([s]),selectedVoidIds:new Set,selectedSubAssemblyIds:new Set,selectedAssemblyId:null}),exitSketchView:()=>e({viewMode:"3d",sketchPanelId:null})})),We=({title:e,children:n,className:s=""})=>t.jsxs("div",{className:`panel ${s}`,children:[t.jsx("h3",{className:"panel-title",children:e}),t.jsx("div",{className:"panel-content",children:n})]}),zs={front:"Front",back:"Back",left:"Left",right:"Right",top:"Top",bottom:"Bottom"},Dn=e=>{const n=[];for(const s of e.children)if(s.splitAxis&&s.splitPosition!==void 0){let i,o;switch(s.splitAxis){case"x":i=e.bounds.d,o=e.bounds.h;break;case"y":i=e.bounds.w,o=e.bounds.d;break;case"z":i=e.bounds.w,o=e.bounds.h;break}n.push({id:`divider-${s.id}-split`,axis:s.splitAxis,position:s.splitPosition,width:i,height:o})}return n},Fs=({panel:e,depth:n,selectedPanelIds:s,onSelectPanel:i,hoveredPanelId:o,onHoverPanel:l,hiddenFaceIds:a,isolatedPanelId:r,onToggleFaceVisibility:c,onSetIsolatedPanel:f})=>{const u=s.has(e.id),d=o===e.id,m=a.has(e.id),x=r===e.id;return t.jsx("div",{className:"tree-node",children:t.jsxs("div",{className:`tree-node-content panel ${u?"selected":""} ${d?"hovered":""} ${e.solid?"":"open-face"} ${m?"hidden":""} ${x?"isolated":""}`,style:{paddingLeft:`${n*16+8}px`},onMouseEnter:()=>l(e.id),onMouseLeave:()=>l(null),children:[t.jsxs("span",{className:"tree-node-main",onClick:b=>i(e.id,b.shiftKey),children:[t.jsx("span",{className:"tree-icon",children:e.solid?"":""}),t.jsx("span",{className:"tree-label",children:e.label}),t.jsx("span",{className:"tree-status",children:e.solid?"":"(open)"})]}),e.solid&&t.jsxs("span",{className:"tree-controls",children:[t.jsx("button",{className:`tree-btn ${m?"active":""}`,onClick:b=>{b.stopPropagation(),c(e.id)},title:m?"Show":"Hide",children:m?"":""}),t.jsx("button",{className:`tree-btn ${x?"active":""}`,onClick:b=>{b.stopPropagation(),f(x?null:e.id)},title:x?"Unisolate":"Isolate",children:""})]})]})})},Tn=({panel:e,depth:n,selectedPanelIds:s,onSelectPanel:i,hoveredPanelId:o,onHoverPanel:l,hiddenFaceIds:a,isolatedPanelId:r,onToggleFaceVisibility:c,onSetIsolatedPanel:f,onDelete:u})=>{const d=s.has(e.id),m=o===e.id,x=a.has(e.id),b=r===e.id,h=e.axis.toUpperCase(),y=e.id.replace("divider-","").replace("-split","");return t.jsx("div",{className:"tree-node",children:t.jsxs("div",{className:`tree-node-content panel ${d?"selected":""} ${m?"hovered":""} ${x?"hidden":""} ${b?"isolated":""}`,style:{paddingLeft:`${n*16+8}px`},onMouseEnter:()=>l(e.id),onMouseLeave:()=>l(null),children:[t.jsxs("span",{className:"tree-node-main",onClick:p=>i(e.id,p.shiftKey),children:[t.jsx("span",{className:"tree-icon",children:""}),t.jsxs("span",{className:"tree-label",children:["Divider @ ",h,"=",e.position.toFixed(0)]}),t.jsxs("span",{className:"tree-dimensions",children:[e.width.toFixed(0),"",e.height.toFixed(0)]})]}),t.jsxs("span",{className:"tree-controls",children:[t.jsx("button",{className:`tree-btn ${x?"active":""}`,onClick:p=>{p.stopPropagation(),c(e.id)},title:x?"Show":"Hide",children:x?"":""}),t.jsx("button",{className:`tree-btn ${b?"active":""}`,onClick:p=>{p.stopPropagation(),f(b?null:e.id)},title:b?"Unisolate":"Isolate",children:""}),t.jsx("button",{className:"tree-btn delete",onClick:p=>{p.stopPropagation(),u(y)},title:"Delete subdivision",children:""})]})]})})},ns=({node:e,depth:n,label:s,selectedVoidIds:i,selectedSubAssemblyIds:o,selectedPanelIds:l,selectedAssemblyId:a,onSelectVoid:r,onSelectSubAssembly:c,onSelectPanel:f,onSelectAssembly:u,hoveredVoidId:d,hoveredPanelId:m,hoveredAssemblyId:x,onHoverVoid:b,onHoverPanel:h,onHoverAssembly:y,hiddenVoidIds:p,isolatedVoidId:A,onToggleVisibility:j,onSetIsolated:N,hiddenSubAssemblyIds:C,isolatedSubAssemblyId:v,onToggleSubAssemblyVisibility:k,onSetIsolatedSubAssembly:g,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F,onDeleteVoid:L,onDeleteSubAssembly:D})=>{const R=i.has(e.id),T=d===e.id,H=e.children.length===0&&!e.subAssembly,G=e.children.length>0,E=!!e.subAssembly,I=p.has(e.id),V=A===e.id,P=G?Dn(e):[],$=()=>s||(e.lidInsetSide==="positive"?"Lid Cap (Top/Right/Front)":e.lidInsetSide==="negative"?"Lid Cap (Bottom/Left/Back)":e.isMainInterior?"Main Interior":"Void"),W=()=>{const{w:Z,h:K,d:J}=e.bounds;return`${Z.toFixed(0)}${K.toFixed(0)}${J.toFixed(0)}`},X=()=>E?"":e.lidInsetSide?"":H?"":"",_={selectedVoidIds:i,selectedSubAssemblyIds:o,selectedPanelIds:l,selectedAssemblyId:a,onSelectVoid:r,onSelectSubAssembly:c,onSelectPanel:f,onSelectAssembly:u,hoveredVoidId:d,hoveredPanelId:m,hoveredAssemblyId:x,onHoverVoid:b,onHoverPanel:h,onHoverAssembly:y,hiddenVoidIds:p,isolatedVoidId:A,onToggleVisibility:j,onSetIsolated:N,hiddenSubAssemblyIds:C,isolatedSubAssemblyId:v,onToggleSubAssemblyVisibility:k,onSetIsolatedSubAssembly:g,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F,onDeleteVoid:L,onDeleteSubAssembly:D};return t.jsxs("div",{className:"tree-node",children:[t.jsxs("div",{className:`tree-node-content ${R?"selected":""} ${T?"hovered":""} ${H?"leaf":"branch"} ${I?"hidden":""} ${V?"isolated":""}`,style:{paddingLeft:`${n*16+8}px`},onMouseEnter:()=>b(e.id),onMouseLeave:()=>b(null),children:[t.jsxs("span",{className:"tree-node-main",onClick:Z=>r(e.id,Z.shiftKey),children:[t.jsx("span",{className:"tree-icon",children:X()}),t.jsx("span",{className:"tree-label",children:$()}),t.jsx("span",{className:"tree-dimensions",children:W()})]}),t.jsxs("span",{className:"tree-controls",children:[t.jsx("button",{className:`tree-btn ${I?"active":""}`,onClick:Z=>{Z.stopPropagation(),j(e.id)},title:I?"Show":"Hide",children:I?"":""}),t.jsx("button",{className:`tree-btn ${V?"active":""}`,onClick:Z=>{Z.stopPropagation(),N(V?null:e.id)},title:V?"Unisolate":"Isolate",children:""})]})]}),E&&t.jsx("div",{className:"tree-children",children:t.jsx(Hn,{subAssembly:e.subAssembly,parentVoidId:e.id,depth:n+1,..._})}),G&&t.jsx("div",{className:"tree-children",children:e.children.map(Z=>{const K=P.find(J=>J.id===`divider-${Z.id}-split`);return t.jsxs(xs.Fragment,{children:[K&&t.jsx(Tn,{panel:K,depth:n+1,selectedPanelIds:l,onSelectPanel:f,hoveredPanelId:m,onHoverPanel:h,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F,onDelete:L}),t.jsx(ns,{node:Z,depth:n+1,..._})]},Z.id)})})]})},Hn=({subAssembly:e,parentVoidId:n,depth:s,selectedVoidIds:i,selectedSubAssemblyIds:o,selectedPanelIds:l,selectedAssemblyId:a,onSelectVoid:r,onSelectSubAssembly:c,onSelectPanel:f,onSelectAssembly:u,hoveredVoidId:d,hoveredPanelId:m,hoveredAssemblyId:x,onHoverVoid:b,onHoverPanel:h,onHoverAssembly:y,hiddenVoidIds:p,isolatedVoidId:A,onToggleVisibility:j,onSetIsolated:N,hiddenSubAssemblyIds:C,isolatedSubAssemblyId:v,onToggleSubAssemblyVisibility:k,onSetIsolatedSubAssembly:g,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F,onDeleteVoid:L,onDeleteSubAssembly:D})=>{const R=o.has(e.id),T=a===e.id,H=x===e.id,{rootVoid:G}=e,E=C.has(e.id),I=v===e.id,V=()=>"Nested Box",P=()=>"",$=()=>{const{w:_,h:Z,d:K}=G.bounds;return`${_.toFixed(0)}${Z.toFixed(0)}${K.toFixed(0)}`},W=e.faces.map(_=>({id:`subasm-${e.id}-face-${_.id}`,faceId:_.id,label:zs[_.id],solid:_.solid})),X={selectedVoidIds:i,selectedSubAssemblyIds:o,selectedPanelIds:l,selectedAssemblyId:a,onSelectVoid:r,onSelectSubAssembly:c,onSelectPanel:f,onSelectAssembly:u,hoveredVoidId:d,hoveredPanelId:m,hoveredAssemblyId:x,onHoverVoid:b,onHoverPanel:h,onHoverAssembly:y,hiddenVoidIds:p,isolatedVoidId:A,onToggleVisibility:j,onSetIsolated:N,hiddenSubAssemblyIds:C,isolatedSubAssemblyId:v,onToggleSubAssemblyVisibility:k,onSetIsolatedSubAssembly:g,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F,onDeleteVoid:L,onDeleteSubAssembly:D};return t.jsxs("div",{className:"tree-node",children:[t.jsxs("div",{className:`tree-node-content subassembly ${R||T?"selected":""} ${H?"hovered":""} ${E?"hidden":""} ${I?"isolated":""}`,style:{paddingLeft:`${s*16+8}px`},onMouseEnter:()=>y(e.id),onMouseLeave:()=>y(null),children:[t.jsxs("span",{className:"tree-node-main",onClick:_=>c(e.id,_.shiftKey),children:[t.jsx("span",{className:"tree-icon",children:P()}),t.jsx("span",{className:"tree-label",children:V()}),t.jsx("span",{className:"tree-dimensions",children:$()})]}),t.jsxs("span",{className:"tree-controls",children:[t.jsx("button",{className:`tree-btn ${E?"active":""}`,onClick:_=>{_.stopPropagation(),k(e.id)},title:E?"Show":"Hide",children:E?"":""}),t.jsx("button",{className:`tree-btn ${I?"active":""}`,onClick:_=>{_.stopPropagation(),g(I?null:e.id)},title:I?"Unisolate":"Isolate",children:""}),t.jsx("button",{className:"tree-btn delete",onClick:_=>{_.stopPropagation(),D(n)},title:"Delete sub-assembly",children:""})]})]}),t.jsx("div",{className:"tree-children",children:W.map(_=>t.jsx(Fs,{panel:_,depth:s+1,selectedPanelIds:l,onSelectPanel:f,hoveredPanelId:m,onHoverPanel:h,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F},_.id))}),t.jsx("div",{className:"tree-children",children:t.jsx(ns,{node:G,depth:s+1,label:"Interior",...X})})]})},Rn=({rootVoid:e,faces:n,depth:s,selectedVoidIds:i,selectedSubAssemblyIds:o,selectedPanelIds:l,selectedAssemblyId:a,onSelectVoid:r,onSelectSubAssembly:c,onSelectPanel:f,onSelectAssembly:u,hoveredVoidId:d,hoveredPanelId:m,hoveredAssemblyId:x,onHoverVoid:b,onHoverPanel:h,onHoverAssembly:y,hiddenVoidIds:p,isolatedVoidId:A,onToggleVisibility:j,onSetIsolated:N,hiddenSubAssemblyIds:C,isolatedSubAssemblyId:v,onToggleSubAssemblyVisibility:k,onSetIsolatedSubAssembly:g,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F,onDeleteVoid:L,onDeleteSubAssembly:D})=>{const R=a==="main",T=x==="main",{w:H,h:G,d:E}=e.bounds,I=yt(e),V=n.map($=>({id:`face-${$.id}`,faceId:$.id,label:zs[$.id],solid:$.solid})),P={selectedVoidIds:i,selectedSubAssemblyIds:o,selectedPanelIds:l,selectedAssemblyId:a,onSelectVoid:r,onSelectSubAssembly:c,onSelectPanel:f,onSelectAssembly:u,hoveredVoidId:d,hoveredPanelId:m,hoveredAssemblyId:x,onHoverVoid:b,onHoverPanel:h,onHoverAssembly:y,hiddenVoidIds:p,isolatedVoidId:A,onToggleVisibility:j,onSetIsolated:N,hiddenSubAssemblyIds:C,isolatedSubAssemblyId:v,onToggleSubAssemblyVisibility:k,onSetIsolatedSubAssembly:g,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F,onDeleteVoid:L,onDeleteSubAssembly:D};return t.jsxs("div",{className:"tree-node",children:[t.jsx("div",{className:`tree-node-content assembly ${R?"selected":""} ${T?"hovered":""}`,style:{paddingLeft:`${s*16+8}px`},onClick:()=>u(R?null:"main"),onMouseEnter:()=>y("main"),onMouseLeave:()=>y(null),children:t.jsxs("span",{className:"tree-node-main",children:[t.jsx("span",{className:"tree-icon",children:""}),t.jsx("span",{className:"tree-label",children:"Main Box"}),t.jsxs("span",{className:"tree-dimensions",children:[H.toFixed(0),"",G.toFixed(0),"",E.toFixed(0)]})]})}),t.jsx("div",{className:"tree-children",children:V.map($=>t.jsx(Fs,{panel:$,depth:s+1,selectedPanelIds:l,onSelectPanel:f,hoveredPanelId:m,onHoverPanel:h,hiddenFaceIds:w,isolatedPanelId:B,onToggleFaceVisibility:S,onSetIsolatedPanel:F},$.id))}),t.jsx("div",{className:"tree-children",children:t.jsx(ns,{node:I,depth:s+1,label:"Interior",...P})})]})},$n=()=>{const{rootVoid:e,faces:n,selectedVoidIds:s,selectedSubAssemblyIds:i,selectedPanelIds:o,selectedAssemblyId:l,selectVoid:a,selectSubAssembly:r,selectPanel:c,selectAssembly:f,hoveredVoidId:u,hoveredPanelId:d,hoveredAssemblyId:m,setHoveredVoid:x,setHoveredPanel:b,setHoveredAssembly:h,hiddenVoidIds:y,isolatedVoidId:p,toggleVoidVisibility:A,setIsolatedVoid:j,hiddenSubAssemblyIds:N,isolatedSubAssemblyId:C,toggleSubAssemblyVisibility:v,setIsolatedSubAssembly:k,hiddenFaceIds:g,isolatedPanelId:w,toggleFaceVisibility:B,setIsolatedPanel:S,removeVoid:F,removeSubAssembly:L}=le(),D=p||C||w,R=()=>{j(null),k(null),S(null)};return t.jsxs(We,{title:"Structure",children:[t.jsx("div",{className:"box-tree",children:t.jsx(Rn,{rootVoid:e,faces:n,depth:0,selectedVoidIds:s,selectedSubAssemblyIds:i,selectedPanelIds:o,selectedAssemblyId:l,onSelectVoid:a,onSelectSubAssembly:r,onSelectPanel:c,onSelectAssembly:f,hoveredVoidId:u,hoveredPanelId:d,hoveredAssemblyId:m,onHoverVoid:x,onHoverPanel:b,onHoverAssembly:h,hiddenVoidIds:y,isolatedVoidId:p,onToggleVisibility:A,onSetIsolated:j,hiddenSubAssemblyIds:N,isolatedSubAssemblyId:C,onToggleSubAssemblyVisibility:v,onSetIsolatedSubAssembly:k,hiddenFaceIds:g,isolatedPanelId:w,onToggleFaceVisibility:B,onSetIsolatedPanel:S,onDeleteVoid:F,onDeleteSubAssembly:L})}),D&&t.jsx("button",{className:"unisolate-btn",onClick:R,children:"Show All"})]})},ls=new Jt,dt=new $e;class Ls extends Ks{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const n=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],s=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new Lt(n,3)),this.setAttribute("uv",new Lt(s,2))}applyMatrix4(n){const s=this.attributes.instanceStart,i=this.attributes.instanceEnd;return s!==void 0&&(s.applyMatrix4(n),i.applyMatrix4(n),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(n){let s;n instanceof Float32Array?s=n:Array.isArray(n)&&(s=new Float32Array(n));const i=new Dt(s,6,1);return this.setAttribute("instanceStart",new qe(i,3,0)),this.setAttribute("instanceEnd",new qe(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(n){let s;n instanceof Float32Array?s=n:Array.isArray(n)&&(s=new Float32Array(n));const i=new Dt(s,6,1);return this.setAttribute("instanceColorStart",new qe(i,3,0)),this.setAttribute("instanceColorEnd",new qe(i,3,3)),this}fromWireframeGeometry(n){return this.setPositions(n.attributes.position.array),this}fromEdgesGeometry(n){return this.setPositions(n.attributes.position.array),this}fromMesh(n){return this.fromWireframeGeometry(new qs(n.geometry)),this}fromLineSegments(n){const s=n.geometry;return this.setPositions(s.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Jt);const n=this.attributes.instanceStart,s=this.attributes.instanceEnd;n!==void 0&&s!==void 0&&(this.boundingBox.setFromBufferAttribute(n),ls.setFromBufferAttribute(s),this.boundingBox.union(ls))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new gs),this.boundingBox===null&&this.computeBoundingBox();const n=this.attributes.instanceStart,s=this.attributes.instanceEnd;if(n!==void 0&&s!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let o=0;for(let l=0,a=n.count;l<a;l++)dt.fromBufferAttribute(n,l),o=Math.max(o,i.distanceToSquared(dt)),dt.fromBufferAttribute(s,l),o=Math.max(o,i.distanceToSquared(dt));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(n){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(n)}}pt.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new vs(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};mt.line={uniforms:ys.merge([pt.common,pt.fog,pt.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Ds extends Qs{constructor(n){super({type:"LineMaterial",uniforms:ys.clone(mt.line.uniforms),vertexShader:mt.line.vertexShader,fragmentShader:mt.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(n)}get color(){return this.uniforms.diffuse.value}set color(n){this.uniforms.diffuse.value=n}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(n){n===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(n){this.uniforms.linewidth&&(this.uniforms.linewidth.value=n)}get dashed(){return"USE_DASH"in this.defines}set dashed(n){n===!0!==this.dashed&&(this.needsUpdate=!0),n===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(n){this.uniforms.dashScale.value=n}get dashSize(){return this.uniforms.dashSize.value}set dashSize(n){this.uniforms.dashSize.value=n}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(n){this.uniforms.dashOffset.value=n}get gapSize(){return this.uniforms.gapSize.value}set gapSize(n){this.uniforms.gapSize.value=n}get opacity(){return this.uniforms.opacity.value}set opacity(n){this.uniforms&&(this.uniforms.opacity.value=n)}get resolution(){return this.uniforms.resolution.value}set resolution(n){this.uniforms.resolution.value.copy(n)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(n){this.defines&&(n===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),n===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const rs=new $e,as=new $e,ye=new St,ve=new St,Fe=new St,Ct=new $e,Et=new sn,we=new tn,cs=new $e,ht=new Jt,ut=new gs,Le=new St;let De,Ye;function ds(e,n,s){return Le.set(0,0,-n,1).applyMatrix4(e.projectionMatrix),Le.multiplyScalar(1/Le.w),Le.x=Ye/s.width,Le.y=Ye/s.height,Le.applyMatrix4(e.projectionMatrixInverse),Le.multiplyScalar(1/Le.w),Math.abs(Math.max(Le.x,Le.y))}function Bn(e,n){const s=e.matrixWorld,i=e.geometry,o=i.attributes.instanceStart,l=i.attributes.instanceEnd,a=Math.min(i.instanceCount,o.count);for(let r=0,c=a;r<c;r++){we.start.fromBufferAttribute(o,r),we.end.fromBufferAttribute(l,r),we.applyMatrix4(s);const f=new $e,u=new $e;De.distanceSqToSegment(we.start,we.end,u,f),u.distanceTo(f)<Ye*.5&&n.push({point:u,pointOnLine:f,distance:De.origin.distanceTo(u),object:e,face:null,faceIndex:r,uv:null,uv1:null})}}function On(e,n,s){const i=n.projectionMatrix,l=e.material.resolution,a=e.matrixWorld,r=e.geometry,c=r.attributes.instanceStart,f=r.attributes.instanceEnd,u=Math.min(r.instanceCount,c.count),d=-n.near;De.at(1,Fe),Fe.w=1,Fe.applyMatrix4(n.matrixWorldInverse),Fe.applyMatrix4(i),Fe.multiplyScalar(1/Fe.w),Fe.x*=l.x/2,Fe.y*=l.y/2,Fe.z=0,Ct.copy(Fe),Et.multiplyMatrices(n.matrixWorldInverse,a);for(let m=0,x=u;m<x;m++){if(ye.fromBufferAttribute(c,m),ve.fromBufferAttribute(f,m),ye.w=1,ve.w=1,ye.applyMatrix4(Et),ve.applyMatrix4(Et),ye.z>d&&ve.z>d)continue;if(ye.z>d){const j=ye.z-ve.z,N=(ye.z-d)/j;ye.lerp(ve,N)}else if(ve.z>d){const j=ve.z-ye.z,N=(ve.z-d)/j;ve.lerp(ye,N)}ye.applyMatrix4(i),ve.applyMatrix4(i),ye.multiplyScalar(1/ye.w),ve.multiplyScalar(1/ve.w),ye.x*=l.x/2,ye.y*=l.y/2,ve.x*=l.x/2,ve.y*=l.y/2,we.start.copy(ye),we.start.z=0,we.end.copy(ve),we.end.z=0;const h=we.closestPointToPointParameter(Ct,!0);we.at(h,cs);const y=nn.lerp(ye.z,ve.z,h),p=y>=-1&&y<=1,A=Ct.distanceTo(cs)<Ye*.5;if(p&&A){we.start.fromBufferAttribute(c,m),we.end.fromBufferAttribute(f,m),we.start.applyMatrix4(a),we.end.applyMatrix4(a);const j=new $e,N=new $e;De.distanceSqToSegment(we.start,we.end,N,j),s.push({point:N,pointOnLine:j,distance:De.origin.distanceTo(N),object:e,face:null,faceIndex:m,uv:null,uv1:null})}}}class Wn extends en{constructor(n=new Ls,s=new Ds({color:Math.random()*16777215})){super(n,s),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const n=this.geometry,s=n.attributes.instanceStart,i=n.attributes.instanceEnd,o=new Float32Array(2*s.count);for(let a=0,r=0,c=s.count;a<c;a++,r+=2)rs.fromBufferAttribute(s,a),as.fromBufferAttribute(i,a),o[r]=r===0?0:o[r-1],o[r+1]=o[r]+rs.distanceTo(as);const l=new Dt(o,2,1);return n.setAttribute("instanceDistanceStart",new qe(l,1,0)),n.setAttribute("instanceDistanceEnd",new qe(l,1,1)),this}raycast(n,s){const i=this.material.worldUnits,o=n.camera;o===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const l=n.params.Line2!==void 0&&n.params.Line2.threshold||0;De=n.ray;const a=this.matrixWorld,r=this.geometry,c=this.material;Ye=c.linewidth+l,r.boundingSphere===null&&r.computeBoundingSphere(),ut.copy(r.boundingSphere).applyMatrix4(a);let f;if(i)f=Ye*.5;else{const d=Math.max(o.near,ut.distanceToPoint(De.origin));f=ds(o,d,c.resolution)}if(ut.radius+=f,De.intersectsSphere(ut)===!1)return;r.boundingBox===null&&r.computeBoundingBox(),ht.copy(r.boundingBox).applyMatrix4(a);let u;if(i)u=Ye*.5;else{const d=Math.max(o.near,ht.distanceToPoint(De.origin));u=ds(o,d,c.resolution)}ht.expandByScalar(u),De.intersectsBox(ht)!==!1&&(i?Bn(this,s):On(this,o,s))}}const Un=({voidId:e,bounds:n,boxCenter:s})=>{var z,U,M,Y,ee,te;const i=O.useRef(null),{selectedVoidIds:o,selectVoid:l,hoveredVoidId:a,setHoveredVoid:r,selectionMode:c,rootVoid:f,hiddenVoidIds:u,isolatedVoidId:d,config:m,faces:x}=le(),{size:b}=_s(),h=o.has(e),y=a===e,p=c==="void",A=Wt(e,f,u),{width:j,height:N,depth:C,materialThickness:v}=m,k=.01,g=n.x<k,w=Math.abs(n.x+n.w-j)<k,B=n.y<k,S=Math.abs(n.y+n.h-N)<k,F=n.z<k,L=Math.abs(n.z+n.d-C)<k,D=((z=x.find(q=>q.id==="left"))==null?void 0:z.solid)??!1,R=((U=x.find(q=>q.id==="right"))==null?void 0:U.solid)??!1,T=((M=x.find(q=>q.id==="bottom"))==null?void 0:M.solid)??!1,H=((Y=x.find(q=>q.id==="top"))==null?void 0:Y.solid)??!1,G=((ee=x.find(q=>q.id==="back"))==null?void 0:ee.solid)??!1,E=((te=x.find(q=>q.id==="front"))==null?void 0:te.solid)??!1,I=g&&D?v:0,V=w&&R?v:0,P=B&&T?v:0,$=S&&H?v:0,W=F&&G?v:0,X=L&&E?v:0,_={x:n.x+I,y:n.y+P,z:n.z+W,w:n.w-I-V,h:n.h-P-$,d:n.d-W-X},Z=[_.x+_.w/2-s.x,_.y+_.h/2-s.y,_.z+_.d/2-s.z],K=[_.w,_.h,_.d],{lineGeometry:J,lineMaterial:Q}=O.useMemo(()=>{const[q,je,pe]=K,oe=q/2,ae=je/2,ie=pe/2,ce=[[-oe,-ae,-ie],[oe,-ae,-ie],[oe,ae,-ie],[-oe,ae,-ie],[-oe,-ae,ie],[oe,-ae,ie],[oe,ae,ie],[-oe,ae,ie]],Se=[],Me=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];for(const[xe,de]of Me)Se.push(...ce[xe],...ce[de]);const Pe=new Ls;Pe.setPositions(Se);const be=new Ds({color:16711935,linewidth:2,resolution:new vs(b.width,b.height)});return{lineGeometry:Pe,lineMaterial:be}},[K[0],K[1],K[2],b.width,b.height]),se=O.useMemo(()=>new Wn(J,Q),[J,Q]);return A&&(p||h||y)?t.jsxs("group",{position:Z,children:[t.jsx("primitive",{object:se}),t.jsxs("mesh",{ref:i,scale:[.95,.95,.95],onClick:p?q=>{q.stopPropagation(),l(e,q.shiftKey)}:void 0,onPointerOver:p?q=>{q.stopPropagation(),r(e),document.body.style.cursor="pointer"}:void 0,onPointerOut:p?()=>{r(null),document.body.style.cursor="auto"}:void 0,children:[t.jsx("boxGeometry",{args:[_.w,_.h,_.d]}),t.jsx("meshStandardMaterial",{color:h?"#4a90d9":y?"#6ab04c":"#95a5a6",transparent:!0,opacity:h?.6:y?.4:.2})]})]}):null},_n=({subAssembly:e,parentBounds:n,scale:s,boxCenter:i})=>{const{selectedSubAssemblyIds:o,selectSubAssembly:l,selectionMode:a,selectedAssemblyId:r,selectAssembly:c}=le(),f=o.has(e.id),u=r===e.id,d=f||u,{clearance:m,rootVoid:x,materialThickness:b,faceOffsets:h}=e,y=h||{left:0,bottom:0,back:0},p=x.bounds.w+2*b,A=x.bounds.h+2*b,j=x.bounds.d+2*b,N=p*s,C=A*s,v=j*s,k=(n.x+m-y.left+p/2-i.x)*s,g=(n.y+m-y.bottom+A/2-i.y)*s,w=(n.z+m-y.back+j/2-i.z)*s,B=F=>{F.stopPropagation(),a==="void"?l(e.id,F.shiftKey):a==="assembly"&&c(u?null:e.id)},S=a==="void"||a==="assembly";return t.jsxs("group",{position:[k,g,w],children:[t.jsxs("lineSegments",{children:[t.jsx("edgesGeometry",{args:[new Tt(N,C,v)]}),t.jsx("lineBasicMaterial",{color:d?"#e74c3c":"#666"})]}),S&&t.jsxs("mesh",{onClick:B,children:[t.jsx("boxGeometry",{args:[N,C,v]}),t.jsx("meshBasicMaterial",{transparent:!0,opacity:0,depthWrite:!1})]})]})},Gn=(e,n,s,i)=>{const o=s*i,l=new ln;if(e.length>0){const c=e[0];l.moveTo(c.x*i,c.y*i);for(let f=1;f<e.length;f++){const u=e[f];l.lineTo(u.x*i,u.y*i)}l.closePath()}for(const c of n)if(c.points.length>0){const f=new rn,u=c.points[0];f.moveTo(u.x*i,u.y*i);for(let d=1;d<c.points.length;d++)f.lineTo(c.points[d].x*i,c.points[d].y*i);f.closePath(),l.holes.push(f)}const a={depth:o,bevelEnabled:!1},r=new an(l,a);return r.translate(0,0,-o/2),r},Yn=(e,n,s,i)=>{const o=s*i,l=o/2,a=-o/2,r=[],c=(m,x,b,h,y,p)=>{Math.abs(m-h)<.001&&Math.abs(x-y)<.001&&Math.abs(b-p)<.001||r.push(m,x,b,h,y,p)},f=(m,x)=>{for(let b=0;b<m.length;b++){const h=m[b],y=m[(b+1)%m.length];c(h.x*i,h.y*i,x,y.x*i,y.y*i,x)}},u=m=>{const x=new Set;for(const b of m){const h=`${Math.round(b.x*1e3)},${Math.round(b.y*1e3)}`;x.has(h)||(x.add(h),c(b.x*i,b.y*i,l,b.x*i,b.y*i,a))}};f(e,l),f(e,a),u(e);for(const m of n)f(m.points,l),f(m.points,a),u(m.points);const d=new cn;return d.setAttribute("position",new Lt(r,3)),d},Xn=({panel:e,scale:n,isSelected:s,isHovered:i=!1,onClick:o,onDoubleClick:l,onHover:a,color:r="#3498db",selectedColor:c="#9b59b6",hoveredColor:f="#6ab04c"})=>{const{outline:u,holes:d,thickness:m,position:x,rotation:b,visible:h}=e,y=O.useMemo(()=>[x[0]*n,x[1]*n,x[2]*n],[x,n]),p=O.useMemo(()=>!h||u.points.length===0?null:Gn(u.points,d.map(w=>({points:w.path.points})),m,n),[u,d,m,n,h]),A=O.useMemo(()=>!h||u.points.length===0?null:Yn(u.points,d.map(w=>({points:w.path.points})),m,n),[u,d,m,n,h]);if(O.useEffect(()=>()=>{p&&p.dispose(),A&&A.dispose()},[p,A]),!h||!p)return null;const j=o?w=>{var S;(S=w.stopPropagation)==null||S.call(w);const B=w.nativeEvent||w;o(B)}:void 0,N=l?w=>{var S;(S=w.stopPropagation)==null||S.call(w);const B=w.nativeEvent||w;l(B)}:void 0,C=a?w=>{var B;(B=w.stopPropagation)==null||B.call(w),a(!0),document.body.style.cursor="pointer"}:void 0,v=a?()=>{a(!1),document.body.style.cursor="auto"}:void 0,k=s?c:i?f:r,g=s?.9:i?.8:.7;return t.jsxs("group",{position:y,rotation:b,children:[t.jsx("mesh",{geometry:p,onClick:j,onDoubleClick:N,onPointerOver:C,onPointerOut:v,children:t.jsx("meshStandardMaterial",{color:k,transparent:!0,opacity:g,side:on})}),A&&t.jsx("lineSegments",{geometry:A,children:t.jsx("lineBasicMaterial",{color:s?"#7b4397":i?"#2d6a4f":"#1a5276",linewidth:1})})]})},Zn=e=>e.source.subAssemblyId??"main",Jn=({scale:e,selectedPanelIds:n,onPanelClick:s,onPanelDoubleClick:i,hiddenFaceIds:o=new Set})=>{const l=le(d=>d.panelCollection),a=le(d=>d.hoveredPanelId),r=le(d=>d.hoveredAssemblyId),c=le(d=>d.selectedAssemblyId),f=le(d=>d.selectedSubAssemblyIds),u=le(d=>d.setHoveredPanel);return l?t.jsx(t.Fragment,{children:l.panels.map(d=>{if(!d.visible||o.has(d.id))return null;const m=d.source.type==="divider",x=!!d.source.subAssemblyId,b=Zn(d),h=n.has(d.id),y=c===b||b!=="main"&&f.has(b),p=a===d.id,A=r===b,j=h||y,N=p||A,C=x?"#1abc9c":m?"#f39c12":"#3498db";return t.jsx(Xn,{panel:d,scale:e,isSelected:j,isHovered:N,onClick:s?v=>s(d.id,v):void 0,onDoubleClick:i?v=>i(d.id,v):void 0,onHover:v=>u(v?d.id:null),color:C,selectedColor:"#9b59b6"},d.id)})}):null},wt=(e,n)=>{if(e.id===n)return e;for(const s of e.children){const i=wt(s,n);if(i)return i}if(e.subAssembly){const s=wt(e.subAssembly.rootVoid,n);if(s)return s}return null},Gt=(e,n,s)=>{if(e.id===n)return s||null;for(const i of e.children){const o=Gt(i,n,s);if(o!==void 0)return o}if(e.subAssembly){const i=Gt(e.subAssembly.rootVoid,n,{subAssembly:e.subAssembly,parentBounds:e.bounds});if(i!==void 0)return i}},Kn=()=>{const{config:e,faces:n,rootVoid:s,subdivisionPreview:i,subAssemblyPreview:o,selectionMode:l,selectedPanelIds:a,selectPanel:r,selectedAssemblyId:c,selectAssembly:f,hiddenVoidIds:u,isolatedVoidId:d,hiddenSubAssemblyIds:m,isolatedSubAssemblyId:x,hiddenFaceIds:b,panelsDirty:h,generatePanels:y,panelCollection:p,showDebugAnchors:A}=le(),{width:j,height:N,depth:C}=e;O.useEffect(()=>{h&&y()},[h,y]);const v=100/Math.max(j,N,C),k=j*v,g=N*v,w=C*v,B=e.materialThickness*v,S={x:j/2,y:N/2,z:C/2},F=Vs(s);et(s);const L=Ge(s),D=i?wt(s,i.voidId):null,R=O.useMemo(()=>{if(!i)return{x:0,y:0,z:0};const I=e.width/2,V=e.height/2,P=e.depth/2,$=Gt(s,i.voidId);if(!$)return{x:-I,y:-V,z:-P};const{subAssembly:W,parentBounds:X}=$,_=W.rootVoid.bounds.w+2*W.materialThickness,Z=W.rootVoid.bounds.h+2*W.materialThickness,K=W.rootVoid.bounds.d+2*W.materialThickness,J=W.faceOffsets||{left:0,bottom:0,back:0},Q=X.x+W.clearance-J.left+_/2,se=X.y+W.clearance-J.bottom+Z/2,ne=X.z+W.clearance-J.back+K/2,z=W.rootVoid.bounds.w,U=W.rootVoid.bounds.h,M=W.rootVoid.bounds.d;return{x:e.materialThickness+Q-z/2-I,y:e.materialThickness+se-U/2-V,z:e.materialThickness+ne-M/2-P}},[s,i,e]),T=O.useMemo(()=>{if(!i)return null;for(const{subAssembly:I}of L)if(wt(I.rootVoid,i.voidId))return I;return null},[i,L]),H=O.useMemo(()=>{var ce,Se,Me,Pe,be,xe;if(!D)return null;const{bounds:I}=D,V=.01,P=(T==null?void 0:T.materialThickness)??e.materialThickness,$=(T==null?void 0:T.faces)??n,W=(T==null?void 0:T.rootVoid.bounds.w)??j,X=(T==null?void 0:T.rootVoid.bounds.h)??N,_=(T==null?void 0:T.rootVoid.bounds.d)??C,Z=I.x<V,K=Math.abs(I.x+I.w-W)<V,J=I.y<V,Q=Math.abs(I.y+I.h-X)<V,se=I.z<V,ne=Math.abs(I.z+I.d-_)<V,z=((ce=$.find(de=>de.id==="left"))==null?void 0:ce.solid)??!1,U=((Se=$.find(de=>de.id==="right"))==null?void 0:Se.solid)??!1,M=((Me=$.find(de=>de.id==="bottom"))==null?void 0:Me.solid)??!1,Y=((Pe=$.find(de=>de.id==="top"))==null?void 0:Pe.solid)??!1,ee=((be=$.find(de=>de.id==="back"))==null?void 0:be.solid)??!1,te=((xe=$.find(de=>de.id==="front"))==null?void 0:xe.solid)??!1,q=Z&&z?P:0,je=K&&U?P:0,pe=J&&M?P:0,oe=Q&&Y?P:0,ae=se&&ee?P:0,ie=ne&&te?P:0;return{x:I.x+q,y:I.y+pe,z:I.z+ae,w:I.w-q-je,h:I.h-pe-oe,d:I.d-ae-ie}},[D,e.materialThickness,j,N,C,n,T]),G=B/2,E=O.useMemo(()=>{const I=k/2-G,V=g/2-G,P=w/2-G;return[{x:-I,y:-V,z:-P},{x:I,y:-V,z:-P},{x:-I,y:V,z:-P},{x:I,y:V,z:-P},{x:-I,y:-V,z:P},{x:I,y:-V,z:P},{x:-I,y:V,z:P},{x:I,y:V,z:P}]},[k,g,w,G]);return t.jsxs("group",{children:[t.jsxs("lineSegments",{children:[t.jsx("edgesGeometry",{args:[new Tt(k,g,w)]}),t.jsx("lineBasicMaterial",{color:"#ff0000",linewidth:2})]}),A&&E.map((I,V)=>t.jsxs("mesh",{position:[I.x,I.y,I.z],children:[t.jsx("sphereGeometry",{args:[2,16,16]}),t.jsx("meshStandardMaterial",{color:"#ff6600"})]},`anchor-${V}`)),p&&t.jsx(Jn,{scale:v,selectedPanelIds:a,onPanelClick:l==="panel"||l===null?(I,V)=>{r(I,V==null?void 0:V.shiftKey)}:void 0,onPanelDoubleClick:l===null?I=>{const V=p.panels.find($=>$.id===I),P=(V==null?void 0:V.source.subAssemblyId)??"main";f(P)}:void 0,hiddenFaceIds:b}),!1,!1,i&&D&&H&&i.positions.map((I,V)=>{const P=H;let $,W,X;const _=R.x,Z=R.y,K=R.z,J=(P.x+P.w/2+_)*v,Q=(P.y+P.h/2+Z)*v,se=(P.z+P.d/2+K)*v;switch(i.axis){case"x":$=[(I+_)*v,Q,se],W=[0,Math.PI/2,0],X=[P.d*v,P.h*v];break;case"y":$=[J,(I+Z)*v,se],W=[Math.PI/2,0,0],X=[P.w*v,P.d*v];break;case"z":$=[J,Q,(I+K)*v],W=[0,0,0],X=[P.w*v,P.h*v];break}return t.jsxs("mesh",{position:$,rotation:W,children:[t.jsx("boxGeometry",{args:[X[0],X[1],B]}),t.jsx("meshStandardMaterial",{color:"#2ecc71",transparent:!0,opacity:.7})]},`preview-${V}`)}),o&&(()=>{const{bounds:I}=o,V=(I.x+I.w/2-S.x)*v,P=(I.y+I.h/2-S.y)*v,$=(I.z+I.d/2-S.z)*v,W=I.w*v,X=I.h*v,_=I.d*v;return t.jsxs("group",{position:[V,P,$],children:[t.jsxs("lineSegments",{children:[t.jsx("edgesGeometry",{args:[new Tt(W,X,_)]}),t.jsx("lineBasicMaterial",{color:"#2ecc71",linewidth:2})]}),t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[W,X,_]}),t.jsx("meshStandardMaterial",{color:"#2ecc71",transparent:!0,opacity:.15,depthWrite:!1})]})]})})(),F.filter(I=>Wt(I.id,s,u)).map(I=>t.jsx(Un,{voidId:I.id,bounds:{x:I.bounds.x*v,y:I.bounds.y*v,z:I.bounds.z*v,w:I.bounds.w*v,h:I.bounds.h*v,d:I.bounds.d*v},boxCenter:{x:S.x*v,y:S.y*v,z:S.z*v}},I.id)),L.filter(({voidId:I,subAssembly:V})=>Wt(I,s,u)&&Ln(V.id,m)).map(({voidId:I,subAssembly:V,bounds:P})=>t.jsx(_n,{subAssembly:V,parentBounds:P,scale:v,boxCenter:S},V.id))]})},qn=()=>{const{selectionMode:e,setSelectionMode:n,showDebugAnchors:s,toggleDebugAnchors:i}=le(),o=[{mode:"assembly",label:"Assembly",icon:"",tooltip:"Filter: select only assemblies"},{mode:"void",label:"Void",icon:"",tooltip:"Filter: select only voids"},{mode:"panel",label:"Panel",icon:"",tooltip:"Filter: select only panels"}],l=a=>{n(e===a?null:a)};return t.jsxs("div",{className:"viewport-toolbar",children:[t.jsxs("div",{className:"toolbar-group",children:[t.jsx("span",{className:"toolbar-label",children:"Filter:"}),o.map(a=>t.jsxs("button",{className:`toolbar-btn ${e===a.mode?"active":""}`,onClick:()=>l(a.mode),title:a.tooltip,children:[t.jsx("span",{className:"toolbar-icon",children:a.icon}),t.jsx("span",{className:"toolbar-text",children:a.label})]},a.mode))]}),t.jsxs("div",{className:"toolbar-group",children:[t.jsx("span",{className:"toolbar-label",children:"Debug:"}),t.jsxs("button",{className:`toolbar-btn ${s?"active":""}`,onClick:i,title:"Show finger joint anchor points",children:[t.jsx("span",{className:"toolbar-icon",children:""}),t.jsx("span",{className:"toolbar-text",children:"Anchors"})]})]})]})},Qn=[{id:"select",icon:"",label:"Select",tooltip:"Select elements (V)",modes:["2d","3d"]},{id:"pan",icon:"",label:"Pan",tooltip:"Pan view (Space+drag)",modes:["2d","3d"]},{id:"rectangle",icon:"",label:"Rect",tooltip:"Draw rectangle (R)",modes:["2d"]},{id:"circle",icon:"",label:"Circle",tooltip:"Draw circle (C)",modes:["2d"]},{id:"path",icon:"",label:"Path",tooltip:"Draw path (P)",modes:["2d"]},{id:"inset",icon:"",label:"Inset",tooltip:"Inset/Outset edges (I)",modes:["2d"]},{id:"chamfer",icon:"",label:"Chamfer",tooltip:"Chamfer corners (F)",modes:["2d"]}],Ts=({mode:e,activeTool:n="select",onToolChange:s,mirrorX:i=!1,mirrorY:o=!1,onMirrorXChange:l,onMirrorYChange:a})=>{const r=Qn.filter(f=>f.modes.includes(e)),c=f=>{s&&s(f)};return t.jsxs("div",{className:"editor-toolbar",children:[t.jsxs("div",{className:"editor-toolbar-section",children:[t.jsx("span",{className:"editor-toolbar-label",children:"Tools"}),t.jsx("div",{className:"editor-toolbar-buttons",children:r.map(f=>t.jsxs("button",{className:`editor-tool-btn ${n===f.id?"active":""}`,onClick:()=>c(f.id),title:f.tooltip,disabled:!s,children:[t.jsx("span",{className:"editor-tool-icon",children:f.icon}),t.jsx("span",{className:"editor-tool-label",children:f.label})]},f.id))})]}),e==="2d"&&t.jsxs("div",{className:"editor-toolbar-section",children:[t.jsx("span",{className:"editor-toolbar-label",children:"Mirror"}),t.jsxs("div",{className:"editor-toolbar-buttons",children:[t.jsxs("button",{className:`editor-tool-btn ${i?"active":""}`,onClick:()=>l==null?void 0:l(!i),title:"Mirror horizontally (X axis)",disabled:!l,children:[t.jsx("span",{className:"editor-tool-icon",children:""}),t.jsx("span",{className:"editor-tool-label",children:"X"})]}),t.jsxs("button",{className:`editor-tool-btn ${o?"active":""}`,onClick:()=>a==null?void 0:a(!o),title:"Mirror vertically (Y axis)",disabled:!a,children:[t.jsx("span",{className:"editor-tool-icon",children:""}),t.jsx("span",{className:"editor-tool-label",children:"Y"})]})]})]}),e==="2d"&&t.jsxs("div",{className:"editor-toolbar-section",children:[t.jsx("span",{className:"editor-toolbar-label",children:"Boolean"}),t.jsxs("div",{className:"editor-toolbar-buttons",children:[t.jsxs("button",{className:"editor-tool-btn",title:"Add (Union)",disabled:!0,children:[t.jsx("span",{className:"editor-tool-icon",children:"+"}),t.jsx("span",{className:"editor-tool-label",children:"Add"})]}),t.jsxs("button",{className:"editor-tool-btn",title:"Subtract (Cut)",disabled:!0,children:[t.jsx("span",{className:"editor-tool-icon",children:""}),t.jsx("span",{className:"editor-tool-label",children:"Cut"})]})]})]})]})},Hs=O.forwardRef((e,n)=>{const s=le(f=>f.clearSelection),i=le(f=>f.selectedPanelIds),o=le(f=>f.panelCollection),l=le(f=>f.toggleFace),a=le(f=>f.purgeVoid),r=O.useRef(null);O.useImperativeHandle(n,()=>({getCanvas:()=>r.current?r.current.querySelector("canvas"):null}));const c=O.useCallback(()=>{if(!(i.size===0||!o)){for(const f of i){const u=o.panels.find(d=>d.id===f);if(u){if(u.source.type==="face"){const d=u.source.faceId;d&&l(d)}else if(u.source.type==="divider"){const d=u.source.subdivisionId;if(d&&d.endsWith("-split")){const m=d.slice(0,-6);a(m)}}}}s()}},[i,o,l,a,s]);return O.useEffect(()=>{const f=u=>{u.target instanceof HTMLInputElement||u.target instanceof HTMLTextAreaElement||(u.key==="Escape"?s():(u.key==="Delete"||u.key==="Backspace")&&(u.preventDefault(),c()))};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[s,c]),t.jsxs("div",{className:"viewport-container",ref:r,children:[t.jsx(qn,{}),t.jsx(Ts,{mode:"3d"}),t.jsxs(Gs,{camera:{position:[150,150,150],fov:50},style:{background:"#1a1a2e"},gl:{preserveDrawingBuffer:!0},onPointerMissed:()=>s(),children:[t.jsx("ambientLight",{intensity:.5}),t.jsx("directionalLight",{position:[10,10,5],intensity:1}),t.jsx("pointLight",{position:[-10,-10,-5],intensity:.5}),t.jsx(Kn,{}),t.jsx(Ys,{args:[200,200],cellSize:10,cellThickness:.5,cellColor:"#444",sectionSize:50,sectionThickness:1,sectionColor:"#666",fadeDistance:400,fadeStrength:1,followCamera:!1,position:[0,-60,0]}),t.jsx(Xs,{makeDefault:!0,enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:50,maxDistance:500}),t.jsx(Zs,{preset:"studio"})]})]})});Hs.displayName="Viewport3D";const ei=(e,n,s,i)=>{const l={front:{top:"top",bottom:"bottom",left:"left",right:"right"},back:{top:"top",bottom:"bottom",left:"right",right:"left"},left:{top:"top",bottom:"bottom",left:"back",right:"front"},right:{top:"top",bottom:"bottom",left:"front",right:"back"},top:{top:"back",bottom:"front",left:"left",right:"right"},bottom:{top:"front",bottom:"back",left:"left",right:"right"}}[e];if(!l)return!1;const a=l[n],r=s.find(c=>c.id===a);return(r==null?void 0:r.solid)??!1},ti=(e,n,s,i)=>["top","bottom","left","right"].map(l=>{const a=ei(e,l,n);return{position:l,hasJoints:a,margin:a?i:0}}),si=e=>["top","bottom","left","right"].map(s=>({position:s,hasJoints:!0,margin:e})),ni=(e,n,s)=>{var N,C,v,k;const{materialThickness:i}=s,o=e.edgeExtensions??{top:0,bottom:0,left:0,right:0},l=e.width-(o.left??0)-(o.right??0),a=e.height-(o.top??0)-(o.bottom??0),r=l/2,c=a/2;let f;e.source.type==="face"&&e.source.faceId?f=ti(e.source.faceId,n,s.assembly,i):e.source.type==="divider"?f=si(i):f=["top","bottom","left","right"].map(g=>({position:g,hasJoints:!0,margin:i}));const u=((N=f.find(g=>g.position==="top"))==null?void 0:N.margin)??i,d=((C=f.find(g=>g.position==="bottom"))==null?void 0:C.margin)??i,m=((v=f.find(g=>g.position==="left"))==null?void 0:v.margin)??i,x=((k=f.find(g=>g.position==="right"))==null?void 0:k.margin)??i,b={x:-r+m,y:-c+d,width:l-m-x,height:a-u-d,label:"Safe zone"},h=[];b.width>0&&b.height>0&&h.push(b);for(const g of f)if(!g.hasJoints)switch(g.position){}const y=o.top??0,p=o.bottom??0,A=o.left??0,j=o.right??0;return y>0&&h.push({x:-r+m,y:c,width:l-m-x,height:y,label:"Extended top"}),p>0&&h.push({x:-r+m,y:-c-p,width:l-m-x,height:p,label:"Extended bottom"}),A>0&&h.push({x:-r-A,y:-c+d,width:A,height:a-u-d,label:"Extended left"}),j>0&&h.push({x:r,y:-c+d,width:j,height:a-u-d,label:"Extended right"}),h},ii=(e,n,s)=>{const i=e/2,o=n/2,l=Math.min(i,o)*.3;return[{id:"corner-tl",index:-1,position:{x:-i,y:o},angle:Math.PI/2,eligible:!0,maxRadius:l,incomingEdgeLength:e,outgoingEdgeLength:n},{id:"corner-tr",index:-1,position:{x:i,y:o},angle:Math.PI/2,eligible:!0,maxRadius:l,incomingEdgeLength:n,outgoingEdgeLength:e},{id:"corner-br",index:-1,position:{x:i,y:-o},angle:Math.PI/2,eligible:!0,maxRadius:l,incomingEdgeLength:e,outgoingEdgeLength:n},{id:"corner-bl",index:-1,position:{x:-i,y:-o},angle:Math.PI/2,eligible:!0,maxRadius:l,incomingEdgeLength:n,outgoingEdgeLength:e}]},oi=(e,n)=>{if(e.length===0)return"";const s=e.map((i,o)=>o===0?`M ${i.x} ${i.y}`:`L ${i.x} ${i.y}`);return n&&s.push("Z"),s.join(" ")},Rs=(e,n,s,i,o=1)=>{const l=s/2,a=i/2,r=d=>Math.abs(d.y-a)<o,c=d=>Math.abs(d.y+a)<o,f=d=>Math.abs(d.x+l)<o,u=d=>Math.abs(d.x-l)<o;return r(e)&&r(n)?"top":c(e)&&c(n)?"bottom":f(e)&&f(n)?"left":u(e)&&u(n)?"right":null},li=(e,n,s)=>{const i={top:[],bottom:[],left:[],right:[]};for(let o=0;o<e.length;o++){const l=e[o],a=e[(o+1)%e.length],r=Rs(l,a,n,s);r&&i[r].push({start:l,end:a})}return i},ri=(e,n,s,i,o,l)=>{const a=o-s,r=l-i,c=a*a+r*r;if(c===0)return Math.sqrt((e-s)**2+(n-i)**2);let f=((e-s)*a+(n-i)*r)/c;f=Math.max(0,Math.min(1,f));const u=s+f*a,d=i+f*r;return Math.sqrt((e-u)**2+(n-d)**2)},ai=(e,n)=>{const s=e/2,i=n/2;return{top:{start:{x:-s,y:i},end:{x:s,y:i}},bottom:{start:{x:-s,y:-i},end:{x:s,y:-i}},left:{start:{x:-s,y:-i},end:{x:-s,y:i}},right:{start:{x:s,y:-i},end:{x:s,y:i}}}},ci=(e,n,s,i=1)=>{const o=[],l=n/2,a=s/2;for(let r=0;r<e.length;r++){const c=e[r],f=e[(r+1)%e.length];if(Rs(c,f,n,s,i))continue;const d=(c.x+f.x)/2,m=(c.y+f.y)/2;let x="top";Math.abs(m-a)<i*2?x="top":Math.abs(m+a)<i*2?x="bottom":Math.abs(d+l)<i*2?x="left":Math.abs(d-l)<i*2&&(x="right"),o.push({start:c,end:f,nearEdge:x})}return o},di=({gridSize:e,id:n})=>t.jsxs("defs",{children:[t.jsx("pattern",{id:n,width:e,height:e,patternUnits:"userSpaceOnUse",children:t.jsx("path",{d:`M ${e} 0 L 0 0 0 ${e}`,fill:"none",stroke:"#2a2a3e",strokeWidth:"0.5"})}),t.jsxs("pattern",{id:`${n}-major`,width:e*10,height:e*10,patternUnits:"userSpaceOnUse",children:[t.jsx("rect",{width:e*10,height:e*10,fill:`url(#${n})`}),t.jsx("path",{d:`M ${e*10} 0 L 0 0 0 ${e*10}`,fill:"none",stroke:"#3a3a4e",strokeWidth:"1"})]})]}),hi=(e,n,s,i)=>{const o=u=>{var d;return((d=i.find(m=>m.id===u))==null?void 0:d.solid)??!1};let a=!1,r=!1,c=!1,f=!1;switch(e){case"x":a=o("top")&&n.y+n.h>=s.height-.01,r=o("bottom")&&n.y<=.01,c=o("back")&&n.z<=.01,f=o("front")&&n.z+n.d>=s.depth-.01;break;case"y":a=o("back")&&n.z<=.01,r=o("front")&&n.z+n.d>=s.depth-.01,c=o("left")&&n.x<=.01,f=o("right")&&n.x+n.w>=s.width-.01;break;case"z":a=o("top")&&n.y+n.h>=s.height-.01,r=o("bottom")&&n.y<=.01,c=o("left")&&n.x<=.01,f=o("right")&&n.x+n.w>=s.width-.01;break}return{meetsTop:a,meetsBottom:r,meetsLeft:c,meetsRight:f}},ui=({className:e})=>{const{sketchPanelId:n,panelCollection:s,exitSketchView:i,config:o,faces:l,rootVoid:a,setEdgeExtension:r}=le(),[c,f]=O.useState({x:0,y:0,width:200,height:200}),[u,d]=O.useState(!1),[m,x]=O.useState({x:0,y:0}),b=O.useRef(null),[h,y]=O.useState(null),[p,A]=O.useState(!1),[j,N]=O.useState(null),[C,v]=O.useState(0),[k,g]=O.useState(0),w=O.useMemo(()=>!s||!n?null:s.panels.find(z=>z.id===n)??null,[s,n]),B=O.useMemo(()=>{if(!w)return[];if(w.source.type==="face"&&w.source.faceId)return Es(w.source.faceId,l,o.assembly);if(w.source.type==="divider"&&w.source.subdivisionId&&w.source.axis){const U=et(a).find(M=>M.id===w.source.subdivisionId);if(U){const M={width:a.bounds.w,height:a.bounds.h,depth:a.bounds.d},{meetsTop:Y,meetsBottom:ee,meetsLeft:te,meetsRight:q}=hi(w.source.axis,U.bounds,M,l);return Ot(Y,ee,te,q)}return Ot(!0,!0,!0,!0)}return[]},[w,l,o.assembly,a]),S=O.useMemo(()=>{if(!w)return null;const z=w.edgeExtensions??{top:0,bottom:0,left:0,right:0},U=w.width-(z.left??0)-(z.right??0),M=w.height-(z.top??0)-(z.bottom??0);return li(w.outline.points,U,M)},[w]),F=O.useMemo(()=>{if(!w)return null;const z=w.edgeExtensions??{top:0,bottom:0,left:0,right:0},U=w.width-(z.left??0)-(z.right??0),M=w.height-(z.top??0)-(z.bottom??0);return ai(U,M)},[w]),L=O.useMemo(()=>{if(!w)return[];const z=w.edgeExtensions??{top:0,bottom:0,left:0,right:0},U=w.width-(z.left??0)-(z.right??0),M=w.height-(z.top??0)-(z.bottom??0);return ci(w.outline.points,U,M)},[w]),D=O.useMemo(()=>w?ni(w,l,o):[],[w,l,o]),R=O.useMemo(()=>w?ii(w.width,w.height,o.materialThickness):[],[w,o.materialThickness]),T=B.filter(z=>z.status==="locked").length,H=B.filter(z=>z.status!=="locked").length,G=O.useCallback(z=>{const U=B.find(M=>M.position===z);return(U==null?void 0:U.status)!=="locked"},[B]),E=O.useCallback((z,U)=>{const M=b.current;if(!M)return null;const Y=M.getBoundingClientRect(),ee=(z-Y.left)/Y.width*c.width+c.x,te=-((U-Y.top)/Y.height*c.height+c.y);return{x:ee,y:te}},[c]),I=O.useCallback((z,U)=>{if(!S||!w)return null;const M=Math.max(3,c.width/50);for(const Y of["top","bottom","left","right"]){const ee=S[Y];for(const te of ee)if(ri(z,U,te.start.x,te.start.y,te.end.x,te.end.y)<M)return Y}return null},[S,w,c.width]);O.useEffect(()=>{if(w){const U=w.width+40,M=w.height+20*2;f({x:-w.width/2-20,y:-w.height/2-20,width:U,height:M})}},[w==null?void 0:w.id]);const V=O.useCallback(z=>{z.preventDefault();const U=z.deltaY>0?1.1:.9,M=b.current;if(!M)return;const Y=M.getBoundingClientRect(),ee=(z.clientX-Y.left)/Y.width*c.width+c.x,te=(z.clientY-Y.top)/Y.height*c.height+c.y,q=c.width*U,je=c.height*U,pe=ee-(ee-c.x)*U,oe=te-(te-c.y)*U;f({x:pe,y:oe,width:q,height:je})},[c]),P=O.useCallback(z=>{var Y;if(z.button!==0)return;const U=E(z.clientX,z.clientY);if(!U)return;const M=I(U.x,U.y);if(M&&G(M)&&w){A(!0),N(M);const ee=((Y=w.edgeExtensions)==null?void 0:Y[M])??0;g(ee),v(M==="top"||M==="bottom"?U.y:U.x)}else d(!0),x({x:z.clientX,y:z.clientY})},[E,I,G,w]),$=O.useCallback(z=>{const U=E(z.clientX,z.clientY);if(p&&j&&U&&w){let M;j==="top"?M=U.y-C:j==="bottom"?M=-(U.y-C):j==="right"?M=U.x-C:M=-(U.x-C);const Y=k+M,ee=Math.max(-o.materialThickness,Math.min(20,Y));r(w.id,j,ee)}else if(u){const M=b.current;if(!M)return;const Y=M.getBoundingClientRect(),ee=(z.clientX-m.x)/Y.width*c.width,te=(z.clientY-m.y)/Y.height*c.height;f(q=>({...q,x:q.x-ee,y:q.y-te})),x({x:z.clientX,y:z.clientY})}else if(U){const M=I(U.x,U.y);y(M)}},[p,j,C,k,u,m,c,E,I,w,r,o.materialThickness]),W=O.useCallback(()=>{d(!1),A(!1),N(null)},[]);O.useEffect(()=>{const z=U=>{U.key==="Escape"&&i()};return window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)},[i]);const X=O.useCallback(()=>{w&&f({x:-w.width/2-20,y:-w.height/2-20,width:w.width+20*2,height:w.height+20*2})},[w]);if(!w)return t.jsx("div",{className:`sketch-view-2d ${e||""}`,children:t.jsxs("div",{className:"sketch-empty",children:[t.jsx("p",{children:"No panel selected for editing"}),t.jsx("button",{onClick:i,children:"Return to 3D View"})]})});const _=10,Z=Math.min(c.width,c.height)/200,K=Math.max(.3,Math.min(1,Z)),J=Math.max(.2,Math.min(.5,Z*.5)),Q=Math.max(2,Math.min(5,Z*3)),se=z=>{const U=B.find(te=>te.position===z),M=(U==null?void 0:U.status)==="locked",Y=h===z,ee=j===z;return M?Y?"#6ab0f9":"#4a90d9":ee?"#ffb060":Y?"#f0a050":"#e09040"},ne=()=>p?j==="top"||j==="bottom"?"ns-resize":"ew-resize":h&&G(h)?h==="top"||h==="bottom"?"ns-resize":"ew-resize":u?"grabbing":"grab";return t.jsxs("div",{className:`sketch-view-2d ${e||""}`,children:[t.jsxs("div",{className:"sketch-toolbar",children:[t.jsxs("div",{className:"sketch-toolbar-left",children:[t.jsx("span",{className:"sketch-panel-name",children:w.label||w.id}),t.jsxs("span",{className:"sketch-panel-dims",children:[w.width.toFixed(1)," x ",w.height.toFixed(1)," mm"]})]}),t.jsxs("div",{className:"sketch-toolbar-right",children:[t.jsx("button",{className:"sketch-btn",onClick:X,title:"Fit to view",children:"Fit"}),t.jsx("button",{className:"sketch-btn sketch-btn-close",onClick:i,title:"Return to 3D (Esc)",children:"Close"})]})]}),t.jsx(Ts,{mode:"2d"}),t.jsxs("svg",{ref:b,className:"sketch-canvas",viewBox:`${c.x} ${c.y} ${c.width} ${c.height}`,onWheel:V,onMouseDown:P,onMouseMove:$,onMouseUp:W,onMouseLeave:W,style:{cursor:ne()},children:[t.jsx(di,{gridSize:_,id:"sketch-grid"}),t.jsx("rect",{x:c.x-c.width,y:c.y-c.height,width:c.width*3,height:c.height*3,fill:"url(#sketch-grid-major)"}),t.jsx("line",{x1:c.x-c.width,y1:0,x2:c.x+c.width*2,y2:0,stroke:"#4a4a6a",strokeWidth:"0.5",strokeDasharray:"4 4"}),t.jsx("line",{x1:0,y1:c.y-c.height,x2:0,y2:c.y+c.height*2,stroke:"#4a4a6a",strokeWidth:"0.5",strokeDasharray:"4 4"}),t.jsxs("g",{transform:"scale(1, -1)",children:[D.map((z,U)=>t.jsx("rect",{x:z.x,y:z.y,width:z.width,height:z.height,fill:"#2ecc71",fillOpacity:.08,stroke:"#2ecc71",strokeWidth:K*.5,strokeDasharray:`${4*Z} ${2*Z}`,opacity:.4},`editable-${U}`)),F&&["top","bottom","left","right"].map(z=>{const U=F[z],M=B.find(ee=>ee.position===z);return(M==null?void 0:M.status)==="locked"||(M==null?void 0:M.status)==="outward-only"?t.jsx("line",{x1:U.start.x,y1:U.start.y,x2:U.end.x,y2:U.end.y,stroke:"#6a6a8a",strokeWidth:K*.5,strokeDasharray:`${3*Z} ${2*Z}`,opacity:.6},`boundary-${z}`):null}),S&&["top","bottom","left","right"].map(z=>{const U=S[z];return!(h===z||j===z)||U.length===0?null:t.jsx("g",{children:U.map((Y,ee)=>t.jsx("line",{x1:Y.start.x,y1:Y.start.y,x2:Y.end.x,y2:Y.end.y,stroke:se(z),strokeWidth:Q,strokeLinecap:"round",opacity:.5},ee))},`highlight-${z}`)}),S&&["top","bottom","left","right"].map(z=>{const U=S[z];return t.jsx("g",{children:U.map((M,Y)=>t.jsx("line",{x1:M.start.x,y1:M.start.y,x2:M.end.x,y2:M.end.y,stroke:se(z),strokeWidth:K,strokeLinecap:"round"},Y))},`edge-${z}`)}),L.map((z,U)=>{const M=se(z.nearEdge);return t.jsx("line",{x1:z.start.x,y1:z.start.y,x2:z.end.x,y2:z.end.y,stroke:M,strokeWidth:K,strokeLinecap:"round",opacity:.8},`joint-${U}`)}),w.holes.map(z=>t.jsx("path",{d:oi(z.path.points,z.path.closed),fill:"#1a1a2e",stroke:"#666",strokeWidth:J},z.id)),R.filter(z=>z.eligible).map(z=>t.jsx("g",{children:t.jsx("circle",{cx:z.position.x,cy:z.position.y,r:Math.max(2,Z*3),fill:"#9b59b6",fillOpacity:.3,stroke:"#9b59b6",strokeWidth:K*.5})},z.id))]}),t.jsx("text",{x:0,y:-w.height/2-8,textAnchor:"middle",fill:"#888",fontSize:"10",fontFamily:"monospace",children:w.width.toFixed(1)}),t.jsx("text",{x:w.width/2+8,y:0,textAnchor:"start",fill:"#888",fontSize:"10",fontFamily:"monospace",transform:`rotate(-90, ${w.width/2+8}, 0)`,children:w.height.toFixed(1)})]}),t.jsxs("div",{className:"sketch-legend",children:[t.jsxs("div",{className:"legend-item",children:[t.jsx("span",{className:"legend-color",style:{background:"#4a90d9"}}),t.jsx("span",{children:"Locked edge (has joints)"})]}),t.jsxs("div",{className:"legend-item",children:[t.jsx("span",{className:"legend-color",style:{background:"#e09040"}}),t.jsx("span",{children:"Editable edge (drag to move)"})]}),t.jsxs("div",{className:"legend-item",children:[t.jsx("span",{className:"legend-line",style:{borderTop:"1px dashed #6a6a8a"}}),t.jsx("span",{children:"Conceptual boundary"})]}),t.jsxs("div",{className:"legend-item",children:[t.jsx("span",{className:"legend-color",style:{background:"#2ecc71",opacity:.5}}),t.jsx("span",{children:"Safe zone (for cutouts)"})]}),t.jsxs("div",{className:"legend-item",children:[t.jsx("span",{className:"legend-color",style:{background:"#9b59b6",borderRadius:"50%"}}),t.jsx("span",{children:"Corner (chamfer/fillet)"})]}),t.jsxs("div",{className:"legend-info",children:[T," locked, ",H," editable"]}),h&&t.jsxs("div",{className:"legend-info",children:[h,": ",G(h)?"drag to extend":"locked"]})]})]})},re=({value:e,onChange:n,min:s,max:i,step:o,className:l})=>{const[a,r]=O.useState(String(e)),[c,f]=O.useState(!1),u=O.useRef(null);O.useEffect(()=>{c||r(String(e))},[e,c]);const d=()=>{f(!0),setTimeout(()=>{var h;return(h=u.current)==null?void 0:h.select()},0)},m=()=>{f(!1),r(String(e))},x=h=>{const y=h.target.value;r(y);const p=parseFloat(y);if(!isNaN(p)){let A=p;s!==void 0&&p<s&&(A=s),i!==void 0&&p>i&&(A=i),(p===A||p<(s??-1/0)||p>(i??1/0))&&n(A)}},b=h=>{var y,p;h.key==="Enter"&&((y=u.current)==null||y.blur()),h.key==="Escape"&&(r(String(e)),(p=u.current)==null||p.blur())};return t.jsx("input",{ref:u,type:"number",value:a,onChange:x,onFocus:d,onBlur:m,onKeyDown:b,min:s,max:i,step:o,className:l})},fi=e=>{switch(e){case"left":case"right":return"x";case"top":case"bottom":return"y";case"front":case"back":return"z"}},hs=e=>e.source.type==="face"&&e.source.faceId?fi(e.source.faceId):e.source.type==="divider"&&e.source.axis?e.source.axis:null,mi=e=>{switch(e){case"x":return["y","z"];case"y":return["x","z"];case"z":return["x","y"]}},pi=e=>e.source.type==="face"&&e.source.faceId?{front:"Front",back:"Back",left:"Left",right:"Right",top:"Top",bottom:"Bottom"}[e.source.faceId]:e.source.type==="divider"?"Divider":"Panel",Vt=e=>e.replace("-split",""),jt=(e,n)=>{for(const s of e.children)if(s.id===n)return e;for(const s of e.children){const i=jt(s,n);if(i)return i}if(e.subAssembly){const s=jt(e.subAssembly.rootVoid,n);if(s)return s}return null},bi=(e,n,s)=>{if(e.source.type==="face"&&n.source.type==="face"){const i=yt(s);return i.children.length===0&&!i.subAssembly?i:null}if(e.source.type==="divider"&&n.source.type==="divider"){const i=e.source.subdivisionId,o=n.source.subdivisionId;if(!i||!o)return null;const l=Vt(i),a=Vt(o),r=jt(s,l),c=jt(s,a);if(!r||!c)return null;if(r.id===c.id){const f=r.children.map(b=>b.id),u=f.indexOf(l),d=f.indexOf(a);if(u===-1||d===-1)return null;const m=Math.min(u,d);if(Math.max(u,d)-m===1){const b=r.children[m];if(b&&b.children.length===0&&!b.subAssembly)return b}}return null}if(e.source.type==="face"&&n.source.type==="divider"||e.source.type==="divider"&&n.source.type==="face"){const i=e.source.type==="face"?e:n,o=e.source.type==="divider"?e:n,l=o.source.subdivisionId;if(!l)return null;const a=i.source.faceId,r=o.source.axis;if(!a||!r||(a==="left"||a==="right"?"x":a==="top"||a==="bottom"?"y":"z")!==r)return null;const f=yt(s),u=Vt(l),m=f.children.map(p=>p.id).indexOf(u);if(m===-1)return null;const x=a==="left"||a==="bottom"||a==="back";if((a==="right"||a==="top"||a==="front")&&m!==f.children.length-1||x&&m!==1)return null;const h=x?m-1:m;if(h<0||h>=f.children.length)return null;const y=f.children[h];return y&&y.children.length===0&&!y.subAssembly?y:null}return null},xi=(e,n,s)=>{const i={isValid:!1,panels:[],panelDescriptions:[],validAxes:[],normalAxis:"x",targetVoid:null};if(e.size!==2||!n)return i;const l=Array.from(e).map(m=>n.panels.find(x=>x.id===m)).filter(m=>m!==void 0);if(l.length!==2)return i;const a=hs(l[0]),r=hs(l[1]);if(!a||!r||a!==r||l.some(m=>m.source.subAssemblyId))return i;const c=a,f=mi(c),u=bi(l[0],l[1],s);if(!u)return i;const d=l.map(pi);return{isValid:!0,panels:l,panelDescriptions:d,validAxes:f,normalAxis:c,targetVoid:u}},Yt=(e,n)=>{if(e.id===n)return e;for(const s of e.children){const i=Yt(s,n);if(i)return i}if(e.subAssembly){const s=Yt(e.subAssembly.rootVoid,n);if(s)return s}return null},gi=e=>{const n=l=>{var a;return((a=e.find(r=>r.id===l))==null?void 0:a.solid)??!0},s=n("left")&&n("right"),i=n("top")&&n("bottom"),o=n("front")&&n("back");return{x:s,y:i,z:o}},us=()=>{const{selectedVoidIds:e,selectedPanelIds:n,panelCollection:s,rootVoid:i,faces:o,config:l,subdivisionPreview:a,setSubdivisionPreview:r,setSubAssemblyPreview:c,applySubdivision:f,removeVoid:u,createSubAssembly:d,removeSubAssembly:m,selectSubAssembly:x,purgeVoid:b,selectVoid:h}=le(),y=e.size===1?Array.from(e)[0]:null,[p,A]=O.useState(!1),[j,N]=O.useState(!1),[C,v]=O.useState(2),[k,g]=O.useState("y"),[w,B]=O.useState(Rt);O.useEffect(()=>{A(!1),N(!1),v(2),g("y"),B(Rt)},[y]);const S=O.useMemo(()=>y?Yt(i,y):null,[y,i]),F=O.useMemo(()=>xi(n,s,i),[n,s,i]),L=S&&S.children.length===0&&!S.subAssembly,D=(S==null?void 0:S.subAssembly)!==void 0,R=S&&S.children.length>0,T=O.useMemo(()=>{const M=[];for(const Y of o)Y.solid||M.push(Y.id);return M},[o]),H=O.useMemo(()=>et(i),[i]),G=O.useMemo(()=>gi(o),[o]);O.useEffect(()=>{if(!j||!S||!y){c(null);return}const{bounds:M}=S,Y=l.materialThickness,ee=M.w-C*2+w.left+w.right,te=M.h-C*2+w.top+w.bottom,q=M.d-C*2+w.front+w.back,je=ee-2*Y,pe=te-2*Y,oe=q-2*Y;if(je<=0||pe<=0||oe<=0){c(null);return}const ae={x:M.x+C-w.left,y:M.y+C-w.bottom,z:M.z+C-w.back,w:ee,h:te,d:q};c({voidId:y,bounds:ae,clearance:C,assemblyAxis:k,faceOffsets:w})},[j,S,y,C,k,w,l.materialThickness,c]);const E=O.useCallback(M=>{if(!y||!S)return;const Y=nt(S.bounds,M,1);r({voidId:y,axis:M,count:1,positions:Y}),A(!0)},[y,S,r]),I=O.useCallback(M=>{if(!a)return;const Y=S||F.targetVoid;if(!Y)return;const ee=Math.max(1,Math.min(20,M)),te=nt(Y.bounds,a.axis,ee);r({...a,count:ee,positions:te})},[a,S,F.targetVoid,r]),V=O.useCallback(()=>{r(null),A(!1)},[r]),P=O.useCallback(()=>{f(),A(!1)},[f]),$=O.useCallback(M=>{if(!y||!S||!L||p)return;const Y=nt(S.bounds,M,1);r({voidId:y,axis:M,count:1,positions:Y})},[y,S,L,p,r]),W=O.useCallback(()=>{p||r(null)},[p,r]),X=O.useCallback(M=>{if(!F.isValid||!F.targetVoid)return;const Y=F.targetVoid.id,ee=nt(F.targetVoid.bounds,M,1);r({voidId:Y,axis:M,count:1,positions:ee}),A(!0)},[F,r]),_=O.useCallback(M=>{if(!F.isValid||!F.targetVoid||p)return;const Y=nt(F.targetVoid.bounds,M,1);r({voidId:F.targetVoid.id,axis:M,count:1,positions:Y})},[F,p,r]),Z=O.useCallback(()=>{p||r(null)},[p,r]),K=(M,Y)=>{if(Y)switch(M){case"x":return"Split with vertical divider (left-right)";case"y":return"Split with horizontal shelf (top-bottom)";case"z":return"Split with vertical divider (front-back)"}switch(M){case"x":return"Disabled: left or right face is open";case"y":return"Disabled: top or bottom face is open";case"z":return"Disabled: front or back face is open"}},J=O.useCallback(()=>{y&&(d(y,{clearance:C,assemblyAxis:k,faceOffsets:w}),N(!1))},[y,d,C,k,w]),Q=O.useCallback((M,Y)=>{B(ee=>({...ee,[M]:Y}))},[]),se=O.useCallback(()=>{y&&b(y)},[y,b]),ne=M=>({front:"Front",back:"Back",left:"Left",right:"Right",top:"Top",bottom:"Bottom"})[M],z=M=>{switch(M){case"x":return"X (Left-Right)";case"y":return"Y (Top-Bottom)";case"z":return"Z (Front-Back)"}},U=M=>M.length===2?`${M[0]} & ${M[1]}`:M.join(" & ");return t.jsxs(We,{title:"Subdivisions",children:[F.isValid&&!p&&t.jsxs("div",{className:"subdivision-controls",children:[t.jsxs("div",{className:"control-section",children:[t.jsx("h4",{children:"Subdivide Between Panels"}),t.jsxs("p",{className:"hint",children:[U(F.panelDescriptions)," selected"]}),t.jsx("div",{className:"button-row",children:F.validAxes.map(M=>t.jsxs("button",{onClick:()=>X(M),onMouseEnter:()=>_(M),onMouseLeave:Z,title:`Split with divider along ${M.toUpperCase()} axis`,children:[M.toUpperCase()," Axis"]},M))}),t.jsx("p",{className:"axis-hint",children:"Only axes perpendicular to selected panels are available"})]}),F.targetVoid&&t.jsx("div",{className:"void-info",children:t.jsxs("p",{children:["Target void: ",F.targetVoid.bounds.w.toFixed(1)," x ",F.targetVoid.bounds.h.toFixed(1)," x ",F.targetVoid.bounds.d.toFixed(1)," mm"]})})]}),p&&a&&t.jsx("div",{className:"subdivision-controls",children:t.jsxs("div",{className:"control-section",children:[t.jsxs("h4",{children:["Configure ",z(a.axis)," subdivision"]}),t.jsxs("div",{className:"preview-config",children:[t.jsxs("div",{className:"count-control",children:[t.jsx("label",{children:"Number of divisions:"}),t.jsxs("div",{className:"count-buttons",children:[t.jsx("button",{onClick:()=>I(a.count-1),disabled:a.count<=1,children:"-"}),t.jsx(re,{value:a.count,onChange:M=>I(Math.round(M)),min:1,max:20}),t.jsx("button",{onClick:()=>I(a.count+1),disabled:a.count>=20,children:"+"})]})]}),t.jsxs("p",{className:"preview-info",children:["This will create ",a.count+1," cells"]}),t.jsxs("div",{className:"confirm-buttons",children:[t.jsx("button",{className:"apply-btn",onClick:P,children:"Apply"}),t.jsx("button",{className:"cancel-btn",onClick:V,children:"Cancel"})]})]})]})}),y&&S&&!F.isValid?t.jsxs("div",{className:"subdivision-controls",children:[D?t.jsx("div",{className:"control-section",children:t.jsxs("div",{className:"subassembly-info",children:[t.jsx("h4",{children:"Contains: Nested Box"}),t.jsx("p",{className:"hint",children:"Click the sub-assembly in the 3D view to edit it"}),t.jsx("button",{className:"select-subassembly-btn",onClick:()=>x(S.subAssembly.id),children:"Select Nested Box"}),t.jsx("button",{className:"remove-subassembly-btn",onClick:()=>m(y),children:"Remove Nested Box"})]})}):R?t.jsxs("div",{className:"control-section",children:[t.jsx("div",{className:"hint",children:"This void has been subdivided. Select a child cell to subdivide further."}),t.jsx("button",{className:"purge-btn",onClick:se,title:"Remove all subdivisions and nested content from this void",children:"Purge Void"})]}):L?t.jsxs(t.Fragment,{children:[p?null:t.jsxs(t.Fragment,{children:[!j&&t.jsxs("div",{className:"control-section",children:[t.jsx("h4",{children:"Subdivide"}),t.jsxs("div",{className:"button-row",children:[t.jsx("button",{onClick:()=>E("x"),onMouseEnter:()=>$("x"),onMouseLeave:W,disabled:!G.x,title:K("x",G.x),children:"X Axis"}),t.jsx("button",{onClick:()=>E("y"),onMouseEnter:()=>$("y"),onMouseLeave:W,disabled:!G.y,title:K("y",G.y),children:"Y Axis"}),t.jsx("button",{onClick:()=>E("z"),onMouseEnter:()=>$("z"),onMouseLeave:W,disabled:!G.z,title:K("z",G.z),children:"Z Axis"})]}),(!G.x||!G.y||!G.z)&&t.jsx("p",{className:"axis-hint",children:"Some axes disabled due to open faces"})]}),t.jsxs("div",{className:"control-section",children:[t.jsx("h4",{children:"Create Assembly"}),j?t.jsxs("div",{className:"create-assembly-form",children:[t.jsxs("div",{className:"form-row",children:[t.jsx("label",{children:"Clearance (mm):"}),t.jsx(re,{value:C,onChange:M=>v(M),min:0,step:.5})]}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{children:"Assembly Axis:"}),t.jsxs("select",{value:k,onChange:M=>g(M.target.value),children:[t.jsx("option",{value:"y",children:"Y (Top/Bottom lids)"}),t.jsx("option",{value:"x",children:"X (Left/Right lids)"}),t.jsx("option",{value:"z",children:"Z (Front/Back lids)"})]})]}),T.length>0&&t.jsxs("div",{className:"face-offsets-section",children:[t.jsx("label",{className:"section-label",children:"Face Offsets (mm):"}),t.jsx("p",{className:"offset-hint",children:"Adjust assembly position relative to open faces"}),T.map(M=>t.jsxs("div",{className:"form-row offset-row",children:[t.jsxs("label",{children:[ne(M),":"]}),t.jsxs("div",{className:"offset-input-group",children:[t.jsx("button",{onClick:()=>Q(M,w[M]-1),className:"offset-btn",children:"-"}),t.jsx(re,{value:w[M],onChange:Y=>Q(M,Y),step:.5,className:"offset-input"}),t.jsx("button",{onClick:()=>Q(M,w[M]+1),className:"offset-btn",children:"+"})]})]},M))]}),t.jsxs("div",{className:"confirm-buttons",children:[t.jsx("button",{className:"apply-btn",onClick:J,children:"Create"}),t.jsx("button",{className:"cancel-btn",onClick:()=>N(!1),children:"Cancel"})]})]}):t.jsx("div",{className:"button-row",children:t.jsx("button",{onClick:()=>N(!0),title:"Create a nested box that fits inside this void",children:"Create Nested Box"})})]})]}),t.jsx("div",{className:"void-info",children:t.jsxs("p",{children:["Size: ",S.bounds.w.toFixed(1)," x ",S.bounds.h.toFixed(1)," x ",S.bounds.d.toFixed(1)," mm"]})})]}):null,y!=="root"&&S.splitAxis&&t.jsx("div",{className:"control-section",children:t.jsx("button",{className:"remove-subdivision-btn",onClick:()=>u(y),title:"Remove this subdivision and merge back",children:"Remove Subdivision"})})]}):!F.isValid&&!p?t.jsx("p",{className:"hint",children:n.size===2?"Selected panels must be opposite faces (e.g., Front & Back) to subdivide between them":n.size===1?"Select another opposite panel (Shift+click) to subdivide between them, or select a void":"Select a void or two opposite panels to subdivide"}):null,H.length>0&&t.jsxs("div",{className:"control-section",children:[t.jsxs("h4",{children:["Current subdivisions (",H.length,")"]}),t.jsxs("ul",{className:"subdivision-list",children:[H.slice(0,10).map(M=>t.jsx("li",{children:t.jsxs("span",{children:[M.axis.toUpperCase()," @ ",M.position.toFixed(1),"mm"]})},M.id)),H.length>10&&t.jsxs("li",{className:"more-indicator",children:["+",H.length-10," more..."]})]})]})]})},fs=({width:e,height:n,edgeStatuses:s,selectedEdge:i,onEdgeClick:o,edgeExtensions:l})=>{const c=Math.min(80/e,80/n),f=e*c,u=n*c,d=f+15*2,m=u+15*2,x=v=>{const k=s.find(g=>g.position===v);return(k==null?void 0:k.status)??"locked"},b=v=>{const k=x(v),g=i===v,w=[`edge-${k}`];return g&&w.push("edge-selected"),k==="unlocked"&&w.push("edge-clickable"),w.join(" ")},h={top:l.top*c,bottom:l.bottom*c,left:l.left*c,right:l.right*c},y=15-h.top,p=15+u+h.bottom,A=15-h.left,j=15+f+h.right,N={top:{x1:A,y1:y,x2:j,y2:y},bottom:{x1:j,y1:p,x2:A,y2:p},left:{x1:A,y1:p,x2:A,y2:y},right:{x1:j,y1:y,x2:j,y2:p}},C=v=>{x(v)==="unlocked"&&o(v)};return t.jsxs("svg",{className:"edge-preview-svg",viewBox:`0 0 ${d} ${m}`,preserveAspectRatio:"xMidYMid meet",children:[t.jsx("rect",{x:A,y,width:j-A,height:p-y,fill:"#252545",stroke:"none"}),["top","right","bottom","left"].map(v=>t.jsx("line",{...N[v],className:b(v),strokeWidth:6,strokeLinecap:"round",onClick:()=>C(v),style:{cursor:x(v)==="unlocked"?"pointer":"default"}},v)),l.top!==0&&t.jsxs("text",{x:d/2,y:y-5,className:"extension-label",textAnchor:"middle",children:[l.top>0?"+":"",l.top]}),l.bottom!==0&&t.jsxs("text",{x:d/2,y:p+12,className:"extension-label",textAnchor:"middle",children:[l.bottom>0?"+":"",l.bottom]}),l.left!==0&&t.jsxs("text",{x:A-5,y:m/2,className:"extension-label",textAnchor:"end",dominantBaseline:"middle",children:[l.left>0?"+":"",l.left]}),l.right!==0&&t.jsxs("text",{x:j+5,y:m/2,className:"extension-label",textAnchor:"start",dominantBaseline:"middle",children:[l.right>0?"+":"",l.right]})]})},ms=()=>t.jsxs("div",{className:"edge-legend",children:[t.jsxs("div",{className:"legend-item",children:[t.jsx("span",{className:"legend-color locked"}),t.jsx("span",{children:"Locked (finger joints)"})]}),t.jsxs("div",{className:"legend-item",children:[t.jsx("span",{className:"legend-color unlocked"}),t.jsx("span",{children:"Unlocked (extendable)"})]})]}),ps=({edge:e,value:n,status:s,onChange:i})=>{const o={top:"Top",bottom:"Bottom",left:"Left",right:"Right"};return s==="locked"?t.jsxs("div",{className:"edge-controls",children:[t.jsxs("div",{className:"edge-controls-header",children:[t.jsxs("span",{className:"edge-name",children:[o[e]," Edge"]}),t.jsx("span",{className:"edge-status-badge locked",children:"Locked"})]}),t.jsx("p",{className:"edge-controls-hint",children:"This edge has finger joints and cannot be extended in V1."})]}):t.jsxs("div",{className:"edge-controls",children:[t.jsxs("div",{className:"edge-controls-header",children:[t.jsxs("span",{className:"edge-name",children:[o[e]," Edge"]}),t.jsx("span",{className:"edge-status-badge unlocked",children:"Unlocked"})]}),t.jsxs("div",{className:"edge-controls-row",children:[t.jsx("button",{className:"edge-btn",onClick:()=>i(n-1),title:"Extend inward (shrink)",children:"-"}),t.jsx(re,{className:"edge-input",value:n,onChange:i,step:1}),t.jsx("button",{className:"edge-btn",onClick:()=>i(n+1),title:"Extend outward (grow)",children:"+"}),t.jsx("span",{className:"edge-unit",children:"mm"})]}),t.jsx("p",{className:"edge-controls-hint",children:"Positive = outward (grow), Negative = inward (shrink)"})]})},yi={front:"Front",back:"Back",left:"Left",right:"Right",top:"Top",bottom:"Bottom"},vi={x:"Vertical (X)",y:"Horizontal (Y)",z:"Vertical (Z)"},wi={x:"X Position (left/right)",y:"Y Position (up/down)",z:"Z Position (front/back)"},ji=(e,n,s,i,o)=>{switch(e){case"front":case"back":return{panelWidth:n,panelHeight:s};case"left":case"right":return{panelWidth:i,panelHeight:s};case"top":case"bottom":return{panelWidth:n,panelHeight:i};default:return{panelWidth:0,panelHeight:0}}},Si=(e,n,s,i)=>{const o=m=>{var x;return((x=i.find(b=>b.id===m))==null?void 0:x.solid)??!1};let a=0,r=0,c=!1,f=!1,u=!1,d=!1;switch(e){case"x":a=n.d,r=n.h,c=o("top")&&n.y+n.h>=s.height-.01,f=o("bottom")&&n.y<=.01,u=o("back")&&n.z<=.01,d=o("front")&&n.z+n.d>=s.depth-.01;break;case"y":a=n.w,r=n.d,c=o("back")&&n.z<=.01,f=o("front")&&n.z+n.d>=s.depth-.01,u=o("left")&&n.x<=.01,d=o("right")&&n.x+n.w>=s.width-.01;break;case"z":a=n.w,r=n.h,c=o("top")&&n.y+n.h>=s.height-.01,f=o("bottom")&&n.y<=.01,u=o("left")&&n.x<=.01,d=o("right")&&n.x+n.w>=s.width-.01;break}return{panelWidth:a,panelHeight:r,meetsTop:c,meetsBottom:f,meetsLeft:u,meetsRight:d}},Ai=()=>{var k,g;const{selectedPanelIds:e,faces:n,config:s,rootVoid:i,toggleFace:o,toggleSubAssemblyFace:l,panelCollection:a,setEdgeExtension:r,setDividerPosition:c,setDividerPositionMode:f,enterSketchView:u}=le(),[d,m]=O.useState(null),x=e.size>0?Array.from(e)[0]:null,b=O.useMemo(()=>!a||!x?null:a.panels.find(w=>w.id===x)??null,[a,x]),h=O.useMemo(()=>b!=null&&b.source.subAssemblyId?Ge(i).find(B=>B.subAssembly.id===b.source.subAssemblyId)??null:null,[b,i]);if(!x||!b)return null;const{source:y}=b,p=!!y.subAssemblyId,A=p&&h?h.subAssembly.faces:n,j=p&&h?{width:h.subAssembly.rootVoid.bounds.w+2*h.subAssembly.materialThickness,height:h.subAssembly.rootVoid.bounds.h+2*h.subAssembly.materialThickness,depth:h.subAssembly.rootVoid.bounds.d+2*h.subAssembly.materialThickness,materialThickness:h.subAssembly.materialThickness,assembly:h.subAssembly.assembly}:s,N=p&&h?h.subAssembly.rootVoid:i,C=b.edgeExtensions??{top:0,bottom:0,left:0,right:0},v=w=>{d&&b&&r(b.id,d,w)};if(y.type==="face"&&y.faceId){const w=y.faceId,B=A.find(H=>H.id===w);if(!B)return null;const{panelWidth:S,panelHeight:F}=ji(w,j.width,j.height,j.depth,j.materialThickness),L=Es(w,A,j.assembly),D=d?((k=L.find(H=>H.position===d))==null?void 0:k.status)??"locked":null,R=p?" (Nested)":"",T=p?"Sub-Assembly Face":"Outer Face";return t.jsx(We,{title:"Panel Properties",children:t.jsxs("div",{className:"panel-properties",children:[t.jsxs("div",{className:"property-header",children:[t.jsx("span",{className:"property-icon",children:""}),t.jsxs("span",{className:"property-title",children:[yi[w]," Face",R]})]}),t.jsxs("div",{className:"property-group",children:[t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Type:"}),t.jsx("span",{className:"property-value",children:T})]}),t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Dimensions:"}),t.jsxs("span",{className:"property-value",children:[S.toFixed(1)," x ",F.toFixed(1)," mm"]})]}),t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Thickness:"}),t.jsxs("span",{className:"property-value",children:[j.materialThickness," mm"]})]})]}),t.jsx("div",{className:"property-group",children:t.jsxs("label",{className:"toggle-row",children:[t.jsx("input",{type:"checkbox",checked:B.solid,onChange:()=>{p&&y.subAssemblyId?l(y.subAssemblyId,w):o(w)}}),t.jsx("span",{children:"Solid (include in cut)"})]})}),B.solid&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Edge Status"}),t.jsx(fs,{width:S,height:F,edgeStatuses:L,selectedEdge:d,onEdgeClick:m,edgeExtensions:C}),t.jsx(ms,{})]}),d&&D&&t.jsx(ps,{edge:d,value:C[d],status:D,onChange:v})]}),t.jsx("div",{className:"panel-actions",children:t.jsx("button",{className:"edit-2d-btn",onClick:()=>u(b.id),children:"Edit in 2D"})})]})})}if(y.type==="divider"&&y.subdivisionId&&y.axis){const B=et(N).find(Q=>Q.id===y.subdivisionId);if(!B)return null;const{axis:S,position:F,bounds:L}=B,D={width:N.bounds.w,height:N.bounds.h,depth:N.bounds.d},{panelWidth:R,panelHeight:T,meetsTop:H,meetsBottom:G,meetsLeft:E,meetsRight:I}=Si(S,L,D,A),V=Ot(H,G,E,I),P=d?((g=V.find(Q=>Q.position===d))==null?void 0:g.status)??"locked":null,$=S==="x"?L.x:S==="y"?L.y:L.z,W=S==="x"?L.x+L.w:S==="y"?L.y+L.h:L.z+L.d,X=j.materialThickness,_=$+X,Z=W-X,K=Q=>{c(B.id,Q)},J=p?" (Nested)":"";return t.jsx(We,{title:"Panel Properties",children:t.jsxs("div",{className:"panel-properties",children:[t.jsxs("div",{className:"property-header",children:[t.jsx("span",{className:"property-icon",children:""}),t.jsxs("span",{className:"property-title",children:["Divider Panel",J]})]}),t.jsxs("div",{className:"property-group",children:[t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Type:"}),t.jsxs("span",{className:"property-value",children:[vi[S]," Divider"]})]}),t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Dimensions:"}),t.jsxs("span",{className:"property-value",children:[R.toFixed(1)," x ",T.toFixed(1)," mm"]})]}),t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Thickness:"}),t.jsxs("span",{className:"property-value",children:[j.materialThickness," mm"]})]})]}),!p&&t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:wi[S]}),t.jsxs("div",{className:"position-controls",children:[t.jsx("div",{className:"position-slider-row",children:t.jsx("input",{type:"range",className:"position-slider",min:_,max:Z,step:.5,value:F,onChange:Q=>K(parseFloat(Q.target.value))})}),t.jsxs("div",{className:"position-input-row",children:[t.jsx("button",{className:"position-btn",onClick:()=>K(F-1),disabled:F<=_,children:"-"}),t.jsx(re,{className:"position-input",value:F,onChange:K,min:_,max:Z,step:.5}),t.jsx("button",{className:"position-btn",onClick:()=>K(F+1),disabled:F>=Z,children:"+"}),t.jsx("span",{className:"position-unit",children:"mm"})]})]}),t.jsxs("div",{className:"position-mode-toggle",children:[t.jsxs("label",{className:"toggle-label",children:[t.jsx("input",{type:"checkbox",checked:B.positionMode==="percentage",onChange:Q=>f(B.id,Q.target.checked?"percentage":"absolute")}),t.jsx("span",{className:"toggle-text",children:"Scale with box dimensions"})]}),B.positionMode==="percentage"&&B.percentage!==void 0&&t.jsxs("span",{className:"percentage-display",children:["(",(B.percentage*100).toFixed(1),"%)"]})]})]}),p&&t.jsx("div",{className:"property-group",children:t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Position:"}),t.jsxs("span",{className:"property-value",children:[F.toFixed(1)," mm"]})]})}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Edge Status"}),t.jsx(fs,{width:R,height:T,edgeStatuses:V,selectedEdge:d,onEdgeClick:m,edgeExtensions:C}),t.jsx(ms,{})]}),d&&P&&t.jsx(ps,{edge:d,value:C[d],status:P,onChange:v}),t.jsx("div",{className:"panel-actions",children:t.jsx("button",{className:"edit-2d-btn",onClick:()=>u(b.id),children:"Edit in 2D"})})]})})}return null},Ii=()=>{var C,v,k;const{selectedAssemblyId:e,selectedSubAssemblyIds:n,config:s,faces:i,rootVoid:o,setConfig:l,toggleFace:a,toggleSubAssemblyFace:r,setSubAssemblyClearance:c,setAssemblyAxis:f,setLidTabDirection:u,setLidInset:d,setSubAssemblyAxis:m,setSubAssemblyLidTabDirection:x,setSubAssemblyLidInset:b,setFeetConfig:h}=le(),y=e??(n.size>0?Array.from(n)[0]:null);if(!y)return null;if(y==="main")return t.jsx(We,{title:"Assembly Properties",children:t.jsxs("div",{className:"assembly-properties",children:[t.jsxs("div",{className:"property-header",children:[t.jsx("span",{className:"property-icon",children:""}),t.jsx("span",{className:"property-title",children:"Main Box"})]}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Dimensions"}),t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Width (mm)"}),t.jsx(re,{value:s.width,onChange:g=>l({width:g}),min:1})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Height (mm)"}),t.jsx(re,{value:s.height,onChange:g=>l({height:g}),min:1})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Depth (mm)"}),t.jsx(re,{value:s.depth,onChange:g=>l({depth:g}),min:1})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Material Thickness (mm)"}),t.jsx(re,{value:s.materialThickness,onChange:g=>l({materialThickness:g}),min:.1,step:.5})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Finger Width (mm)"}),t.jsx(re,{value:s.fingerWidth,onChange:g=>l({fingerWidth:g}),min:1})]})]})]}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Faces"}),t.jsxs("div",{className:"face-grid compact",children:[t.jsxs("div",{className:"face-row",children:[t.jsx("div",{className:"face-spacer small"}),t.jsx(Ce,{faceId:"top",face:i.find(g=>g.id==="top"),onToggle:a}),t.jsx("div",{className:"face-spacer small"})]}),t.jsxs("div",{className:"face-row",children:[t.jsx(Ce,{faceId:"left",face:i.find(g=>g.id==="left"),onToggle:a}),t.jsx(Ce,{faceId:"front",face:i.find(g=>g.id==="front"),onToggle:a}),t.jsx(Ce,{faceId:"right",face:i.find(g=>g.id==="right"),onToggle:a})]}),t.jsxs("div",{className:"face-row",children:[t.jsx("div",{className:"face-spacer small"}),t.jsx(Ce,{faceId:"bottom",face:i.find(g=>g.id==="bottom"),onToggle:a}),t.jsx("div",{className:"face-spacer small"})]}),t.jsxs("div",{className:"face-row",children:[t.jsx("div",{className:"face-spacer small"}),t.jsx(Ce,{faceId:"back",face:i.find(g=>g.id==="back"),onToggle:a}),t.jsx("div",{className:"face-spacer small"})]})]})]}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Assembly"}),t.jsx("div",{className:"form-grid",children:t.jsxs("label",{children:[t.jsx("span",{children:"Assembly Axis"}),t.jsxs("select",{value:s.assembly.assemblyAxis,onChange:g=>f(g.target.value),children:[t.jsx("option",{value:"y",children:"Y (top/bottom lids)"}),t.jsx("option",{value:"x",children:"X (left/right lids)"}),t.jsx("option",{value:"z",children:"Z (front/back lids)"})]})]})}),t.jsxs("div",{className:"lid-config-section",children:[t.jsxs("h5",{children:[Be(s.assembly.assemblyAxis,"positive").charAt(0).toUpperCase()+Be(s.assembly.assemblyAxis,"positive").slice(1)," Lid"]}),t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Tab Direction"}),t.jsxs("select",{value:s.assembly.lids.positive.tabDirection,onChange:g=>u("positive",g.target.value),disabled:s.assembly.lids.positive.inset>0,children:[t.jsx("option",{value:"tabs-out",children:"Tabs Out (into walls)"}),t.jsx("option",{value:"tabs-in",children:"Tabs In (from walls)"})]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Inset (mm)"}),t.jsx(re,{value:s.assembly.lids.positive.inset,onChange:g=>d("positive",g),min:0,step:1})]})]})]}),t.jsxs("div",{className:"lid-config-section",children:[t.jsxs("h5",{children:[Be(s.assembly.assemblyAxis,"negative").charAt(0).toUpperCase()+Be(s.assembly.assemblyAxis,"negative").slice(1)," Lid"]}),t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Tab Direction"}),t.jsxs("select",{value:s.assembly.lids.negative.tabDirection,onChange:g=>u("negative",g.target.value),disabled:s.assembly.lids.negative.inset>0,children:[t.jsx("option",{value:"tabs-out",children:"Tabs Out (into walls)"}),t.jsx("option",{value:"tabs-in",children:"Tabs In (from walls)"})]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Inset (mm)"}),t.jsx(re,{value:s.assembly.lids.negative.inset,onChange:g=>d("negative",g),min:0,step:1})]})]})]})]}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Feet"}),t.jsx("div",{className:"form-grid",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:((C=s.assembly.feet)==null?void 0:C.enabled)??!1,onChange:g=>h({...dn,...s.assembly.feet,enabled:g.target.checked})}),t.jsx("span",{children:"Add feet to box"})]})}),((v=s.assembly.feet)==null?void 0:v.enabled)&&t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Height (mm)"}),t.jsx(re,{value:s.assembly.feet.height,onChange:g=>h({...s.assembly.feet,height:g}),min:5,max:100,step:5})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Foot width (mm)"}),t.jsx(re,{value:s.assembly.feet.width,onChange:g=>h({...s.assembly.feet,width:g}),min:10,max:100,step:5})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Inset from edge (mm)"}),t.jsx(re,{value:s.assembly.feet.inset,onChange:g=>h({...s.assembly.feet,inset:g}),min:0,max:50,step:1})]})]}),((k=s.assembly.feet)==null?void 0:k.enabled)&&t.jsx("p",{className:"hint",children:"Feet extend wall panels below the bottom face."})]})]})});const A=Ge(o).find(g=>g.subAssembly.id===y);if(!A)return t.jsx(We,{title:"Assembly Properties",children:t.jsx("p",{className:"hint",children:"Assembly not found"})});const{subAssembly:j,bounds:N}=A;return t.jsx(We,{title:"Assembly Properties",children:t.jsxs("div",{className:"assembly-properties",children:[t.jsxs("div",{className:"property-header",children:[t.jsx("span",{className:"property-icon",children:""}),t.jsx("span",{className:"property-title",children:"Nested Box"})]}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Dimensions"}),t.jsxs("div",{className:"property-group",children:[t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Outer Width:"}),t.jsxs("span",{className:"property-value",children:[(N.w-j.clearance*2).toFixed(1)," mm"]})]}),t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Outer Height:"}),t.jsxs("span",{className:"property-value",children:[(N.h-j.clearance*2).toFixed(1)," mm"]})]}),t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Outer Depth:"}),t.jsxs("span",{className:"property-value",children:[(N.d-j.clearance*2).toFixed(1)," mm"]})]}),t.jsxs("div",{className:"property-row",children:[t.jsx("span",{className:"property-label",children:"Material:"}),t.jsxs("span",{className:"property-value",children:[j.materialThickness," mm"]})]})]})]}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Clearance"}),t.jsx("div",{className:"form-grid",children:t.jsxs("label",{children:[t.jsx("span",{children:"Gap from parent void (mm)"}),t.jsx(re,{value:j.clearance,onChange:g=>c(j.id,g),min:0,max:Math.min(N.w,N.h,N.d)/2-1,step:.5})]})})]}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Faces"}),t.jsxs("div",{className:"face-grid compact",children:[t.jsxs("div",{className:"face-row",children:[t.jsx("div",{className:"face-spacer small"}),t.jsx(Ce,{faceId:"top",face:j.faces.find(g=>g.id==="top"),onToggle:g=>r(j.id,g)}),t.jsx("div",{className:"face-spacer small"})]}),t.jsxs("div",{className:"face-row",children:[t.jsx(Ce,{faceId:"left",face:j.faces.find(g=>g.id==="left"),onToggle:g=>r(j.id,g)}),t.jsx(Ce,{faceId:"front",face:j.faces.find(g=>g.id==="front"),onToggle:g=>r(j.id,g)}),t.jsx(Ce,{faceId:"right",face:j.faces.find(g=>g.id==="right"),onToggle:g=>r(j.id,g)})]}),t.jsxs("div",{className:"face-row",children:[t.jsx("div",{className:"face-spacer small"}),t.jsx(Ce,{faceId:"bottom",face:j.faces.find(g=>g.id==="bottom"),onToggle:g=>r(j.id,g)}),t.jsx("div",{className:"face-spacer small"})]}),t.jsxs("div",{className:"face-row",children:[t.jsx("div",{className:"face-spacer small"}),t.jsx(Ce,{faceId:"back",face:j.faces.find(g=>g.id==="back"),onToggle:g=>r(j.id,g)}),t.jsx("div",{className:"face-spacer small"})]})]})]}),t.jsxs("div",{className:"property-section",children:[t.jsx("h4",{children:"Assembly"}),t.jsx("div",{className:"form-grid",children:t.jsxs("label",{children:[t.jsx("span",{children:"Assembly Axis"}),t.jsxs("select",{value:j.assembly.assemblyAxis,onChange:g=>m(j.id,g.target.value),children:[t.jsx("option",{value:"y",children:"Y (top/bottom lids)"}),t.jsx("option",{value:"x",children:"X (left/right lids)"}),t.jsx("option",{value:"z",children:"Z (front/back lids)"})]})]})}),t.jsxs("div",{className:"lid-config-section",children:[t.jsxs("h5",{children:[Be(j.assembly.assemblyAxis,"positive").charAt(0).toUpperCase()+Be(j.assembly.assemblyAxis,"positive").slice(1)," Lid"]}),t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Tab Direction"}),t.jsxs("select",{value:j.assembly.lids.positive.tabDirection,onChange:g=>x(j.id,"positive",g.target.value),disabled:j.assembly.lids.positive.inset>0,children:[t.jsx("option",{value:"tabs-out",children:"Tabs Out (into walls)"}),t.jsx("option",{value:"tabs-in",children:"Tabs In (from walls)"})]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Inset (mm)"}),t.jsx(re,{value:j.assembly.lids.positive.inset,onChange:g=>b(j.id,"positive",g),min:0,step:1})]})]})]}),t.jsxs("div",{className:"lid-config-section",children:[t.jsxs("h5",{children:[Be(j.assembly.assemblyAxis,"negative").charAt(0).toUpperCase()+Be(j.assembly.assemblyAxis,"negative").slice(1)," Lid"]}),t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Tab Direction"}),t.jsxs("select",{value:j.assembly.lids.negative.tabDirection,onChange:g=>x(j.id,"negative",g.target.value),disabled:j.assembly.lids.negative.inset>0,children:[t.jsx("option",{value:"tabs-out",children:"Tabs Out (into walls)"}),t.jsx("option",{value:"tabs-in",children:"Tabs In (from walls)"})]})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Inset (mm)"}),t.jsx(re,{value:j.assembly.lids.negative.inset,onChange:g=>b(j.id,"negative",g),min:0,step:1})]})]})]})]})]})})},Ce=({faceId:e,face:n,onToggle:s})=>{const i={front:"F",back:"Bk",left:"L",right:"R",top:"T",bottom:"Bt"};return t.jsx("button",{className:`face-button small ${n.solid?"solid":"open"}`,onClick:()=>s(e),title:`${e}: ${n.solid?"Solid":"Open"}`,children:i[e]})},ki=()=>{const{config:e,setConfig:n}=le();return t.jsx(We,{title:"Dimensions",children:t.jsxs("div",{className:"form-grid",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Width (mm)"}),t.jsx(re,{value:e.width,onChange:s=>n({width:s}),min:1,step:1})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Height (mm)"}),t.jsx(re,{value:e.height,onChange:s=>n({height:s}),min:1,step:1})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Depth (mm)"}),t.jsx(re,{value:e.depth,onChange:s=>n({depth:s}),min:1,step:1})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Material Thickness (mm)"}),t.jsx(re,{value:e.materialThickness,onChange:s=>n({materialThickness:s}),min:.1,step:.1})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Finger Width (mm)"}),t.jsx(re,{value:e.fingerWidth,onChange:s=>n({fingerWidth:s}),min:1,step:1})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Corner Gap ( finger width)"}),t.jsx(re,{value:e.fingerGap,onChange:s=>n({fingerGap:s}),min:0,max:5,step:.1})]})]})})},is=({isOpen:e,onClose:n,title:s,children:i})=>(O.useEffect(()=>{const o=l=>{l.key==="Escape"&&n()};return e&&(document.addEventListener("keydown",o),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}},[e,n]),e?t.jsx("div",{className:"modal-overlay",onClick:n,children:t.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h2",{children:s}),t.jsx("button",{className:"modal-close",onClick:n,children:""})]}),t.jsx("div",{className:"modal-body",children:i})]})}):null);class Ni{constructor(n,s){tt(this,"binWidth");tt(this,"binHeight");tt(this,"freeRectangles",[]);tt(this,"packedItems",[]);this.binWidth=n,this.binHeight=s,this.freeRectangles=[{x:0,y:0,width:n,height:s}]}insert(n,s,i,o=!0){let l=1/0,a=null,r=!1;for(const u of this.freeRectangles){if(s<=u.width&&i<=u.height){const d=Math.min(u.width-s,u.height-i);d<l&&(l=d,a=u,r=!1)}if(o&&i<=u.width&&s<=u.height){const d=Math.min(u.width-i,u.height-s);d<l&&(l=d,a=u,r=!0)}}if(!a)return!1;const c=r?i:s,f=r?s:i;return this.packedItems.push({panel:n,x:a.x,y:a.y,width:c,height:f,rotated:r}),this.splitFreeRect(a,c,f),this.pruneFreeRectangles(),!0}splitFreeRect(n,s,i){const o=this.freeRectangles.indexOf(n);o!==-1&&this.freeRectangles.splice(o,1),s<n.width&&this.freeRectangles.push({x:n.x+s,y:n.y,width:n.width-s,height:n.height}),i<n.height&&this.freeRectangles.push({x:n.x,y:n.y+i,width:s,height:n.height-i})}pruneFreeRectangles(){for(let n=0;n<this.freeRectangles.length;n++)for(let s=n+1;s<this.freeRectangles.length;s++){if(this.isContainedIn(this.freeRectangles[n],this.freeRectangles[s])){this.freeRectangles.splice(n,1),n--;break}this.isContainedIn(this.freeRectangles[s],this.freeRectangles[n])&&(this.freeRectangles.splice(s,1),s--)}}isContainedIn(n,s){return n.x>=s.x&&n.y>=s.y&&n.x+n.width<=s.x+s.width&&n.y+n.height<=s.y+s.height}}const It=5,$s=(e,n,s,i=5,o=!0,l=!0)=>{const a=[],r=l?It:0,c=e.filter(m=>m.visible).map(m=>({panel:m,width:m.width+i,height:m.height+r+i})).sort((m,x)=>x.width*x.height-m.width*m.height),f=n-i,u=s-i;let d=[...c];for(;d.length>0;){const m=new Ni(f,u),x=[];for(let h=0;h<d.length;h++){const y=d[h];m.insert(y.panel,y.width,y.height,o)&&x.push(h)}if(x.length===0){for(const h of d)a.push({items:[{panel:h.panel,x:i,y:i,width:h.width,height:h.height,rotated:!1}],width:h.width+i*2,height:h.height+i*2});break}const b=m.packedItems.map(h=>({...h,x:h.x+i,y:h.y+i}));a.push({items:b,width:n,height:s}),d=d.filter((h,y)=>!x.includes(y))}return a},Pi=(e,n=5,s=!0)=>{const i=e.filter(u=>u.visible);if(i.length===0)return{items:[],width:0,height:0};const o=s?It:0,l=i.map(u=>({panel:u,width:u.width,height:u.height+o}));l.sort((u,d)=>d.height-u.height);const a=[];let r=0;for(const u of l){let d=!1;for(const m of a){const x=m.items.reduce((b,h)=>b+h.width+n,n);if(u.height<=m.height){m.items.push({panel:u.panel,x,y:m.y,width:u.width,height:u.height,rotated:!1}),r=Math.max(r,x+u.width+n),d=!0;break}}if(!d){const m=a.length===0?n:a[a.length-1].y+a[a.length-1].height+n;a.push({y:m,height:u.height,items:[{panel:u.panel,x:n,y:m,width:u.width,height:u.height,rotated:!1}]}),r=Math.max(r,n+u.width+n)}}const c=a.flatMap(u=>u.items),f=a.length===0?0:a[a.length-1].y+a[a.length-1].height+n;return{items:c,width:r,height:f}},Te=(e,n,s)=>{if(e.length===0)return"";let i=`M ${(e[0].x+n).toFixed(3)} ${(-e[0].y+s).toFixed(3)} `;for(let o=1;o<e.length;o++)i+=`L ${(e[o].x+n).toFixed(3)} ${(-e[o].y+s).toFixed(3)} `;return i+="Z",i},Mi=(e,n=0)=>{const s=e.thickness*4,i=e.width+s*2,o=e.height+s*2,l=i/2,a=o/2,r=Te(e.outline.points,l,a);let c=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
     width="${i}mm"
     height="${o}mm"
     viewBox="0 0 ${i} ${o}">
  <title>${e.label||e.id}</title>
  <g stroke="#000" stroke-width="0.1" fill="none">
    <path d="${r}" />
`;for(const f of e.holes){const u=Te(f.path.points,l,a);c+=`    <path d="${u}" />
`}return c+=`  </g>
  <text x="${i/2}" y="${o-2}"
        text-anchor="middle" font-size="3" fill="red" stroke="red">
    ${e.label||e.id} - ${e.width.toFixed(1)}mm x ${e.height.toFixed(1)}mm
  </text>
</svg>`,c},bt=(e,n,s,i=0,o=!0)=>{const l=s>1?`Boxen Export - Bed ${n+1} of ${s}`:"Boxen Export - All Pieces";let a=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
     width="${e.width}mm"
     height="${e.height}mm"
     viewBox="0 0 ${e.width} ${e.height}">
  <title>${l}</title>
`;for(const r of e.items){const c=r.panel.width,f=r.panel.height,u=c/2,d=f/2;let m,x=[];if(r.rotated){const y=r.panel.outline.points.map(p=>({x:p.y,y:-p.x}));m=Te(y,f/2,c/2);for(const p of r.panel.holes){const A=p.path.points.map(j=>({x:j.y,y:-j.x}));x.push(Te(A,f/2,c/2))}}else{m=Te(r.panel.outline.points,u,d);for(const y of r.panel.holes)x.push(Te(y.path.points,u,d))}const b=r.rotated?f:c,h=r.rotated?c:f;a+=`  <g transform="translate(${r.x}, ${r.y})" stroke="#000" stroke-width="0.1" fill="none">
    <path d="${m}" />
`;for(const y of x)a+=`    <path d="${y}" />
`;if(o){const y=r.rotated?" (R)":"";a+=`    <text x="${b/2}" y="${h+It-1}"
          text-anchor="middle" font-size="2" fill="red" stroke="red">
      ${r.panel.label||r.panel.id}${y}
    </text>
`}a+=`  </g>
`}return a+="</svg>",a},Bs=(e,n=0,s)=>{const i=(s==null?void 0:s.gap)??5,o=(s==null?void 0:s.allowRotation)??!0,l=(s==null?void 0:s.showLabels)??!0;if(s!=null&&s.bedWidth&&(s!=null&&s.bedHeight)){const r=$s(e.panels,s.bedWidth,s.bedHeight,i,o,l);if(r.length===0)return bt({items:[],width:100,height:100},0,1,n,l);if(r.length===1)return bt(r[0],0,1,n,l);const c=20;let f=0,u=0;for(const x of r)f+=x.height+c,u=Math.max(u,x.width);let d=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
     width="${u}mm"
     height="${f}mm"
     viewBox="0 0 ${u} ${f}">
  <title>Boxen Export - ${r.length} Beds</title>
`,m=0;for(let x=0;x<r.length;x++){const b=r[x];d+=`  <rect x="0" y="${m}" width="${b.width}" height="${b.height}"
        stroke="red" stroke-width="0.5" stroke-dasharray="5,5" fill="none" />
  <text x="5" y="${m+10}" font-size="4" fill="red" stroke="red">Bed ${x+1}</text>
`;for(const h of b.items){const y=h.panel.width,p=h.panel.height,A=y/2,j=p/2;let N,C=[];if(h.rotated){const g=h.panel.outline.points.map(w=>({x:w.y,y:-w.x}));N=Te(g,p/2,y/2);for(const w of h.panel.holes){const B=w.path.points.map(S=>({x:S.y,y:-S.x}));C.push(Te(B,p/2,y/2))}}else{N=Te(h.panel.outline.points,A,j);for(const g of h.panel.holes)C.push(Te(g.path.points,A,j))}const v=h.rotated?p:y,k=h.rotated?y:p;d+=`  <g transform="translate(${h.x}, ${m+h.y})" stroke="#000" stroke-width="0.1" fill="none">
    <path d="${N}" />
`;for(const g of C)d+=`    <path d="${g}" />
`;if(l){const g=h.rotated?" (R)":"";d+=`    <text x="${v/2}" y="${k+It-1}"
          text-anchor="middle" font-size="2" fill="red" stroke="red">
      ${h.panel.label||h.panel.id}${g}
    </text>
`}d+=`  </g>
`}m+=b.height+c}return d+="</svg>",d}const a=Pi(e.panels,i,l);return a.items.length===0?`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="100mm" height="100mm" viewBox="0 0 100 100">
  <title>Boxen Export - No Pieces</title>
</svg>`:bt(a,0,1,n,l)},Ci=(e,n)=>{const s=(n==null?void 0:n.gap)??5,i=(n==null?void 0:n.allowRotation)??!0,o=(n==null?void 0:n.kerf)??0,l=(n==null?void 0:n.showLabels)??!0;if(!n.bedWidth||!n.bedHeight)return[Bs(e,o,n)];const a=$s(e.panels,n.bedWidth,n.bedHeight,s,i,l);return a.map((r,c)=>bt(r,c,a.length,o,l))},ft=(e,n)=>{const s=new Blob([e],{type:"image/svg+xml"}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)},Ei=["front","back","left","right","top","bottom"],zt=[{label:"Auto (no limit)",width:0,height:0},{label:"K40 (300 x 200)",width:300,height:200},{label:"Glowforge (495 x 279)",width:495,height:279},{label:"Full Sheet (600 x 400)",width:600,height:400},{label:"Custom",width:-1,height:-1}],Vi=({isOpen:e,onClose:n})=>{const{faces:s,panelCollection:i}=le(),[o,l]=O.useState(.1),[a,r]=O.useState(0),[c,f]=O.useState(300),[u,d]=O.useState(200),[m,x]=O.useState(!0),[b,h]=O.useState(5),[y,p]=O.useState(!0),[A,j]=O.useState(!1),N=(i==null?void 0:i.panels)??[],C=N.filter(S=>S.source.type==="face"),v=N.filter(S=>S.source.type==="divider"),k=N.filter(S=>S.visible).length,g=S=>{const F=Mi(S,o);if(F){const L=S.source.type==="face"?`boxen-${S.source.faceId}.svg`:`boxen-${S.id}.svg`;ft(F,L)}},w=()=>{const S=zt[a];return S.width===0?{}:S.width===-1?{width:c,height:u}:{width:S.width,height:S.height}},B=()=>{if(!i)return;const S=w(),F={bedWidth:S.width,bedHeight:S.height,gap:b,allowRotation:m,kerf:o,showLabels:y};if(A&&S.width&&S.height){const L=Ci(i,F);L.length===1?ft(L[0],"boxen-all-pieces.svg"):L.forEach((D,R)=>{ft(D,`boxen-bed-${R+1}.svg`)})}else{const L=Bs(i,o,F);ft(L,"boxen-all-pieces.svg")}};return t.jsx(is,{isOpen:e,onClose:n,title:"Export SVG",children:t.jsx("div",{className:"export-modal-content",children:t.jsxs("div",{className:"export-controls",children:[t.jsxs("div",{className:"export-settings",children:[t.jsx("div",{className:"export-setting-row",children:t.jsxs("label",{children:[t.jsx("span",{children:"Bed Size:"}),t.jsx("select",{value:a,onChange:S=>r(parseInt(S.target.value)),children:zt.map((S,F)=>t.jsx("option",{value:F,children:S.label},F))})]})}),a===zt.length-1&&t.jsxs("div",{className:"export-setting-row custom-bed-size",children:[t.jsxs("label",{children:[t.jsx("span",{children:"Width (mm):"}),t.jsx(re,{value:c,onChange:f,min:50,step:10})]}),t.jsxs("label",{children:[t.jsx("span",{children:"Height (mm):"}),t.jsx(re,{value:u,onChange:d,min:50,step:10})]})]}),t.jsx("div",{className:"export-setting-row",children:t.jsxs("label",{children:[t.jsx("span",{children:"Gap between pieces (mm):"}),t.jsx(re,{value:b,onChange:h,min:0,step:1})]})}),t.jsx("div",{className:"export-setting-row",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:m,onChange:S=>x(S.target.checked)}),t.jsx("span",{children:"Allow rotation for better packing"})]})}),t.jsx("div",{className:"export-setting-row",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:y,onChange:S=>p(S.target.checked)}),t.jsx("span",{children:"Show panel labels"})]})}),a!==0&&t.jsx("div",{className:"export-setting-row",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:A,onChange:S=>j(S.target.checked)}),t.jsx("span",{children:"Export beds as separate files"})]})}),t.jsx("div",{className:"export-setting-row",children:t.jsxs("label",{children:[t.jsx("span",{children:"Kerf compensation (mm):"}),t.jsx(re,{value:o,onChange:l,min:0,step:.01})]})})]}),t.jsxs("div",{className:"export-section",children:[t.jsxs("h4",{children:["Outer Faces (",C.length,")"]}),t.jsx("div",{className:"export-buttons",children:Ei.map(S=>{const F=s.find(R=>R.id===S),L=(F==null?void 0:F.solid)??!0,D=C.find(R=>R.source.type==="face"&&R.source.faceId===S);return t.jsx("button",{onClick:()=>D&&g(D),disabled:!L||!D,title:L?`Export ${S} face`:`${S} face is open`,children:S.charAt(0).toUpperCase()+S.slice(1)},S)})})]}),v.length>0&&t.jsxs("div",{className:"export-section",children:[t.jsxs("h4",{children:["Subdivision Panels (",v.length,")"]}),t.jsx("div",{className:"export-buttons",children:v.map(S=>{var L,D,R;const F=S.source.type==="divider"?`${(L=S.source.axis)==null?void 0:L.toUpperCase()}@${((R=(D=S.label)==null?void 0:D.split("@")[1])==null?void 0:R.split("mm")[0])??"?"}`:S.id;return t.jsx("button",{onClick:()=>g(S),title:`Export ${S.label||S.id}`,children:F},S.id)})})]}),t.jsx("div",{className:"export-section export-all-section",children:t.jsxs("button",{className:"export-all-btn",onClick:B,disabled:k===0,children:["Download All Pieces (",k,")"]})}),t.jsxs("div",{className:"export-info",children:[t.jsx("p",{children:"SVG files include:"}),t.jsxs("ul",{children:[t.jsx("li",{children:"Finger joints on outer face edges"}),t.jsx("li",{children:"Slots for subdivision panel tabs"}),t.jsx("li",{children:"Interlocking slots for crossing dividers"}),t.jsx("li",{children:"Dimensions in mm"})]})]})]})})})},kt="boxen-projects",zi=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,9),Xe=()=>{try{const e=localStorage.getItem(kt);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load projects from localStorage:",e),[]}},Fi=(e,n,s,i)=>{const o=Xe(),l=Date.now(),a=es(n),r={id:zi(),name:e,thumbnail:s,data:a,createdAt:l,updatedAt:l};return o.unshift(r),localStorage.setItem(kt,JSON.stringify(o)),r},Li=e=>{const s=Xe().find(i=>i.id===e);return s?Bt(s.data):null},Di=e=>{const n=Xe(),s=n.filter(i=>i.id!==e);return s.length===n.length?!1:(localStorage.setItem(kt,JSON.stringify(s)),!0)},Ti=(e,n)=>{const s=Xe(),i=s.findIndex(o=>o.id===e);return i===-1?!1:(s[i]={...s[i],name:n,updatedAt:Date.now()},localStorage.setItem(kt,JSON.stringify(s)),!0)},Xt=580,Zt=240,Ft=Xt/Zt,Hi=e=>{const n=document.createElement("canvas"),s=n.getContext("2d");if(!s)return"";n.width=Xt,n.height=Zt;const i=e.width/e.height;let o=0,l=0,a=e.width,r=e.height;return i>Ft?(a=e.height*Ft,o=(e.width-a)/2):(r=e.width/Ft,l=(e.height-r)/2),s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(e,o,l,a,r,0,0,Xt,Zt),n.toDataURL("image/png")},Ri=({isOpen:e,onClose:n,onLoadProject:s})=>{const[i,o]=O.useState([]),[l,a]=O.useState(null),[r,c]=O.useState(""),[f,u]=O.useState(null);O.useEffect(()=>{e&&(o(Xe()),a(null),u(null))},[e]);const d=p=>{Di(p)&&(o(Xe()),u(null))},m=p=>{a(p.id),c(p.name),u(null)},x=()=>{l&&r.trim()&&Ti(l,r.trim())&&o(Xe()),a(null),c("")},b=()=>{a(null),c("")},h=p=>{s(p),n()},y=p=>new Date(p).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return t.jsx(is,{isOpen:e,onClose:n,title:"My Projects",children:t.jsx("div",{className:"project-browser",children:i.length===0?t.jsxs("div",{className:"no-projects",children:[t.jsx("p",{children:"No saved projects yet."}),t.jsx("p",{className:"hint",children:'Use the "Save" button to save your current project.'})]}):t.jsx("div",{className:"project-grid",children:i.map(p=>t.jsxs("div",{className:"project-card",children:[t.jsx("div",{className:"project-thumbnail",onClick:()=>h(p.id),children:p.thumbnail?t.jsx("img",{src:p.thumbnail,alt:p.name}):t.jsx("div",{className:"no-thumbnail",children:"No preview"})}),t.jsxs("div",{className:"project-info",children:[l===p.id?t.jsxs("div",{className:"project-name-edit",children:[t.jsx("input",{type:"text",value:r,onChange:A=>c(A.target.value),onKeyDown:A=>{A.key==="Enter"&&x(),A.key==="Escape"&&b()},autoFocus:!0}),t.jsxs("div",{className:"edit-buttons",children:[t.jsx("button",{onClick:x,title:"Save",children:""}),t.jsx("button",{onClick:b,title:"Cancel",children:""})]})]}):t.jsx("div",{className:"project-name",onClick:()=>h(p.id),children:p.name}),t.jsx("div",{className:"project-date",children:y(p.updatedAt)})]}),t.jsx("div",{className:"project-actions",children:f===p.id?t.jsxs("div",{className:"delete-confirm",children:[t.jsx("span",{children:"Delete?"}),t.jsx("button",{className:"confirm-yes",onClick:()=>d(p.id),children:"Yes"}),t.jsx("button",{className:"confirm-no",onClick:()=>u(null),children:"No"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn load-btn",onClick:()=>h(p.id),title:"Load project",children:"Open"}),t.jsx("button",{className:"action-btn rename-btn",onClick:()=>m(p),title:"Rename project",children:"Rename"}),t.jsx("button",{className:"action-btn delete-btn",onClick:()=>u(p.id),title:"Delete project",children:"Delete"})]})})]},p.id))})})})},$i=({isOpen:e,onClose:n,onSave:s,defaultName:i=""})=>{const[o,l]=O.useState(i);O.useEffect(()=>{e&&l(i||`Project ${new Date().toLocaleDateString()}`)},[e,i]);const a=r=>{r.preventDefault(),o.trim()&&(s(o.trim()),n())};return t.jsx(is,{isOpen:e,onClose:n,title:"Save Project",children:t.jsxs("form",{className:"save-project-form",onSubmit:a,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"project-name",children:"Project Name"}),t.jsx("input",{id:"project-name",type:"text",value:o,onChange:r=>l(r.target.value),placeholder:"Enter project name...",autoFocus:!0})]}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"cancel-btn",onClick:n,children:"Cancel"}),t.jsx("button",{type:"submit",className:"save-btn",disabled:!o.trim(),children:"Save Project"})]})]})})},bs=e=>e.source.type==="face"&&e.source.faceId?{left:"x",right:"x",top:"y",bottom:"y",front:"z",back:"z"}[e.source.faceId]:e.source.type==="divider"&&e.source.axis?e.source.axis:null,Bi=(e,n)=>{if(e.size!==2||!n)return!1;const i=Array.from(e).map(a=>n.panels.find(r=>r.id===a)).filter(a=>a!==void 0);if(i.length!==2||i.some(a=>a.source.subAssemblyId))return!1;const o=bs(i[0]),l=bs(i[1]);return o!==null&&o===l};function Oi(){const[e,n]=O.useState(!1),[s,i]=O.useState(!1),[o,l]=O.useState(!1),[a,r]=O.useState("idle"),[c,f]=O.useState("idle"),u=O.useRef(null),{config:d,faces:m,rootVoid:x,panelCollection:b,selectedVoidIds:h,selectedPanelIds:y,selectedAssemblyId:p,selectedSubAssemblyIds:A,viewMode:j,loadFromUrl:N,getShareableUrl:C,saveToUrl:v,generatePanels:k,setConfig:g}=le();O.useEffect(()=>{N()&&k()},[]);const w=async()=>{const R=C();try{await navigator.clipboard.writeText(R),r("copied"),setTimeout(()=>r("idle"),2e3)}catch{const H=document.createElement("textarea");H.value=R,document.body.appendChild(H),H.select(),document.execCommand("copy"),document.body.removeChild(H),r("copied"),setTimeout(()=>r("idle"),2e3)}},B=R=>{var I;let T="";const H=(I=u.current)==null?void 0:I.getCanvas();H&&(T=Hi(H));const G={};if(b)for(const V of b.panels)V.edgeExtensions&&(V.edgeExtensions.top!==0||V.edgeExtensions.bottom!==0||V.edgeExtensions.left!==0||V.edgeExtensions.right!==0)&&(G[V.id]=V.edgeExtensions);Fi(R,{config:d,faces:m,rootVoid:x,edgeExtensions:G},T),f("saved"),setTimeout(()=>f("idle"),2e3)},S=R=>{var H;const T=Li(R);if(T){const G=le.getState(),E=T.edgeExtensions;if(G.setConfig(T.config),le.setState({config:T.config,faces:T.faces,rootVoid:T.rootVoid,panelsDirty:!0}),k(),Object.keys(E).length>0){const I=(H=le.getState().panelCollection)==null?void 0:H.panels;if(I){const V=I.map(P=>({...P,edgeExtensions:E[P.id]??P.edgeExtensions??Ue}));le.setState({panelCollection:{...le.getState().panelCollection,panels:V}})}}v()}},F=()=>{le.setState({config:{width:100,height:100,depth:100,materialThickness:3,fingerWidth:10,fingerGap:1.5,assembly:{assemblyAxis:"y",lids:{positive:{enabled:!0,tabDirection:"tabs-out",inset:0},negative:{enabled:!0,tabDirection:"tabs-out",inset:0}}}},faces:[{id:"front",solid:!0},{id:"back",solid:!0},{id:"left",solid:!0},{id:"right",solid:!0},{id:"top",solid:!0},{id:"bottom",solid:!0}],rootVoid:{id:"root",bounds:{x:0,y:0,z:0,w:100,h:100,d:100},children:[]},selectedVoidIds:new Set,selectedPanelIds:new Set,selectedAssemblyId:null,selectedSubAssemblyIds:new Set,panelsDirty:!0}),k();const R=new URL(window.location.href);R.searchParams.delete("p"),R.hash="",window.history.replaceState(null,"",R.toString())},L=O.useMemo(()=>Bi(y,b),[y,b]),D=()=>h.size===1?t.jsx(us,{}):L?t.jsx(us,{}):y.size>0?t.jsx(Ai,{}):p||A.size>0?t.jsx(Ii,{}):t.jsx(ki,{});return t.jsxs("div",{className:"app",children:[t.jsxs("header",{className:"app-header",children:[t.jsxs("div",{className:"header-content",children:[t.jsx("h1",{children:"Boxen"}),t.jsx("p",{children:"3D Laser-Cut Box Designer"})]}),t.jsxs("div",{className:"header-menu",children:[t.jsxs("button",{className:"header-btn secondary",onClick:F,children:[t.jsx("span",{className:"header-btn-icon",children:"+"}),"New"]}),t.jsxs("button",{className:"header-btn secondary",onClick:()=>i(!0),children:[t.jsx("span",{className:"header-btn-icon",children:""}),"Open"]}),t.jsxs("button",{className:"header-btn",onClick:()=>l(!0),children:[t.jsx("span",{className:"header-btn-icon",children:c==="saved"?"":""}),c==="saved"?"Saved!":"Save"]}),t.jsxs("button",{className:"header-btn secondary",onClick:w,children:[t.jsx("span",{className:"header-btn-icon",children:a==="copied"?"":""}),a==="copied"?"Copied!":"Share"]}),t.jsxs("button",{className:"header-btn",onClick:()=>n(!0),children:[t.jsx("span",{className:"header-btn-icon",children:""}),"Export"]})]})]}),t.jsxs("main",{className:"app-main",children:[t.jsx("aside",{className:"sidebar left-sidebar",children:t.jsx($n,{})}),t.jsx("section",{className:"viewport",children:j==="3d"?t.jsx(Hs,{ref:u}):t.jsx(ui,{})}),t.jsx("aside",{className:"sidebar right-sidebar",children:D()})]}),t.jsx(Vi,{isOpen:e,onClose:()=>n(!1)}),t.jsx(Ri,{isOpen:s,onClose:()=>i(!1),onLoadProject:S}),t.jsx($i,{isOpen:o,onClose:()=>l(!1),onSave:B})]})}Js.createRoot(document.getElementById("root")).render(t.jsx(xs.StrictMode,{children:t.jsx(Oi,{})}));
//# sourceMappingURL=index-Dnhsuhlh.js.map
